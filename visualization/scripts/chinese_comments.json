{
  "backend/tests/test_lsp_scoped_diagnostics.py": [
    {
      "line": 25,
      "type": "single",
      "original": "# 创建 .astrolabe 目录",
      "full_line": "        # 创建 .astrolabe 目录"
    },
    {
      "line": 29,
      "type": "single",
      "original": "# 创建 100 个 .lean 文件",
      "full_line": "        # 创建 100 个 .lean 文件"
    },
    {
      "line": 37,
      "type": "single",
      "original": "# 创建 canvas.json，只显示 5 个节点",
      "full_line": "        # 创建 canvas.json，只显示 5 个节点"
    },
    {
      "line": 67,
      "type": "single",
      "original": "# 调用 start_lsp 应该只打开 visible_nodes 对应的文件",
      "full_line": "        # 调用 start_lsp 应该只打开 visible_nodes 对应的文件"
    },
    {
      "line": 68,
      "type": "single",
      "original": "# 目前的实现会打开所有 100 个文件，这是错误的",
      "full_line": "        # 目前的实现会打开所有 100 个文件，这是错误的"
    },
    {
      "line": 69,
      "type": "single",
      "original": "# 正确的行为应该是只打开 5 个文件",
      "full_line": "        # 正确的行为应该是只打开 5 个文件"
    },
    {
      "line": 71,
      "type": "single",
      "original": "# 模拟 API 调用",
      "full_line": "        # 模拟 API 调用"
    },
    {
      "line": 78,
      "type": "single",
      "original": "# 新的 API 应该接受 visible_nodes 参数",
      "full_line": "            # 新的 API 应该接受 visible_nodes 参数"
    },
    {
      "line": 79,
      "type": "single",
      "original": "# 这需要修改 LSPStartRequest 模型",
      "full_line": "            # 这需要修改 LSPStartRequest 模型"
    },
    {
      "line": 82,
      "type": "single",
      "original": "# 检查 LSPStartRequest 是否有 visible_nodes 字段",
      "full_line": "            # 检查 LSPStartRequest 是否有 visible_nodes 字段"
    },
    {
      "line": 102,
      "type": "single",
      "original": "# 创建一个追踪所有 send_did_open 调用的 mock",
      "full_line": "        # 创建一个追踪所有 send_did_open 调用的 mock"
    },
    {
      "line": 118,
      "type": "single",
      "original": "# 使用新的 visible_nodes 参数启动 LSP",
      "full_line": "            # 使用新的 visible_nodes 参数启动 LSP"
    },
    {
      "line": 119,
      "type": "single",
      "original": "# 当前实现没有这个参数，所以会失败",
      "full_line": "            # 当前实现没有这个参数，所以会失败"
    },
    {
      "line": 122,
      "type": "single",
      "original": "# 这个字段目前不存在",
      "full_line": "                visible_nodes=visible_nodes  # 这个字段目前不存在"
    },
    {
      "line": 127,
      "type": "single",
      "original": "# 验证只打开了 visible_nodes 对应的 2 个文件",
      "full_line": "            # 验证只打开了 visible_nodes 对应的 2 个文件"
    },
    {
      "line": 131,
      "type": "single",
      "original": "# 验证打开的是正确的文件",
      "full_line": "            # 验证打开的是正确的文件"
    },
    {
      "line": 150,
      "type": "single",
      "original": "# 追踪 send_did_open 调用",
      "full_line": "        # 追踪 send_did_open 调用"
    },
    {
      "line": 160,
      "type": "single",
      "original": "# 检查是否有 update_visible_nodes 方法",
      "full_line": "        # 检查是否有 update_visible_nodes 方法"
    },
    {
      "line": 161,
      "type": "single",
      "original": "# 当前实现没有，需要新增",
      "full_line": "        # 当前实现没有，需要新增"
    },
    {
      "line": 165,
      "type": "single",
      "original": "# 模拟：已经打开了 Module0.lean（使用完整路径）",
      "full_line": "        # 模拟：已经打开了 Module0.lean（使用完整路径）"
    },
    {
      "line": 169,
      "type": "single",
      "original": "# 调用 update_visible_nodes 添加新节点",
      "full_line": "        # 调用 update_visible_nodes 添加新节点"
    },
    {
      "line": 173,
      "type": "single",
      "original": "# 验证只打开了新增的文件",
      "full_line": "        # 验证只打开了新增的文件"
    },
    {
      "line": 192,
      "type": "single",
      "original": "# 追踪 send_did_close 调用",
      "full_line": "        # 追踪 send_did_close 调用"
    },
    {
      "line": 201,
      "type": "single",
      "original": "# 检查是否有 send_did_close 方法",
      "full_line": "        # 检查是否有 send_did_close 方法"
    },
    {
      "line": 202,
      "type": "single",
      "original": "# 当前实现没有，需要新增",
      "full_line": "        # 当前实现没有，需要新增"
    },
    {
      "line": 208,
      "type": "single",
      "original": "# 模拟：已经打开了两个文件",
      "full_line": "        # 模拟：已经打开了两个文件"
    },
    {
      "line": 214,
      "type": "single",
      "original": "# 调用 update_visible_nodes 移除一个节点",
      "full_line": "        # 调用 update_visible_nodes 移除一个节点"
    },
    {
      "line": 218,
      "type": "single",
      "original": "# 验证关闭了不再需要的文件",
      "full_line": "        # 验证关闭了不再需要的文件"
    },
    {
      "line": 232,
      "type": "single",
      "original": "# 检查是否有映射函数",
      "full_line": "        # 检查是否有映射函数"
    },
    {
      "line": 238,
      "type": "single",
      "original": "# 测试映射逻辑",
      "full_line": "        # 测试映射逻辑"
    },
    {
      "line": 264,
      "type": "single",
      "original": "# 同一文件中的另一个定理",
      "full_line": "            \"Module.theorem2\",  # 同一文件中的另一个定理"
    },
    {
      "line": 270,
      "type": "single",
      "original": "# 应该只有 2 个文件（去重）",
      "full_line": "        # 应该只有 2 个文件（去重）"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\nLSP Scoped Diagnostics Tests\n测试 LSP 只诊断 canvas 可见节点对应的文件（而非全量扫描）\n\nTDD 第一阶段：编写失败测试\n\"\"\"",
      "full_line": "\"\"\"\nLSP Scoped Diagnostics Tests\n测试 LSP 只诊断 canvas 可见节点对应的文件（而非全量扫描）\n\nTDD 第一阶段：编写失败测试\n\"\"\""
    },
    {
      "line": 16,
      "type": "docstring",
      "original": "\"\"\"测试 LSP 只诊断 canvas 可见节点对应的文件\"\"\"",
      "full_line": "    \"\"\"测试 LSP 只诊断 canvas 可见节点对应的文件\"\"\""
    },
    {
      "line": 20,
      "type": "docstring",
      "original": "        \"\"\"\n        创建模拟项目结构：\n        - 100 个 .lean 文件\n        - canvas 只显示 5 个节点\n        \"\"\"",
      "full_line": "        \"\"\"\n        创建模拟项目结构：\n        - 100 个 .lean 文件\n        - canvas 只显示 5 个节点\n        \"\"\""
    },
    {
      "line": 51,
      "type": "docstring",
      "original": "        \"\"\"\n        启动 LSP 时，只应该打开 visible_nodes 对应的文件，而非全量扫描\n\n        Given: 项目有 100 个 .lean 文件，canvas 只显示 5 个节点\n        When: 调用 start_lsp(project_path, visible_nodes=[...5个节点...])\n        Then: send_did_open() 只被调用 5 次，而非 100 次\n        \"\"\"",
      "full_line": "        \"\"\"\n        启动 LSP 时，只应该打开 visible_nodes 对应的文件，而非全量扫描\n\n        Given: 项目有 100 个 .lean 文件，canvas 只显示 5 个节点\n        When: 调用 start_lsp(project_path, visible_nodes=[...5个节点...])\n        Then: send_did_open() 只被调用 5 次，而非 100 次\n        \"\"\""
    },
    {
      "line": 90,
      "type": "docstring",
      "original": "        \"\"\"\n        不在 canvas 上的文件不应该被打开\n\n        Given: visible_nodes = [\"Module0.theorem_0\", \"Module1.theorem_1\"]\n        When: 启动 LSP\n        Then: Module2.lean ~ Module99.lean 不应被 send_did_open()\n        \"\"\"",
      "full_line": "        \"\"\"\n        不在 canvas 上的文件不应该被打开\n\n        Given: visible_nodes = [\"Module0.theorem_0\", \"Module1.theorem_1\"]\n        When: 启动 LSP\n        Then: Module2.lean ~ Module99.lean 不应被 send_did_open()\n        \"\"\""
    },
    {
      "line": 139,
      "type": "docstring",
      "original": "        \"\"\"\n        当新节点进入 canvas 可见区域时，动态打开对应文件\n\n        Given: LSP 已启动，visible_nodes = [\"Module0.theorem_0\"]\n        When: visible_nodes 变为 [\"Module0.theorem_0\", \"Module1.theorem_1\"]\n        Then: 只对 Module1.lean 调用 send_did_open()\n        \"\"\"",
      "full_line": "        \"\"\"\n        当新节点进入 canvas 可见区域时，动态打开对应文件\n\n        Given: LSP 已启动，visible_nodes = [\"Module0.theorem_0\"]\n        When: visible_nodes 变为 [\"Module0.theorem_0\", \"Module1.theorem_1\"]\n        Then: 只对 Module1.lean 调用 send_did_open()\n        \"\"\""
    },
    {
      "line": 181,
      "type": "docstring",
      "original": "        \"\"\"\n        当节点离开 canvas 可见区域时，关闭对应文件释放资源\n\n        Given: LSP 已启动，visible_nodes = [\"Module0.theorem_0\", \"Module1.theorem_1\"]\n        When: visible_nodes 变为 [\"Module0.theorem_0\"]\n        Then: 对 Module1.lean 调用 send_did_close()\n        \"\"\"",
      "full_line": "        \"\"\"\n        当节点离开 canvas 可见区域时，关闭对应文件释放资源\n\n        Given: LSP 已启动，visible_nodes = [\"Module0.theorem_0\", \"Module1.theorem_1\"]\n        When: visible_nodes 变为 [\"Module0.theorem_0\"]\n        Then: 对 Module1.lean 调用 send_did_close()\n        \"\"\""
    },
    {
      "line": 225,
      "type": "docstring",
      "original": "        \"\"\"\n        应该有节点 ID 到文件路径的映射函数\n\n        Given: node_id = \"Mathlib.Analysis.Calculus.theorem1\"\n        When: 调用 node_id_to_file(node_id, project_path)\n        Then: 返回 \"/path/to/Mathlib/Analysis/Calculus.lean\"\n        \"\"\"",
      "full_line": "        \"\"\"\n        应该有节点 ID 到文件路径的映射函数\n\n        Given: node_id = \"Mathlib.Analysis.Calculus.theorem1\"\n        When: 调用 node_id_to_file(node_id, project_path)\n        Then: 返回 \"/path/to/Mathlib/Analysis/Calculus.lean\"\n        \"\"\""
    },
    {
      "line": 249,
      "type": "docstring",
      "original": "        \"\"\"\n        应该能将 visible_nodes 列表转换为需要打开的文件集合\n\n        Given: visible_nodes 包含同一文件中的多个定理\n        When: 转换为文件列表\n        Then: 每个文件只出现一次（去重）\n        \"\"\"",
      "full_line": "        \"\"\"\n        应该能将 visible_nodes 列表转换为需要打开的文件集合\n\n        Given: visible_nodes 包含同一文件中的多个定理\n        When: 转换为文件列表\n        Then: 每个文件只出现一次（去重）\n        \"\"\""
    }
  ],
  "backend/tests/test_lsp_monaco_sync.py": [
    {
      "line": 33,
      "type": "single",
      "original": "# 模拟 WebSocket 连接",
      "full_line": "        # 模拟 WebSocket 连接"
    },
    {
      "line": 36,
      "type": "single",
      "original": "# 模拟 LSP 客户端",
      "full_line": "        # 模拟 LSP 客户端"
    },
    {
      "line": 43,
      "type": "single",
      "original": "# 创建临时测试文件",
      "full_line": "        # 创建临时测试文件"
    },
    {
      "line": 51,
      "type": "single",
      "original": "# 启动 LSP",
      "full_line": "                    # 启动 LSP"
    },
    {
      "line": 52,
      "type": "single",
      "original": "# 注：这里我们测试的是规范，实际实现需要正确处理",
      "full_line": "                    # 注：这里我们测试的是规范，实际实现需要正确处理"
    },
    {
      "line": 55,
      "type": "single",
      "original": "# 验证规范：start_lsp 应该发送 diagnostics_update 消息",
      "full_line": "                    # 验证规范：start_lsp 应该发送 diagnostics_update 消息"
    },
    {
      "line": 68,
      "type": "single",
      "original": "# 空数组表示无错误",
      "full_line": "            \"diagnostics\": [],  # 空数组表示无错误"
    },
    {
      "line": 99,
      "type": "single",
      "original": "# 验证：必须发送 lsp_stopped 消息",
      "full_line": "            # 验证：必须发送 lsp_stopped 消息"
    },
    {
      "line": 113,
      "type": "single",
      "original": "# 规范：前端必须执行以下操作",
      "full_line": "        # 规范：前端必须执行以下操作"
    },
    {
      "line": 115,
      "type": "single",
      "original": "# 清空所有诊断数据",
      "full_line": "            \"set fileDiagnostics to empty Map\",  # 清空所有诊断数据"
    },
    {
      "line": 116,
      "type": "single",
      "original": "# 绿色对号消失",
      "full_line": "            \"successLines becomes empty array\",  # 绿色对号消失"
    },
    {
      "line": 117,
      "type": "single",
      "original": "# Monaco 编辑器标记清空",
      "full_line": "            \"Monaco markers cleared\",  # Monaco 编辑器标记清空"
    },
    {
      "line": 133,
      "type": "single",
      "original": "# 场景 1：LSP 运行中",
      "full_line": "        # 场景 1：LSP 运行中"
    },
    {
      "line": 135,
      "type": "single",
      "original": "# → 必须有诊断数据（至少是空数组，表示无错误）",
      "full_line": "        # → 必须有诊断数据（至少是空数组，表示无错误）"
    },
    {
      "line": 136,
      "type": "single",
      "original": "# → successLines 应该包含所有节点行号（假设无错误）",
      "full_line": "        # → successLines 应该包含所有节点行号（假设无错误）"
    },
    {
      "line": 137,
      "type": "single",
      "original": "# → Monaco 显示绿色对号",
      "full_line": "        # → Monaco 显示绿色对号"
    },
    {
      "line": 139,
      "type": "single",
      "original": "# 场景 2：LSP 停止",
      "full_line": "        # 场景 2：LSP 停止"
    },
    {
      "line": 141,
      "type": "single",
      "original": "# → fileDiagnostics 必须是空 Map",
      "full_line": "        # → fileDiagnostics 必须是空 Map"
    },
    {
      "line": 142,
      "type": "single",
      "original": "# → successLines 必须是空数组",
      "full_line": "        # → successLines 必须是空数组"
    },
    {
      "line": 143,
      "type": "single",
      "original": "# → Monaco 无任何标记",
      "full_line": "        # → Monaco 无任何标记"
    },
    {
      "line": 145,
      "type": "single",
      "original": "# 规范测试",
      "full_line": "        assert True  # 规范测试"
    },
    {
      "line": 153,
      "type": "single",
      "original": "# 错误场景（不允许发生）：",
      "full_line": "        # 错误场景（不允许发生）："
    },
    {
      "line": 154,
      "type": "single",
      "original": "# - LSP 按钮灰色",
      "full_line": "        # - LSP 按钮灰色"
    },
    {
      "line": 155,
      "type": "single",
      "original": "# - 但 Monaco 仍显示绿色对号或错误标记",
      "full_line": "        # - 但 Monaco 仍显示绿色对号或错误标记"
    },
    {
      "line": 157,
      "type": "single",
      "original": "# 正确场景：",
      "full_line": "        # 正确场景："
    },
    {
      "line": 158,
      "type": "single",
      "original": "# - LSP 停止 → 立即清空所有诊断",
      "full_line": "        # - LSP 停止 → 立即清空所有诊断"
    },
    {
      "line": 159,
      "type": "single",
      "original": "# - 无延迟、无残留",
      "full_line": "        # - 无延迟、无残留"
    },
    {
      "line": 161,
      "type": "single",
      "original": "# 规范测试",
      "full_line": "        assert True  # 规范测试"
    },
    {
      "line": 170,
      "type": "single",
      "original": "# 错误场景（不允许发生）：",
      "full_line": "        # 错误场景（不允许发生）："
    },
    {
      "line": 171,
      "type": "single",
      "original": "# - LSP 按钮绿色",
      "full_line": "        # - LSP 按钮绿色"
    },
    {
      "line": 172,
      "type": "single",
      "original": "# - 但 Monaco 无任何显示（既无绿色对号也无错误标记）",
      "full_line": "        # - 但 Monaco 无任何显示（既无绿色对号也无错误标记）"
    },
    {
      "line": 174,
      "type": "single",
      "original": "# 正确场景：",
      "full_line": "        # 正确场景："
    },
    {
      "line": 175,
      "type": "single",
      "original": "# - LSP 运行 → 每个文件都有诊断状态",
      "full_line": "        # - LSP 运行 → 每个文件都有诊断状态"
    },
    {
      "line": 176,
      "type": "single",
      "original": "# - 无错误的文件显示绿色对号",
      "full_line": "        # - 无错误的文件显示绿色对号"
    },
    {
      "line": 177,
      "type": "single",
      "original": "# - 有错误的文件显示错误标记",
      "full_line": "        # - 有错误的文件显示错误标记"
    },
    {
      "line": 179,
      "type": "single",
      "original": "# 规范测试",
      "full_line": "        assert True  # 规范测试"
    },
    {
      "line": 191,
      "type": "single",
      "original": "# 阶段 1：初始状态（LSP 停止）",
      "full_line": "        # 阶段 1：初始状态（LSP 停止）"
    },
    {
      "line": 192,
      "type": "single",
      "original": "# → Monaco 无诊断",
      "full_line": "        # → Monaco 无诊断"
    },
    {
      "line": 194,
      "type": "single",
      "original": "# 阶段 2：启动 LSP",
      "full_line": "        # 阶段 2：启动 LSP"
    },
    {
      "line": 195,
      "type": "single",
      "original": "# → 收到初始诊断",
      "full_line": "        # → 收到初始诊断"
    },
    {
      "line": 196,
      "type": "single",
      "original": "# → Monaco 显示绿色对号（假设无错误）",
      "full_line": "        # → Monaco 显示绿色对号（假设无错误）"
    },
    {
      "line": 198,
      "type": "single",
      "original": "# 阶段 3：停止 LSP",
      "full_line": "        # 阶段 3：停止 LSP"
    },
    {
      "line": 199,
      "type": "single",
      "original": "# → 收到 lsp_stopped",
      "full_line": "        # → 收到 lsp_stopped"
    },
    {
      "line": 200,
      "type": "single",
      "original": "# → Monaco 清空所有显示",
      "full_line": "        # → Monaco 清空所有显示"
    },
    {
      "line": 202,
      "type": "single",
      "original": "# 阶段 4：再次启动 LSP",
      "full_line": "        # 阶段 4：再次启动 LSP"
    },
    {
      "line": 203,
      "type": "single",
      "original": "# → 收到新的初始诊断",
      "full_line": "        # → 收到新的初始诊断"
    },
    {
      "line": 204,
      "type": "single",
      "original": "# → Monaco 重新显示绿色对号",
      "full_line": "        # → Monaco 重新显示绿色对号"
    },
    {
      "line": 206,
      "type": "single",
      "original": "# 规范测试",
      "full_line": "        assert True  # 规范测试"
    },
    {
      "line": 216,
      "type": "single",
      "original": "# 场景：",
      "full_line": "        # 场景："
    },
    {
      "line": 217,
      "type": "single",
      "original": "# 1. 用户启动 LSP",
      "full_line": "        # 1. 用户启动 LSP"
    },
    {
      "line": 218,
      "type": "single",
      "original": "# 2. 用户刷新页面",
      "full_line": "        # 2. 用户刷新页面"
    },
    {
      "line": 219,
      "type": "single",
      "original": "# 3. 前端检测到 LSP 仍在运行（通过 /api/lsp/status）",
      "full_line": "        # 3. 前端检测到 LSP 仍在运行（通过 /api/lsp/status）"
    },
    {
      "line": 220,
      "type": "single",
      "original": "# 4. 前端应该请求诊断数据或等待 WebSocket 推送",
      "full_line": "        # 4. 前端应该请求诊断数据或等待 WebSocket 推送"
    },
    {
      "line": 222,
      "type": "single",
      "original": "# 注意：当前实现依赖 WebSocket 重连后的推送",
      "full_line": "        # 注意：当前实现依赖 WebSocket 重连后的推送"
    },
    {
      "line": 223,
      "type": "single",
      "original": "# 如果 Lean LSP 不主动发送诊断，需要后端主动推送",
      "full_line": "        # 如果 Lean LSP 不主动发送诊断，需要后端主动推送"
    },
    {
      "line": 225,
      "type": "single",
      "original": "# 规范测试",
      "full_line": "        assert True  # 规范测试"
    },
    {
      "line": 231,
      "type": "single",
      "original": "# 场景：",
      "full_line": "        # 场景："
    },
    {
      "line": 232,
      "type": "single",
      "original": "# 1. LSP 从未启动或已停止",
      "full_line": "        # 1. LSP 从未启动或已停止"
    },
    {
      "line": 233,
      "type": "single",
      "original": "# 2. 用户刷新页面",
      "full_line": "        # 2. 用户刷新页面"
    },
    {
      "line": 234,
      "type": "single",
      "original": "# 3. 前端检测到 LSP 未运行",
      "full_line": "        # 3. 前端检测到 LSP 未运行"
    },
    {
      "line": 235,
      "type": "single",
      "original": "# 4. Monaco 不能显示任何诊断标记",
      "full_line": "        # 4. Monaco 不能显示任何诊断标记"
    },
    {
      "line": 237,
      "type": "single",
      "original": "# 规范测试",
      "full_line": "        assert True  # 规范测试"
    },
    {
      "line": 247,
      "type": "single",
      "original": "# 场景：",
      "full_line": "        # 场景："
    },
    {
      "line": 248,
      "type": "single",
      "original": "# 1. LSP 运行中，打开 FileA.lean，显示其诊断",
      "full_line": "        # 1. LSP 运行中，打开 FileA.lean，显示其诊断"
    },
    {
      "line": 249,
      "type": "single",
      "original": "# 2. 切换到 FileB.lean",
      "full_line": "        # 2. 切换到 FileB.lean"
    },
    {
      "line": 250,
      "type": "single",
      "original": "# 3. 必须显示 FileB.lean 的诊断",
      "full_line": "        # 3. 必须显示 FileB.lean 的诊断"
    },
    {
      "line": 251,
      "type": "single",
      "original": "# 4. FileA.lean 的诊断不应该残留",
      "full_line": "        # 4. FileA.lean 的诊断不应该残留"
    },
    {
      "line": 253,
      "type": "single",
      "original": "# 关键：fileDiagnostics Map 应该包含所有文件的诊断",
      "full_line": "        # 关键：fileDiagnostics Map 应该包含所有文件的诊断"
    },
    {
      "line": 254,
      "type": "single",
      "original": "# 切换文件只是更改 selectedNode.leanFilePath",
      "full_line": "        # 切换文件只是更改 selectedNode.leanFilePath"
    },
    {
      "line": 256,
      "type": "single",
      "original": "# 规范测试",
      "full_line": "        assert True  # 规范测试"
    },
    {
      "line": 267,
      "type": "single",
      "original": "# 1. Lean LSP 发送 textDocument/publishDiagnostics",
      "full_line": "        # 1. Lean LSP 发送 textDocument/publishDiagnostics"
    },
    {
      "line": 268,
      "type": "single",
      "original": "# 2. Backend LeanLSPClient._handle_diagnostics 处理",
      "full_line": "        # 2. Backend LeanLSPClient._handle_diagnostics 处理"
    },
    {
      "line": 269,
      "type": "single",
      "original": "# 3. Backend 调用 on_raw_diagnostics 回调",
      "full_line": "        # 3. Backend 调用 on_raw_diagnostics 回调"
    },
    {
      "line": 270,
      "type": "single",
      "original": "# 4. 回调通过 WebSocket 发送 diagnostics_update",
      "full_line": "        # 4. 回调通过 WebSocket 发送 diagnostics_update"
    },
    {
      "line": 271,
      "type": "single",
      "original": "# 5. Frontend useStatusWatch 接收消息",
      "full_line": "        # 5. Frontend useStatusWatch 接收消息"
    },
    {
      "line": 272,
      "type": "single",
      "original": "# 6. Frontend 更新 fileDiagnostics Map",
      "full_line": "        # 6. Frontend 更新 fileDiagnostics Map"
    },
    {
      "line": 273,
      "type": "single",
      "original": "# 7. Monaco useEffect 响应 diagnostics 变化",
      "full_line": "        # 7. Monaco useEffect 响应 diagnostics 变化"
    },
    {
      "line": 274,
      "type": "single",
      "original": "# 8. Monaco setModelMarkers 更新标记",
      "full_line": "        # 8. Monaco setModelMarkers 更新标记"
    },
    {
      "line": 293,
      "type": "single",
      "original": "# successLines 计算规则：",
      "full_line": "        # successLines 计算规则："
    },
    {
      "line": 294,
      "type": "single",
      "original": "# 1. LSP 必须运行中（lspRunning = true）",
      "full_line": "        # 1. LSP 必须运行中（lspRunning = true）"
    },
    {
      "line": 295,
      "type": "single",
      "original": "# 2. 获取当前文件的诊断（fileDiagnostics.get(filePath)）",
      "full_line": "        # 2. 获取当前文件的诊断（fileDiagnostics.get(filePath)）"
    },
    {
      "line": 296,
      "type": "single",
      "original": "# 3. 提取有错误的行号（errorLines）",
      "full_line": "        # 3. 提取有错误的行号（errorLines）"
    },
    {
      "line": 297,
      "type": "single",
      "original": "# 4. 获取当前文件所有节点的行号（nodeLines）",
      "full_line": "        # 4. 获取当前文件所有节点的行号（nodeLines）"
    },
    {
      "line": 298,
      "type": "single",
      "original": "# 5. 过滤掉有错误的行：nodeLines - errorLines",
      "full_line": "        # 5. 过滤掉有错误的行：nodeLines - errorLines"
    },
    {
      "line": 300,
      "type": "single",
      "original": "# 示例：",
      "full_line": "        # 示例："
    },
    {
      "line": 301,
      "type": "single",
      "original": "# 无错误",
      "full_line": "        file_diagnostics = []  # 无错误"
    },
    {
      "line": 302,
      "type": "single",
      "original": "# 三个节点在这些行",
      "full_line": "        node_lines = [10, 25, 40]  # 三个节点在这些行"
    },
    {
      "line": 303,
      "type": "single",
      "original": "# 无错误行",
      "full_line": "        error_lines = set()  # 无错误行"
    },
    {
      "line": 317,
      "type": "single",
      "original": "# 场景：",
      "full_line": "        # 场景："
    },
    {
      "line": 318,
      "type": "single",
      "original": "# 1. LSP 运行中，WebSocket 连接正常",
      "full_line": "        # 1. LSP 运行中，WebSocket 连接正常"
    },
    {
      "line": 319,
      "type": "single",
      "original": "# 2. 网络断开，WebSocket 断开",
      "full_line": "        # 2. 网络断开，WebSocket 断开"
    },
    {
      "line": 320,
      "type": "single",
      "original": "# 3. 网络恢复，WebSocket 自动重连",
      "full_line": "        # 3. 网络恢复，WebSocket 自动重连"
    },
    {
      "line": 321,
      "type": "single",
      "original": "# 4. 重连后，Lean LSP 的新诊断必须能传递到前端",
      "full_line": "        # 4. 重连后，Lean LSP 的新诊断必须能传递到前端"
    },
    {
      "line": 323,
      "type": "single",
      "original": "# 注意：重连后如果 Lean LSP 不主动发送诊断，",
      "full_line": "        # 注意：重连后如果 Lean LSP 不主动发送诊断，"
    },
    {
      "line": 324,
      "type": "single",
      "original": "# 前端可能无法立即看到状态",
      "full_line": "        # 前端可能无法立即看到状态"
    },
    {
      "line": 325,
      "type": "single",
      "original": "# 需要用户编辑代码触发新的诊断",
      "full_line": "        # 需要用户编辑代码触发新的诊断"
    },
    {
      "line": 327,
      "type": "single",
      "original": "# 规范测试",
      "full_line": "        assert True  # 规范测试"
    },
    {
      "line": 337,
      "type": "single",
      "original": "# LSP 启动应该成功，但不发送任何诊断",
      "full_line": "        # LSP 启动应该成功，但不发送任何诊断"
    },
    {
      "line": 338,
      "type": "single",
      "original": "# Monaco 不应该报错",
      "full_line": "        # Monaco 不应该报错"
    },
    {
      "line": 346,
      "type": "single",
      "original": "# 前端状态应该保持 'error' 或 'stopped'",
      "full_line": "        # 前端状态应该保持 'error' 或 'stopped'"
    },
    {
      "line": 347,
      "type": "single",
      "original": "# Monaco 不应该显示任何诊断",
      "full_line": "        # Monaco 不应该显示任何诊断"
    },
    {
      "line": 348,
      "type": "single",
      "original": "# 不能出现半开状态",
      "full_line": "        # 不能出现半开状态"
    },
    {
      "line": 356,
      "type": "single",
      "original": "# 用户快速点击：开 → 关 → 开 → 关",
      "full_line": "        # 用户快速点击：开 → 关 → 开 → 关"
    },
    {
      "line": 357,
      "type": "single",
      "original": "# 每次状态变化必须正确同步",
      "full_line": "        # 每次状态变化必须正确同步"
    },
    {
      "line": 358,
      "type": "single",
      "original": "# 不能出现状态混乱",
      "full_line": "        # 不能出现状态混乱"
    },
    {
      "line": 366,
      "type": "single",
      "original": "# 每个文件独立维护其诊断",
      "full_line": "        # 每个文件独立维护其诊断"
    },
    {
      "line": 367,
      "type": "single",
      "original": "# 切换文件时正确显示对应诊断",
      "full_line": "        # 切换文件时正确显示对应诊断"
    },
    {
      "line": 368,
      "type": "single",
      "original": "# 不能出现诊断混淆",
      "full_line": "        # 不能出现诊断混淆"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\nTest LSP-Monaco Synchronization\n\n严格测试 LSP 状态与 Monaco 诊断显示的同步：\n1. LSP 启动 → Monaco 必须显示诊断\n2. LSP 关闭 → Monaco 必须清空诊断\n3. LSP 重启 → Monaco 必须重新同步\n4. 页面刷新 → Monaco 必须与 LSP 状态一致\n\n核心原则：LSP 状态和 Monaco 显示必须绝对同步，不允许任何不一致\n\"\"\"",
      "full_line": "\"\"\"\nTest LSP-Monaco Synchronization\n\n严格测试 LSP 状态与 Monaco 诊断显示的同步：\n1. LSP 启动 → Monaco 必须显示诊断\n2. LSP 关闭 → Monaco 必须清空诊断\n3. LSP 重启 → Monaco 必须重新同步\n4. 页面刷新 → Monaco 必须与 LSP 状态一致\n\n核心原则：LSP 状态和 Monaco 显示必须绝对同步，不允许任何不一致\n\"\"\""
    },
    {
      "line": 20,
      "type": "docstring",
      "original": "\"\"\"测试 LSP 启动时必须发送诊断\"\"\"",
      "full_line": "    \"\"\"测试 LSP 启动时必须发送诊断\"\"\""
    },
    {
      "line": 24,
      "type": "docstring",
      "original": "        \"\"\"\n        LSP 启动后，必须为每个打开的文件发送初始诊断消息（即使是空的）\n        这确保前端知道文件已被 LSP 处理，可以显示绿色对号\n        \"\"\"",
      "full_line": "        \"\"\"\n        LSP 启动后，必须为每个打开的文件发送初始诊断消息（即使是空的）\n        这确保前端知道文件已被 LSP 处理，可以显示绿色对号\n        \"\"\""
    },
    {
      "line": 62,
      "type": "docstring",
      "original": "        \"\"\"\n        初始诊断消息格式必须正确\n        \"\"\"",
      "full_line": "        \"\"\"\n        初始诊断消息格式必须正确\n        \"\"\""
    },
    {
      "line": 77,
      "type": "docstring",
      "original": "\"\"\"测试 LSP 关闭时必须清空诊断\"\"\"",
      "full_line": "    \"\"\"测试 LSP 关闭时必须清空诊断\"\"\""
    },
    {
      "line": 81,
      "type": "docstring",
      "original": "        \"\"\"\n        LSP 关闭时必须广播 lsp_stopped 消息\n        前端收到后必须清空所有诊断\n        \"\"\"",
      "full_line": "        \"\"\"\n        LSP 关闭时必须广播 lsp_stopped 消息\n        前端收到后必须清空所有诊断\n        \"\"\""
    },
    {
      "line": 110,
      "type": "docstring",
      "original": "        \"\"\"\n        前端收到 lsp_stopped 后必须执行的清理操作\n        \"\"\"",
      "full_line": "        \"\"\"\n        前端收到 lsp_stopped 后必须执行的清理操作\n        \"\"\""
    },
    {
      "line": 124,
      "type": "docstring",
      "original": "\"\"\"测试 LSP 和 Monaco 的严格同步\"\"\"",
      "full_line": "    \"\"\"测试 LSP 和 Monaco 的严格同步\"\"\""
    },
    {
      "line": 127,
      "type": "docstring",
      "original": "        \"\"\"\n        不变式：LSP 开启 ⟺ Monaco 诊断可见\n\n        如果 LSP 按钮是绿色（运行中），Monaco 必须显示诊断\n        如果 LSP 按钮是灰色（停止），Monaco 必须无诊断显示\n        \"\"\"",
      "full_line": "        \"\"\"\n        不变式：LSP 开启 ⟺ Monaco 诊断可见\n\n        如果 LSP 按钮是绿色（运行中），Monaco 必须显示诊断\n        如果 LSP 按钮是灰色（停止），Monaco 必须无诊断显示\n        \"\"\""
    },
    {
      "line": 148,
      "type": "docstring",
      "original": "        \"\"\"\n        不变式：LSP 停止时不能有任何诊断显示\n\n        即使之前有诊断数据，LSP 停止后必须全部清空\n        \"\"\"",
      "full_line": "        \"\"\"\n        不变式：LSP 停止时不能有任何诊断显示\n\n        即使之前有诊断数据，LSP 停止后必须全部清空\n        \"\"\""
    },
    {
      "line": 164,
      "type": "docstring",
      "original": "        \"\"\"\n        不变式：LSP 运行时不能缺少诊断显示\n\n        如果 LSP 在运行，每个打开的文件必须有诊断状态\n        （空数组表示无错误，非空表示有错误）\n        \"\"\"",
      "full_line": "        \"\"\"\n        不变式：LSP 运行时不能缺少诊断显示\n\n        如果 LSP 在运行，每个打开的文件必须有诊断状态\n        （空数组表示无错误，非空表示有错误）\n        \"\"\""
    },
    {
      "line": 183,
      "type": "docstring",
      "original": "\"\"\"测试 LSP 重启场景\"\"\"",
      "full_line": "    \"\"\"测试 LSP 重启场景\"\"\""
    },
    {
      "line": 186,
      "type": "docstring",
      "original": "        \"\"\"\n        测试 LSP 重启周期：启动 → 停止 → 再启动\n\n        每个阶段 Monaco 状态必须正确同步\n        \"\"\"",
      "full_line": "        \"\"\"\n        测试 LSP 重启周期：启动 → 停止 → 再启动\n\n        每个阶段 Monaco 状态必须正确同步\n        \"\"\""
    },
    {
      "line": 210,
      "type": "docstring",
      "original": "\"\"\"测试页面刷新时的 LSP 状态恢复\"\"\"",
      "full_line": "    \"\"\"测试页面刷新时的 LSP 状态恢复\"\"\""
    },
    {
      "line": 213,
      "type": "docstring",
      "original": "        \"\"\"\n        页面刷新时，如果后端 LSP 仍在运行，前端必须恢复诊断显示\n        \"\"\"",
      "full_line": "        \"\"\"\n        页面刷新时，如果后端 LSP 仍在运行，前端必须恢复诊断显示\n        \"\"\""
    },
    {
      "line": 228,
      "type": "docstring",
      "original": "        \"\"\"\n        页面刷新时，如果后端 LSP 未运行，前端不能显示任何诊断\n        \"\"\"",
      "full_line": "        \"\"\"\n        页面刷新时，如果后端 LSP 未运行，前端不能显示任何诊断\n        \"\"\""
    },
    {
      "line": 241,
      "type": "docstring",
      "original": "\"\"\"测试 LSP 运行时切换文件\"\"\"",
      "full_line": "    \"\"\"测试 LSP 运行时切换文件\"\"\""
    },
    {
      "line": 244,
      "type": "docstring",
      "original": "        \"\"\"\n        LSP 运行时切换文件，必须显示该文件的诊断\n        \"\"\"",
      "full_line": "        \"\"\"\n        LSP 运行时切换文件，必须显示该文件的诊断\n        \"\"\""
    },
    {
      "line": 260,
      "type": "docstring",
      "original": "\"\"\"测试诊断更新流程\"\"\"",
      "full_line": "    \"\"\"测试诊断更新流程\"\"\""
    },
    {
      "line": 263,
      "type": "docstring",
      "original": "        \"\"\"\n        诊断更新的完整流程：\n        Lean LSP → Backend → WebSocket → Frontend → Monaco\n        \"\"\"",
      "full_line": "        \"\"\"\n        诊断更新的完整流程：\n        Lean LSP → Backend → WebSocket → Frontend → Monaco\n        \"\"\""
    },
    {
      "line": 290,
      "type": "docstring",
      "original": "        \"\"\"\n        测试绿色对号（successLines）的计算逻辑\n        \"\"\"",
      "full_line": "        \"\"\"\n        测试绿色对号（successLines）的计算逻辑\n        \"\"\""
    },
    {
      "line": 311,
      "type": "docstring",
      "original": "\"\"\"测试 WebSocket 重连场景\"\"\"",
      "full_line": "    \"\"\"测试 WebSocket 重连场景\"\"\""
    },
    {
      "line": 314,
      "type": "docstring",
      "original": "        \"\"\"\n        WebSocket 断开重连后，必须能收到诊断更新\n        \"\"\"",
      "full_line": "        \"\"\"\n        WebSocket 断开重连后，必须能收到诊断更新\n        \"\"\""
    },
    {
      "line": 331,
      "type": "docstring",
      "original": "\"\"\"测试边界情况\"\"\"",
      "full_line": "    \"\"\"测试边界情况\"\"\""
    },
    {
      "line": 334,
      "type": "docstring",
      "original": "        \"\"\"\n        项目无 .lean 文件时的处理\n        \"\"\"",
      "full_line": "        \"\"\"\n        项目无 .lean 文件时的处理\n        \"\"\""
    },
    {
      "line": 343,
      "type": "docstring",
      "original": "        \"\"\"\n        LSP 启动失败时的处理\n        \"\"\"",
      "full_line": "        \"\"\"\n        LSP 启动失败时的处理\n        \"\"\""
    },
    {
      "line": 353,
      "type": "docstring",
      "original": "        \"\"\"\n        快速切换 LSP 开关的处理\n        \"\"\"",
      "full_line": "        \"\"\"\n        快速切换 LSP 开关的处理\n        \"\"\""
    },
    {
      "line": 363,
      "type": "docstring",
      "original": "        \"\"\"\n        多个文件同时有诊断时的处理\n        \"\"\"",
      "full_line": "        \"\"\"\n        多个文件同时有诊断时的处理\n        \"\"\""
    }
  ],
  "backend/tests/test_api_stability.py": [
    {
      "line": 20,
      "type": "single",
      "original": "# 并发请求测试",
      "full_line": "# 并发请求测试"
    },
    {
      "line": 55,
      "type": "single",
      "original": "# 创建测试文件",
      "full_line": "        # 创建测试文件"
    },
    {
      "line": 86,
      "type": "single",
      "original": "# 创建测试项目结构",
      "full_line": "        # 创建测试项目结构"
    },
    {
      "line": 134,
      "type": "single",
      "original": "# 按类型统计成功率",
      "full_line": "        # 按类型统计成功率"
    },
    {
      "line": 149,
      "type": "single",
      "original": "# WebSocket 稳定性测试",
      "full_line": "# WebSocket 稳定性测试"
    },
    {
      "line": 160,
      "type": "single",
      "original": "# 创建测试项目",
      "full_line": "        # 创建测试项目"
    },
    {
      "line": 173,
      "type": "single",
      "original": "# 接收连接确认",
      "full_line": "                    # 接收连接确认"
    },
    {
      "line": 242,
      "type": "single",
      "original": "# 响应时间测试",
      "full_line": "# 响应时间测试"
    },
    {
      "line": 274,
      "type": "single",
      "original": "# 创建一个较大的测试文件",
      "full_line": "        # 创建一个较大的测试文件"
    },
    {
      "line": 299,
      "type": "single",
      "original": "# 错误恢复测试",
      "full_line": "# 错误恢复测试"
    },
    {
      "line": 312,
      "type": "single",
      "original": "# 测试各种无效路径",
      "full_line": "        # 测试各种无效路径"
    },
    {
      "line": 324,
      "type": "single",
      "original": "# 应该返回错误状态码，而不是崩溃",
      "full_line": "                # 应该返回错误状态码，而不是崩溃"
    },
    {
      "line": 329,
      "type": "single",
      "original": "# 确认服务仍然正常工作",
      "full_line": "        # 确认服务仍然正常工作"
    },
    {
      "line": 340,
      "type": "single",
      "original": "# 发送畸形 JSON",
      "full_line": "        # 发送畸形 JSON"
    },
    {
      "line": 360,
      "type": "single",
      "original": "# 确认服务仍然正常工作",
      "full_line": "        # 确认服务仍然正常工作"
    },
    {
      "line": 371,
      "type": "single",
      "original": "# 1. 正常请求",
      "full_line": "        # 1. 正常请求"
    },
    {
      "line": 375,
      "type": "single",
      "original": "# 2. 触发错误",
      "full_line": "        # 2. 触发错误"
    },
    {
      "line": 379,
      "type": "single",
      "original": "# 3. 再次正常请求",
      "full_line": "        # 3. 再次正常请求"
    },
    {
      "line": 383,
      "type": "single",
      "original": "# 4. 创建有效文件并读取",
      "full_line": "        # 4. 创建有效文件并读取"
    },
    {
      "line": 392,
      "type": "single",
      "original": "# 内存泄漏检测",
      "full_line": "# 内存泄漏检测"
    },
    {
      "line": 403,
      "type": "single",
      "original": "# 创建测试项目",
      "full_line": "        # 创建测试项目"
    },
    {
      "line": 412,
      "type": "single",
      "original": "# 记录初始项目数",
      "full_line": "        # 记录初始项目数"
    },
    {
      "line": 415,
      "type": "single",
      "original": "# 多次加载同一项目",
      "full_line": "        # 多次加载同一项目"
    },
    {
      "line": 421,
      "type": "single",
      "original": "# 可能成功或失败（取决于项目是否有效），但不应崩溃",
      "full_line": "            # 可能成功或失败（取决于项目是否有效），但不应崩溃"
    },
    {
      "line": 423,
      "type": "single",
      "original": "# 项目数不应无限增长（同一项目应该被复用或替换）",
      "full_line": "        # 项目数不应无限增长（同一项目应该被复用或替换）"
    },
    {
      "line": 430,
      "type": "single",
      "original": "# 超时测试",
      "full_line": "# 超时测试"
    },
    {
      "line": 441,
      "type": "single",
      "original": "# 创建一个非常大的文件",
      "full_line": "        # 创建一个非常大的文件"
    },
    {
      "line": 443,
      "type": "single",
      "original": "# 100,000 行，每行约 50 字符",
      "full_line": "        # 100,000 行，每行约 50 字符"
    },
    {
      "line": 455,
      "type": "single",
      "original": "# 即使读取全部内容，也应该在合理时间内完成",
      "full_line": "        # 即使读取全部内容，也应该在合理时间内完成"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\nAPI 稳定性测试\n\n测试后端 API 在各种负载和并发条件下的稳定性：\n1. 并发请求处理\n2. WebSocket 连接稳定性\n3. 长时间运行稳定性\n4. 错误恢复能力\n\"\"\"",
      "full_line": "\"\"\"\nAPI 稳定性测试\n\n测试后端 API 在各种负载和并发条件下的稳定性：\n1. 并发请求处理\n2. WebSocket 连接稳定性\n3. 长时间运行稳定性\n4. 错误恢复能力\n\"\"\""
    },
    {
      "line": 24,
      "type": "docstring",
      "original": "\"\"\"测试 API 在并发请求下的稳定性\"\"\"",
      "full_line": "    \"\"\"测试 API 在并发请求下的稳定性\"\"\""
    },
    {
      "line": 27,
      "type": "docstring",
      "original": "\"\"\"并发 health check 请求\"\"\"",
      "full_line": "        \"\"\"并发 health check 请求\"\"\""
    },
    {
      "line": 51,
      "type": "docstring",
      "original": "\"\"\"并发文件读取请求\"\"\"",
      "full_line": "        \"\"\"并发文件读取请求\"\"\""
    },
    {
      "line": 82,
      "type": "docstring",
      "original": "\"\"\"混合并发操作（读文件、health check、project status）\"\"\"",
      "full_line": "        \"\"\"混合并发操作（读文件、health check、project status）\"\"\""
    },
    {
      "line": 153,
      "type": "docstring",
      "original": "\"\"\"测试 WebSocket 连接的稳定性\"\"\"",
      "full_line": "    \"\"\"测试 WebSocket 连接的稳定性\"\"\""
    },
    {
      "line": 156,
      "type": "docstring",
      "original": "\"\"\"WebSocket 连接断开循环测试\"\"\"",
      "full_line": "        \"\"\"WebSocket 连接断开循环测试\"\"\""
    },
    {
      "line": 184,
      "type": "docstring",
      "original": "\"\"\"多客户端同时连接 WebSocket\"\"\"",
      "full_line": "        \"\"\"多客户端同时连接 WebSocket\"\"\""
    },
    {
      "line": 215,
      "type": "docstring",
      "original": "\"\"\"Status WebSocket 连接稳定性\"\"\"",
      "full_line": "        \"\"\"Status WebSocket 连接稳定性\"\"\""
    },
    {
      "line": 246,
      "type": "docstring",
      "original": "\"\"\"测试 API 响应时间\"\"\"",
      "full_line": "    \"\"\"测试 API 响应时间\"\"\""
    },
    {
      "line": 249,
      "type": "docstring",
      "original": "\"\"\"Health check 应该在 100ms 内响应\"\"\"",
      "full_line": "        \"\"\"Health check 应该在 100ms 内响应\"\"\""
    },
    {
      "line": 270,
      "type": "docstring",
      "original": "\"\"\"文件读取应该在 200ms 内响应\"\"\"",
      "full_line": "        \"\"\"文件读取应该在 200ms 内响应\"\"\""
    },
    {
      "line": 303,
      "type": "docstring",
      "original": "\"\"\"测试 API 的错误恢复能力\"\"\"",
      "full_line": "    \"\"\"测试 API 的错误恢复能力\"\"\""
    },
    {
      "line": 306,
      "type": "docstring",
      "original": "\"\"\"处理无效路径时不应崩溃\"\"\"",
      "full_line": "        \"\"\"处理无效路径时不应崩溃\"\"\""
    },
    {
      "line": 334,
      "type": "docstring",
      "original": "\"\"\"处理畸形 JSON 时不应崩溃\"\"\"",
      "full_line": "        \"\"\"处理畸形 JSON 时不应崩溃\"\"\""
    },
    {
      "line": 365,
      "type": "docstring",
      "original": "\"\"\"错误后服务应能正常恢复\"\"\"",
      "full_line": "        \"\"\"错误后服务应能正常恢复\"\"\""
    },
    {
      "line": 396,
      "type": "docstring",
      "original": "\"\"\"测试内存使用稳定性\"\"\"",
      "full_line": "    \"\"\"测试内存使用稳定性\"\"\""
    },
    {
      "line": 399,
      "type": "docstring",
      "original": "\"\"\"重复加载项目不应导致内存泄漏\"\"\"",
      "full_line": "        \"\"\"重复加载项目不应导致内存泄漏\"\"\""
    },
    {
      "line": 434,
      "type": "docstring",
      "original": "\"\"\"测试请求超时处理\"\"\"",
      "full_line": "    \"\"\"测试请求超时处理\"\"\""
    },
    {
      "line": 437,
      "type": "docstring",
      "original": "\"\"\"大文件读取应该有合理的超时\"\"\"",
      "full_line": "        \"\"\"大文件读取应该有合理的超时\"\"\""
    }
  ],
  "backend/tests/test_file_api.py": [
    {
      "line": 40,
      "type": "single",
      "original": "# 创建测试文件",
      "full_line": "        # 创建测试文件"
    },
    {
      "line": 58,
      "type": "single",
      "original": "# 不能小于 1",
      "full_line": "        assert result[\"startLine\"] == 1  # 不能小于 1"
    },
    {
      "line": 70,
      "type": "single",
      "original": "# 不能超过总行数",
      "full_line": "        assert result[\"endLine\"] == 20  # 不能超过总行数"
    },
    {
      "line": 96,
      "type": "single",
      "original": "# 即使文件存在，也应该通过其他机制限制（这里只测试逻辑层）",
      "full_line": "        # 即使文件存在，也应该通过其他机制限制（这里只测试逻辑层）"
    },
    {
      "line": 97,
      "type": "single",
      "original": "# 实际的安全限制应在 API 层实现",
      "full_line": "        # 实际的安全限制应在 API 层实现"
    },
    {
      "line": 99,
      "type": "single",
      "original": "# 如果能读取，说明需要在 API 层添加路径白名单限制",
      "full_line": "        # 如果能读取，说明需要在 API 层添加路径白名单限制"
    },
    {
      "line": 100,
      "type": "single",
      "original": "# 当前逻辑层不做限制，标记为已知行为",
      "full_line": "        assert result is not None  # 当前逻辑层不做限制，标记为已知行为"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\n测试 /api/file 端点的文件读取逻辑\n\"\"\"",
      "full_line": "\"\"\"\n测试 /api/file 端点的文件读取逻辑\n\"\"\""
    },
    {
      "line": 11,
      "type": "docstring",
      "original": "\"\"\"模拟 server.py 中 read_file 的核心逻辑\"\"\"",
      "full_line": "    \"\"\"模拟 server.py 中 read_file 的核心逻辑\"\"\""
    },
    {
      "line": 36,
      "type": "docstring",
      "original": "\"\"\"测试文件读取逻辑\"\"\"",
      "full_line": "    \"\"\"测试文件读取逻辑\"\"\""
    },
    {
      "line": 39,
      "type": "docstring",
      "original": "\"\"\"基本文件读取\"\"\"",
      "full_line": "        \"\"\"基本文件读取\"\"\""
    },
    {
      "line": 52,
      "type": "docstring",
      "original": "\"\"\"目标行在文件开头\"\"\"",
      "full_line": "        \"\"\"目标行在文件开头\"\"\""
    },
    {
      "line": 63,
      "type": "docstring",
      "original": "\"\"\"目标行在文件末尾\"\"\"",
      "full_line": "        \"\"\"目标行在文件末尾\"\"\""
    },
    {
      "line": 74,
      "type": "docstring",
      "original": "\"\"\"小文件（行数少于 context）\"\"\"",
      "full_line": "        \"\"\"小文件（行数少于 context）\"\"\""
    },
    {
      "line": 85,
      "type": "docstring",
      "original": "\"\"\"文件不存在\"\"\"",
      "full_line": "        \"\"\"文件不存在\"\"\""
    },
    {
      "line": 90,
      "type": "docstring",
      "original": "\"\"\"防止路径遍历攻击\"\"\"",
      "full_line": "        \"\"\"防止路径遍历攻击\"\"\""
    },
    {
      "line": 95,
      "type": "docstring",
      "original": "\"\"\"防止访问敏感系统文件\"\"\"",
      "full_line": "        \"\"\"防止访问敏感系统文件\"\"\""
    },
    {
      "line": 103,
      "type": "docstring",
      "original": "\"\"\"Lean 语法内容\"\"\"",
      "full_line": "        \"\"\"Lean 语法内容\"\"\""
    },
    {
      "line": 121,
      "type": "docstring",
      "original": "\"\"\"测试真实的 Lean 文件（如果存在）\"\"\"",
      "full_line": "    \"\"\"测试真实的 Lean 文件（如果存在）\"\"\""
    },
    {
      "line": 128,
      "type": "docstring",
      "original": "\"\"\"测试 sphere-eversion 项目中的文件\"\"\"",
      "full_line": "        \"\"\"测试 sphere-eversion 项目中的文件\"\"\""
    }
  ],
  "backend/tests/test_graph_selection.py": [
    {
      "line": 27,
      "type": "single",
      "original": "# 添加一些节点",
      "full_line": "        # 添加一些节点"
    },
    {
      "line": 35,
      "type": "single",
      "original": "# 模拟选择操作 - 只是读取，不修改",
      "full_line": "        # 模拟选择操作 - 只是读取，不修改"
    },
    {
      "line": 36,
      "type": "single",
      "original": "# 前端的 selectedNodeId 是纯前端状态",
      "full_line": "        # 前端的 selectedNodeId 是纯前端状态"
    },
    {
      "line": 38,
      "type": "single",
      "original": "# 模拟快速切换选择",
      "full_line": "            # 模拟快速切换选择"
    },
    {
      "line": 42,
      "type": "single",
      "original": "# 验证画布状态未变",
      "full_line": "        # 验证画布状态未变"
    },
    {
      "line": 58,
      "type": "single",
      "original": "# 添加节点",
      "full_line": "        # 添加节点"
    },
    {
      "line": 62,
      "type": "single",
      "original": "# 选中 node_1 - 前端状态",
      "full_line": "        # 选中 node_1 - 前端状态"
    },
    {
      "line": 65,
      "type": "single",
      "original": "# 验证 node_1 在画布上",
      "full_line": "        # 验证 node_1 在画布上"
    },
    {
      "line": 69,
      "type": "single",
      "original": "# 移除 node_1 - 这会影响画布，前端应该清除选择",
      "full_line": "        # 移除 node_1 - 这会影响画布，前端应该清除选择"
    },
    {
      "line": 73,
      "type": "single",
      "original": "# 前端应该检测到并清除 selectedNodeId",
      "full_line": "        # 前端应该检测到并清除 selectedNodeId"
    },
    {
      "line": 74,
      "type": "single",
      "original": "# 这是前端逻辑：if selectedNode?.id === removedNodeId: setSelectedNode(null)",
      "full_line": "        # 这是前端逻辑：if selectedNode?.id === removedNodeId: setSelectedNode(null)"
    },
    {
      "line": 85,
      "type": "single",
      "original": "# 快速添加多个节点",
      "full_line": "        # 快速添加多个节点"
    },
    {
      "line": 93,
      "type": "single",
      "original": "# 快速移除一半",
      "full_line": "        # 快速移除一半"
    },
    {
      "line": 100,
      "type": "single",
      "original": "# 验证正确的节点被保留",
      "full_line": "        # 验证正确的节点被保留"
    },
    {
      "line": 114,
      "type": "single",
      "original": "# 添加节点",
      "full_line": "        # 添加节点"
    },
    {
      "line": 118,
      "type": "single",
      "original": "# 设置位置（模拟力导向布局稳定后的 3D 位置）",
      "full_line": "        # 设置位置（模拟力导向布局稳定后的 3D 位置）"
    },
    {
      "line": 122,
      "type": "single",
      "original": "# 多次加载（模拟选择变化导致的重新渲染）",
      "full_line": "        # 多次加载（模拟选择变化导致的重新渲染）"
    },
    {
      "line": 135,
      "type": "single",
      "original": "# 添加节点",
      "full_line": "        # 添加节点"
    },
    {
      "line": 139,
      "type": "single",
      "original": "# 模拟点击空白处 - 前端 onNodeClick(null)",
      "full_line": "        # 模拟点击空白处 - 前端 onNodeClick(null)"
    },
    {
      "line": 140,
      "type": "single",
      "original": "# 这只是清空 selectedNode，不影响画布",
      "full_line": "        # 这只是清空 selectedNode，不影响画布"
    },
    {
      "line": 162,
      "type": "single",
      "original": "# 连续加载多次",
      "full_line": "        # 连续加载多次"
    },
    {
      "line": 165,
      "type": "single",
      "original": "# 所有结果应该一致",
      "full_line": "        # 所有结果应该一致"
    },
    {
      "line": 179,
      "type": "single",
      "original": "# 按顺序添加",
      "full_line": "        # 按顺序添加"
    },
    {
      "line": 186,
      "type": "single",
      "original": "# 重新加载后顺序应该一致",
      "full_line": "        # 重新加载后顺序应该一致"
    },
    {
      "line": 203,
      "type": "single",
      "original": "# 添加可能有自引用的节点",
      "full_line": "        # 添加可能有自引用的节点"
    },
    {
      "line": 260,
      "type": "single",
      "original": "# 快速添加/移除同一节点",
      "full_line": "        # 快速添加/移除同一节点"
    },
    {
      "line": 267,
      "type": "single",
      "original": "# 最终状态：偶数次添加，奇数次移除",
      "full_line": "        # 最终状态：偶数次添加，奇数次移除"
    },
    {
      "line": 269,
      "type": "single",
      "original": "# 最终应该不在列表中",
      "full_line": "        # 最终应该不在列表中"
    },
    {
      "line": 280,
      "type": "single",
      "original": "# 交错添加和移除",
      "full_line": "        # 交错添加和移除"
    },
    {
      "line": 285,
      "type": "single",
      "original": "# 重新添加",
      "full_line": "        store.add_node(\"node_1\")  # 重新添加"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\n测试图节点选择相关的场景\n\n模拟 2D/3D 图中的节点选择行为：\n- 节点选择不应该影响画布状态\n- 快速切换选择不应该导致数据丢失\n- 选择状态与画布可见性应该独立\n\"\"\"",
      "full_line": "\"\"\"\n测试图节点选择相关的场景\n\n模拟 2D/3D 图中的节点选择行为：\n- 节点选择不应该影响画布状态\n- 快速切换选择不应该导致数据丢失\n- 选择状态与画布可见性应该独立\n\"\"\""
    },
    {
      "line": 15,
      "type": "docstring",
      "original": "\"\"\"测试节点选择场景 - 模拟前端 3D 图的行为\"\"\"",
      "full_line": "    \"\"\"测试节点选择场景 - 模拟前端 3D 图的行为\"\"\""
    },
    {
      "line": 18,
      "type": "docstring",
      "original": "        \"\"\"\n        节点选择不应该修改画布状态\n\n        前端行为：点击节点只更新 selectedNodeId，\n        不应该触发 canvas API 调用\n        \"\"\"",
      "full_line": "        \"\"\"\n        节点选择不应该修改画布状态\n\n        前端行为：点击节点只更新 selectedNodeId，\n        不应该触发 canvas API 调用\n        \"\"\""
    },
    {
      "line": 47,
      "type": "docstring",
      "original": "        \"\"\"\n        选择状态和可见性应该是独立的\n\n        用户可以：\n        - 选中一个可见节点\n        - 取消选中但保持可见\n        - 移除节点（同时清除选择）\n        \"\"\"",
      "full_line": "        \"\"\"\n        选择状态和可见性应该是独立的\n\n        用户可以：\n        - 选中一个可见节点\n        - 取消选中但保持可见\n        - 移除节点（同时清除选择）\n        \"\"\""
    },
    {
      "line": 77,
      "type": "docstring",
      "original": "        \"\"\"\n        快速添加/移除操作不应该丢失节点\n\n        模拟用户快速点击添加/移除按钮的场景\n        \"\"\"",
      "full_line": "        \"\"\"\n        快速添加/移除操作不应该丢失节点\n\n        模拟用户快速点击添加/移除按钮的场景\n        \"\"\""
    },
    {
      "line": 105,
      "type": "docstring",
      "original": "        \"\"\"\n        选择变化时位置应该保持不变\n\n        3D 图的力导向布局会持续更新位置，\n        但选择操作不应该重置位置\n        \"\"\"",
      "full_line": "        \"\"\"\n        选择变化时位置应该保持不变\n\n        3D 图的力导向布局会持续更新位置，\n        但选择操作不应该重置位置\n        \"\"\""
    },
    {
      "line": 129,
      "type": "docstring",
      "original": "        \"\"\"\n        清空选择（点击空白处）不应该清空画布\n        \"\"\"",
      "full_line": "        \"\"\"\n        清空选择（点击空白处）不应该清空画布\n        \"\"\""
    },
    {
      "line": 147,
      "type": "docstring",
      "original": "\"\"\"测试图数据的稳定性 - 防止不必要的重新渲染\"\"\"",
      "full_line": "    \"\"\"测试图数据的稳定性 - 防止不必要的重新渲染\"\"\""
    },
    {
      "line": 150,
      "type": "docstring",
      "original": "        \"\"\"\n        连续加载应该返回一致的数据\n\n        这对于前端的 useMemo 稳定性很重要\n        \"\"\"",
      "full_line": "        \"\"\"\n        连续加载应该返回一致的数据\n\n        这对于前端的 useMemo 稳定性很重要\n        \"\"\""
    },
    {
      "line": 171,
      "type": "docstring",
      "original": "        \"\"\"\n        节点顺序应该保持一致\n\n        这影响前端的 key 稳定性计算\n        \"\"\"",
      "full_line": "        \"\"\"\n        节点顺序应该保持一致\n\n        这影响前端的 key 稳定性计算\n        \"\"\""
    },
    {
      "line": 192,
      "type": "docstring",
      "original": "\"\"\"图渲染相关的边界情况\"\"\"",
      "full_line": "    \"\"\"图渲染相关的边界情况\"\"\""
    },
    {
      "line": 195,
      "type": "docstring",
      "original": "        \"\"\"\n        自引用节点（边的 source 和 target 相同）\n\n        这在 Lean 中可能出现（递归定理）\n        \"\"\"",
      "full_line": "        \"\"\"\n        自引用节点（边的 source 和 target 相同）\n\n        这在 Lean 中可能出现（递归定理）\n        \"\"\""
    },
    {
      "line": 210,
      "type": "docstring",
      "original": "        \"\"\"\n        超长节点名称\n\n        Lean 的完全限定名可能很长\n        \"\"\"",
      "full_line": "        \"\"\"\n        超长节点名称\n\n        Lean 的完全限定名可能很长\n        \"\"\""
    },
    {
      "line": 225,
      "type": "docstring",
      "original": "        \"\"\"\n        节点名包含特殊字符\n\n        Lean 支持 Unicode 标识符\n        \"\"\"",
      "full_line": "        \"\"\"\n        节点名包含特殊字符\n\n        Lean 支持 Unicode 标识符\n        \"\"\""
    },
    {
      "line": 249,
      "type": "docstring",
      "original": "\"\"\"并发访问测试 - 模拟前端快速操作\"\"\"",
      "full_line": "    \"\"\"并发访问测试 - 模拟前端快速操作\"\"\""
    },
    {
      "line": 252,
      "type": "docstring",
      "original": "        \"\"\"\n        快速切换同一节点的可见性\n\n        模拟用户快速双击的场景\n        \"\"\"",
      "full_line": "        \"\"\"\n        快速切换同一节点的可见性\n\n        模拟用户快速双击的场景\n        \"\"\""
    },
    {
      "line": 274,
      "type": "docstring",
      "original": "        \"\"\"\n        多个节点交错操作\n        \"\"\"",
      "full_line": "        \"\"\"\n        多个节点交错操作\n        \"\"\""
    }
  ],
  "backend/tests/test_lsp_state_sync.py": [
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\nTest LSP State Synchronization\n\nTests for unified LSP state management:\n1. LSP 关闭时，应该广播 \"lsp_stopped\" 消息，通知前端清空所有状态\n2. LSP 开启时，状态由 LSP 实时更新\n3. 节点状态环和 Monaco 诊断统一由 LSP 控制\n\"\"\"",
      "full_line": "\"\"\"\nTest LSP State Synchronization\n\nTests for unified LSP state management:\n1. LSP 关闭时，应该广播 \"lsp_stopped\" 消息，通知前端清空所有状态\n2. LSP 开启时，状态由 LSP 实时更新\n3. 节点状态环和 Monaco 诊断统一由 LSP 控制\n\"\"\""
    }
  ],
  "backend/tests/test_line_number_accuracy.py": [
    {
      "line": 65,
      "type": "single",
      "original": "# 找到 'theorem simple_theorem' 所在行",
      "full_line": "        # 找到 'theorem simple_theorem' 所在行"
    },
    {
      "line": 68,
      "type": "single",
      "original": "# 转为 1-indexed",
      "full_line": "                expected_line = i + 1  # 转为 1-indexed"
    },
    {
      "line": 73,
      "type": "single",
      "original": "# 模拟 .ilean 返回的 definition 位置",
      "full_line": "        # 模拟 .ilean 返回的 definition 位置"
    },
    {
      "line": 74,
      "type": "single",
      "original": "# 通常指向声明名字的位置",
      "full_line": "        # 通常指向声明名字的位置"
    },
    {
      "line": 79,
      "type": "single",
      "original": "# 验证 find_declaration_start 能找到正确的行",
      "full_line": "        # 验证 find_declaration_start 能找到正确的行"
    },
    {
      "line": 82,
      "type": "single",
      "original": "# 应该返回同一行（因为 theorem 和名字在同一行）",
      "full_line": "        # 应该返回同一行（因为 theorem 和名字在同一行）"
    },
    {
      "line": 98,
      "type": "single",
      "original": "# 找到 'theorem with_attribute' 所在行",
      "full_line": "        # 找到 'theorem with_attribute' 所在行"
    },
    {
      "line": 109,
      "type": "single",
      "original": "# 假设 .ilean 的 definition 指向名字 'with_attribute'",
      "full_line": "        # 假设 .ilean 的 definition 指向名字 'with_attribute'"
    },
    {
      "line": 110,
      "type": "single",
      "original": "# 我们需要验证 find_declaration_start 能正确找到 'theorem' 行",
      "full_line": "        # 我们需要验证 find_declaration_start 能正确找到 'theorem' 行"
    },
    {
      "line": 130,
      "type": "single",
      "original": "# 找到 'theorem multiline_doc' 所在行",
      "full_line": "        # 找到 'theorem multiline_doc' 所在行"
    },
    {
      "line": 159,
      "type": "single",
      "original": "# 找到 'theorem long_signature' 所在行",
      "full_line": "        # 找到 'theorem long_signature' 所在行"
    },
    {
      "line": 170,
      "type": "single",
      "original": "# 测试：如果 .ilean 指向签名中的某一行（比如 h : x < y 那行）",
      "full_line": "        # 测试：如果 .ilean 指向签名中的某一行（比如 h : x < y 那行）"
    },
    {
      "line": 171,
      "type": "single",
      "original": "# find_declaration_start 应该能向上找到 'theorem' 行",
      "full_line": "        # find_declaration_start 应该能向上找到 'theorem' 行"
    },
    {
      "line": 172,
      "type": "single",
      "original": "# (h : x < y) 那行",
      "full_line": "        signature_middle_line = theorem_line + 2  # (h : x < y) 那行"
    },
    {
      "line": 191,
      "type": "single",
      "original": "# 假设 'simple' 名字在第 5 行（0-indexed=4），第 8 列",
      "full_line": "                # 假设 'simple' 名字在第 5 行（0-indexed=4），第 8 列"
    },
    {
      "line": 198,
      "type": "single",
      "original": "# 假设名字在第 7 行，但 theorem 关键字在第 6 行",
      "full_line": "                # 假设名字在第 7 行，但 theorem 关键字在第 6 行"
    },
    {
      "line": 200,
      "type": "single",
      "original": "# 名字在第 8 行（0-indexed=7）",
      "full_line": "                    \"definition\": [7, 2, 7, 28],  # 名字在第 8 行（0-indexed=7）"
    },
    {
      "line": 214,
      "type": "single",
      "original": "# 创建 .ilean 文件",
      "full_line": "        # 创建 .ilean 文件"
    },
    {
      "line": 219,
      "type": "single",
      "original": "# 创建源文件",
      "full_line": "        # 创建源文件"
    },
    {
      "line": 236,
      "type": "single",
      "original": "# 找到 simple 节点",
      "full_line": "        # 找到 simple 节点"
    },
    {
      "line": 240,
      "type": "single",
      "original": "# 验证是 1-indexed",
      "full_line": "        # 验证是 1-indexed"
    },
    {
      "line": 254,
      "type": "single",
      "original": "# 这是一个文档测试，验证 API 契约",
      "full_line": "        # 这是一个文档测试，验证 API 契约"
    },
    {
      "line": 255,
      "type": "single",
      "original": "# 实际测试需要启动后端服务器",
      "full_line": "        # 实际测试需要启动后端服务器"
    },
    {
      "line": 264,
      "type": "single",
      "original": "# 必须是 1-indexed 整数 > 0",
      "full_line": "                    \"lineNumber\": 10,  # 必须是 1-indexed 整数 > 0"
    },
    {
      "line": 270,
      "type": "single",
      "original": "# 验证 lineNumber 字段类型",
      "full_line": "        # 验证 lineNumber 字段类型"
    },
    {
      "line": 299,
      "type": "single",
      "original": "# 创建测试文件",
      "full_line": "        # 创建测试文件"
    },
    {
      "line": 310,
      "type": "single",
      "original": "# 找到 theorem 行",
      "full_line": "        # 找到 theorem 行"
    },
    {
      "line": 319,
      "type": "single",
      "original": "# 在 'theorem myTheorem : True := trivial' 中",
      "full_line": "        # 在 'theorem myTheorem : True := trivial' 中"
    },
    {
      "line": 320,
      "type": "single",
      "original": "# 'theorem' 从 column 0 开始",
      "full_line": "        # 'theorem' 从 column 0 开始"
    },
    {
      "line": 321,
      "type": "single",
      "original": "# 'myTheorem' 从 column 8 开始",
      "full_line": "        # 'myTheorem' 从 column 8 开始"
    },
    {
      "line": 325,
      "type": "single",
      "original": "# 验证 'theorem' 和名字在不同列",
      "full_line": "        # 验证 'theorem' 和名字在不同列"
    },
    {
      "line": 329,
      "type": "single",
      "original": "# 这说明如果 definition 指向 [theorem_line, name_col, ...]",
      "full_line": "        # 这说明如果 definition 指向 [theorem_line, name_col, ...]"
    },
    {
      "line": 330,
      "type": "single",
      "original": "# 那么它指向的是名字位置，不是关键字位置",
      "full_line": "        # 那么它指向的是名字位置，不是关键字位置"
    },
    {
      "line": 356,
      "type": "single",
      "original": "# 找到 'theorem' 行和名字行",
      "full_line": "        # 找到 'theorem' 行和名字行"
    },
    {
      "line": 371,
      "type": "single",
      "original": "# 如果 .ilean definition 指向 name_line",
      "full_line": "        # 如果 .ilean definition 指向 name_line"
    },
    {
      "line": 372,
      "type": "single",
      "original": "# find_declaration_start 应该返回 keyword_line",
      "full_line": "        # find_declaration_start 应该返回 keyword_line"
    },
    {
      "line": 395,
      "type": "single",
      "original": "# 创建模拟的项目结构",
      "full_line": "        # 创建模拟的项目结构"
    },
    {
      "line": 398,
      "type": "single",
      "original": "# 创建 Lean 源文件",
      "full_line": "        # 创建 Lean 源文件"
    },
    {
      "line": 408,
      "type": "single",
      "original": "# 创建 .ilean 文件",
      "full_line": "        # 创建 .ilean 文件"
    },
    {
      "line": 409,
      "type": "single",
      "original": "# definition 指向正确的行号（第 2 行，0-indexed）",
      "full_line": "        # definition 指向正确的行号（第 2 行，0-indexed）"
    },
    {
      "line": 415,
      "type": "single",
      "original": "# 第 3 行（0-indexed=2），名字位置",
      "full_line": "                    \"definition\": [2, 8, 2, 24],  # 第 3 行（0-indexed=2），名字位置"
    },
    {
      "line": 430,
      "type": "single",
      "original": "# 直接使用 .ilean 的行号（第 3 行，1-indexed）",
      "full_line": "        # 直接使用 .ilean 的行号（第 3 行，1-indexed）"
    },
    {
      "line": 449,
      "type": "single",
      "original": "# .ilean definition 指向名字行（第 1 行，0-indexed）",
      "full_line": "        # .ilean definition 指向名字行（第 1 行，0-indexed）"
    },
    {
      "line": 452,
      "type": "single",
      "original": "# find_declaration_start 应该返回第 0 行",
      "full_line": "        # find_declaration_start 应该返回第 0 行"
    },
    {
      "line": 456,
      "type": "single",
      "original": "# extract_full_declaration 内部会调用 find_declaration_start",
      "full_line": "        # extract_full_declaration 内部会调用 find_declaration_start"
    },
    {
      "line": 477,
      "type": "single",
      "original": "# 5 行",
      "full_line": "        \"\"\")  # 5 行"
    },
    {
      "line": 486,
      "type": "single",
      "original": "# .ilean 报告的行号超出文件范围",
      "full_line": "        # .ilean 报告的行号超出文件范围"
    },
    {
      "line": 489,
      "type": "single",
      "original": "# 不应该返回超出范围的行号",
      "full_line": "        # 不应该返回超出范围的行号"
    },
    {
      "line": 493,
      "type": "single",
      "original": "# 应该找到 theorem 所在的行（第 2 行，0-indexed）",
      "full_line": "        # 应该找到 theorem 所在的行（第 2 行，0-indexed）"
    },
    {
      "line": 505,
      "type": "single",
      "original": "# 5 行的文件",
      "full_line": "        # 5 行的文件"
    },
    {
      "line": 515,
      "type": "single",
      "original": "# .ilean 给了超出范围的行号",
      "full_line": "        # .ilean 给了超出范围的行号"
    },
    {
      "line": 521,
      "type": "single",
      "original": "# 超出范围",
      "full_line": "                    \"definition\": [999, 0, 999, 10],  # 超出范围"
    },
    {
      "line": 536,
      "type": "single",
      "original": "# 行号应该被限制在文件范围内",
      "full_line": "        # 行号应该被限制在文件范围内"
    },
    {
      "line": 551,
      "type": "single",
      "original": "# definition 指向第 0 行",
      "full_line": "        # definition 指向第 0 行"
    },
    {
      "line": 569,
      "type": "single",
      "original": "# 找到 theorem 行",
      "full_line": "        # 找到 theorem 行"
    },
    {
      "line": 587,
      "type": "single",
      "original": "# 构造一个关键字在 15 行之上的情况（虽然不太常见）",
      "full_line": "        # 构造一个关键字在 15 行之上的情况（虽然不太常见）"
    },
    {
      "line": 609,
      "type": "single",
      "original": "# 找到名字行",
      "full_line": "        # 找到名字行"
    },
    {
      "line": 618,
      "type": "single",
      "original": "# 当前实现只搜索 10 行，这个测试预计会失败",
      "full_line": "        # 当前实现只搜索 10 行，这个测试预计会失败"
    },
    {
      "line": 621,
      "type": "single",
      "original": "# 预期：返回第 0 行（theorem 所在行）",
      "full_line": "        # 预期：返回第 0 行（theorem 所在行）"
    },
    {
      "line": 622,
      "type": "single",
      "original": "# 实际：可能返回 name_line（找不到关键字时回退）",
      "full_line": "        # 实际：可能返回 name_line（找不到关键字时回退）"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\nLine Number Accuracy Tests\n测试节点行号解析的准确性\n\n问题描述：\n点击 3D 节点后，Monaco Editor 无法跳转到正确的位置\n\n可能的原因：\n1. .ilean 的 definition 字段是名字位置，不是声明关键字位置\n2. 多行声明（带 attributes 或 docstring）可能导致行号偏移\n3. 行号转换（0-indexed vs 1-indexed）问题\n\"\"\"",
      "full_line": "\"\"\"\nLine Number Accuracy Tests\n测试节点行号解析的准确性\n\n问题描述：\n点击 3D 节点后，Monaco Editor 无法跳转到正确的位置\n\n可能的原因：\n1. .ilean 的 definition 字段是名字位置，不是声明关键字位置\n2. 多行声明（带 attributes 或 docstring）可能导致行号偏移\n3. 行号转换（0-indexed vs 1-indexed）问题\n\"\"\""
    },
    {
      "line": 21,
      "type": "docstring",
      "original": "\"\"\"测试 .ilean 解析时的行号提取\"\"\"",
      "full_line": "    \"\"\"测试 .ilean 解析时的行号提取\"\"\""
    },
    {
      "line": 25,
      "type": "docstring",
      "original": "\"\"\"创建一个典型的 Lean 文件，包含各种声明形式\"\"\"",
      "full_line": "        \"\"\"创建一个典型的 Lean 文件，包含各种声明形式\"\"\""
    },
    {
      "line": 26,
      "type": "docstring",
      "original": "        content = dedent(\"\"\"\\\n            import Mathlib.Tactic\n\n            /-- 这是一个文档注释 -/\n            theorem simple_theorem : True := trivial\n\n            @[simp]\n            theorem with_attribute : True := trivial\n\n            /--\n            多行文档注释\n            这个 theorem 的名字在第 12 行\n            -/\n            theorem multiline_doc : True := trivial\n\n            theorem long_signature\n              (x : Nat) (y : Nat)\n              (h : x < y) : x ≤ y := by\n              omega\n\n            -- 简单的注释\n            lemma simple_lemma : True := trivial\n\n            def some_definition : Nat := 42\n        \"\"\")",
      "full_line": "        content = dedent(\"\"\"\\\n            import Mathlib.Tactic\n\n            /-- 这是一个文档注释 -/\n            theorem simple_theorem : True := trivial\n\n            @[simp]\n            theorem with_attribute : True := trivial\n\n            /--\n            多行文档注释\n            这个 theorem 的名字在第 12 行\n            -/\n            theorem multiline_doc : True := trivial\n\n            theorem long_signature\n              (x : Nat) (y : Nat)\n              (h : x < y) : x ≤ y := by\n              omega\n\n            -- 简单的注释\n            lemma simple_lemma : True := trivial\n\n            def some_definition : Nat := 42\n        \"\"\")"
    },
    {
      "line": 56,
      "type": "docstring",
      "original": "        \"\"\"\n        简单声明：行号应该指向 'theorem' 关键字\n\n        Given: theorem simple_theorem : True := trivial\n        When: 解析行号\n        Then: 行号应该是 'theorem' 所在行（第 4 行，1-indexed）\n        \"\"\"",
      "full_line": "        \"\"\"\n        简单声明：行号应该指向 'theorem' 关键字\n\n        Given: theorem simple_theorem : True := trivial\n        When: 解析行号\n        Then: 行号应该是 'theorem' 所在行（第 4 行，1-indexed）\n        \"\"\""
    },
    {
      "line": 87,
      "type": "docstring",
      "original": "        \"\"\"\n        带 attribute 的声明：行号应该指向 'theorem' 关键字，不是 @[simp]\n\n        Given:\n            @[simp]\n            theorem with_attribute : True := trivial\n        When: 解析行号\n        Then: 行号应该是 'theorem' 所在行\n        \"\"\"",
      "full_line": "        \"\"\"\n        带 attribute 的声明：行号应该指向 'theorem' 关键字，不是 @[simp]\n\n        Given:\n            @[simp]\n            theorem with_attribute : True := trivial\n        When: 解析行号\n        Then: 行号应该是 'theorem' 所在行\n        \"\"\""
    },
    {
      "line": 117,
      "type": "docstring",
      "original": "        \"\"\"\n        带多行文档的声明：行号应该指向 'theorem' 关键字\n\n        Given:\n            /--\n            多行文档注释\n            -/\n            theorem multiline_doc : True := trivial\n        When: 解析行号\n        Then: 行号应该是 'theorem' 所在行，不是文档注释的行\n        \"\"\"",
      "full_line": "        \"\"\"\n        带多行文档的声明：行号应该指向 'theorem' 关键字\n\n        Given:\n            /--\n            多行文档注释\n            -/\n            theorem multiline_doc : True := trivial\n        When: 解析行号\n        Then: 行号应该是 'theorem' 所在行，不是文档注释的行\n        \"\"\""
    },
    {
      "line": 147,
      "type": "docstring",
      "original": "        \"\"\"\n        多行签名的声明：行号应该指向 'theorem' 关键字\n\n        Given:\n            theorem long_signature\n              (x : Nat) (y : Nat)\n              (h : x < y) : x ≤ y := by\n        When: .ilean definition 可能指向签名中间某行\n        Then: 行号应该是 'theorem' 所在行\n        \"\"\"",
      "full_line": "        \"\"\"\n        多行签名的声明：行号应该指向 'theorem' 关键字\n\n        Given:\n            theorem long_signature\n              (x : Nat) (y : Nat)\n              (h : x < y) : x ≤ y := by\n        When: .ilean definition 可能指向签名中间某行\n        Then: 行号应该是 'theorem' 所在行\n        \"\"\""
    },
    {
      "line": 181,
      "type": "docstring",
      "original": "\"\"\"测试节点行号在解析和存储过程中的正确性\"\"\"",
      "full_line": "    \"\"\"测试节点行号在解析和存储过程中的正确性\"\"\""
    },
    {
      "line": 185,
      "type": "docstring",
      "original": "\"\"\"模拟 .ilean 文件的 JSON 数据\"\"\"",
      "full_line": "        \"\"\"模拟 .ilean 文件的 JSON 数据\"\"\""
    },
    {
      "line": 207,
      "type": "docstring",
      "original": "        \"\"\"\n        Node.line_number 应该是 1-indexed（Monaco 期望的格式）\n\n        Given: .ilean definition[0] = 4 (0-indexed)\n        When: 解析生成 Node\n        Then: node.line_number = 5 (1-indexed)\n        \"\"\"",
      "full_line": "        \"\"\"\n        Node.line_number 应该是 1-indexed（Monaco 期望的格式）\n\n        Given: .ilean definition[0] = 4 (0-indexed)\n        When: 解析生成 Node\n        Then: node.line_number = 5 (1-indexed)\n        \"\"\""
    },
    {
      "line": 246,
      "type": "docstring",
      "original": "\"\"\"测试前端接收和使用行号的流程\"\"\"",
      "full_line": "    \"\"\"测试前端接收和使用行号的流程\"\"\""
    },
    {
      "line": 249,
      "type": "docstring",
      "original": "        \"\"\"\n        后端 API 响应中的 lineNumber 应该是 1-indexed 整数\n\n        This is a documentation test - verify the contract\n        \"\"\"",
      "full_line": "        \"\"\"\n        后端 API 响应中的 lineNumber 应该是 1-indexed 整数\n\n        This is a documentation test - verify the contract\n        \"\"\""
    },
    {
      "line": 277,
      "type": "docstring",
      "original": "    \"\"\"\n    测试 .ilean definition 字段的实际含义\n\n    核心问题：definition 字段存储的是什么位置？\n    - 声明关键字 (theorem/lemma) 的位置？\n    - 声明名字的位置？\n    - 整个声明的起始位置？\n    \"\"\"",
      "full_line": "    \"\"\"\n    测试 .ilean definition 字段的实际含义\n\n    核心问题：definition 字段存储的是什么位置？\n    - 声明关键字 (theorem/lemma) 的位置？\n    - 声明名字的位置？\n    - 整个声明的起始位置？\n    \"\"\""
    },
    {
      "line": 287,
      "type": "docstring",
      "original": "        \"\"\"\n        验证：.ilean definition 指向声明名字，不是关键字\n\n        Given:\n            Line 0: import Mathlib\n            Line 1:\n            Line 2: theorem myTheorem : True := trivial\n\n        If definition = [2, 8, 2, 17]:\n            - Line 2, Column 8-17 = 'myTheorem' (the name)\n            - NOT 'theorem' (column 0-6)\n        \"\"\"",
      "full_line": "        \"\"\"\n        验证：.ilean definition 指向声明名字，不是关键字\n\n        Given:\n            Line 0: import Mathlib\n            Line 1:\n            Line 2: theorem myTheorem : True := trivial\n\n        If definition = [2, 8, 2, 17]:\n            - Line 2, Column 8-17 = 'myTheorem' (the name)\n            - NOT 'theorem' (column 0-6)\n        \"\"\""
    },
    {
      "line": 333,
      "type": "docstring",
      "original": "        \"\"\"\n        关键测试：存储的行号应该是关键字行，而不是名字行\n\n        当名字和关键字在不同行时尤其重要：\n            theorem\n              myTheorem  <-- definition 可能指向这里\n              : True := trivial\n\n        用户期望：点击节点后跳转到 'theorem' 行\n        \"\"\"",
      "full_line": "        \"\"\"\n        关键测试：存储的行号应该是关键字行，而不是名字行\n\n        当名字和关键字在不同行时尤其重要：\n            theorem\n              myTheorem  <-- definition 可能指向这里\n              : True := trivial\n\n        用户期望：点击节点后跳转到 'theorem' 行\n        \"\"\""
    },
    {
      "line": 381,
      "type": "docstring",
      "original": "    \"\"\"\n    核心 Bug 测试：Node.line_number 使用的是名字位置，而不是关键字位置\n\n    这导致点击节点后，Monaco Editor 跳转到错误的行\n    \"\"\"",
      "full_line": "    \"\"\"\n    核心 Bug 测试：Node.line_number 使用的是名字位置，而不是关键字位置\n\n    这导致点击节点后，Monaco Editor 跳转到错误的行\n    \"\"\""
    },
    {
      "line": 388,
      "type": "docstring",
      "original": "        \"\"\"\n        测试：直接使用 .ilean 提供的行号\n\n        .ilean 的 definition 字段指向名字位置，通常与 keyword 在同一行\n        \"\"\"",
      "full_line": "        \"\"\"\n        测试：直接使用 .ilean 提供的行号\n\n        .ilean 的 definition 字段指向名字位置，通常与 keyword 在同一行\n        \"\"\""
    },
    {
      "line": 435,
      "type": "docstring",
      "original": "        \"\"\"\n        验证 extract_full_declaration 能找到正确的起始行\n\n        但问题是：这个结果没有被用于 node.line_number\n        \"\"\"",
      "full_line": "        \"\"\"\n        验证 extract_full_declaration 能找到正确的起始行\n\n        但问题是：这个结果没有被用于 node.line_number\n        \"\"\""
    },
    {
      "line": 462,
      "type": "docstring",
      "original": "\"\"\"边界情况测试\"\"\"",
      "full_line": "    \"\"\"边界情况测试\"\"\""
    },
    {
      "line": 465,
      "type": "docstring",
      "original": "        \"\"\"\n        当 .ilean 报告的行号超出文件长度时，应从文件末尾向上搜索关键字\n\n        Given: 文件只有 5 行，包含一个 theorem\n        When: .ilean definition 报告行号为 100\n        Then: 应该向上搜索找到 theorem 所在行\n        \"\"\"",
      "full_line": "        \"\"\"\n        当 .ilean 报告的行号超出文件长度时，应从文件末尾向上搜索关键字\n\n        Given: 文件只有 5 行，包含一个 theorem\n        When: .ilean definition 报告行号为 100\n        Then: 应该向上搜索找到 theorem 所在行\n        \"\"\""
    },
    {
      "line": 472,
      "type": "docstring",
      "original": "        content = dedent(\"\"\"\\\n            import Mathlib\n\n            theorem only_theorem : True := trivial\n\n        \"\"\")  # 5 行",
      "full_line": "        content = dedent(\"\"\"\\\n            import Mathlib\n\n            theorem only_theorem : True := trivial\n\n        \"\"\")  # 5 行"
    },
    {
      "line": 498,
      "type": "docstring",
      "original": "        \"\"\"\n        当 .ilean 行号超出文件范围时，限制到文件末尾\n        \"\"\"",
      "full_line": "        \"\"\"\n        当 .ilean 行号超出文件范围时，限制到文件末尾\n        \"\"\""
    },
    {
      "line": 542,
      "type": "docstring",
      "original": "\"\"\"文件第一行就是 theorem\"\"\"",
      "full_line": "        \"\"\"文件第一行就是 theorem\"\"\""
    },
    {
      "line": 556,
      "type": "docstring",
      "original": "\"\"\"命名空间内的 theorem\"\"\"",
      "full_line": "        \"\"\"命名空间内的 theorem\"\"\""
    },
    {
      "line": 582,
      "type": "docstring",
      "original": "        \"\"\"\n        关键字在名字上方超过 10 行时的边界情况\n\n        当前实现只向上搜索 10 行，超过这个范围会失败\n        \"\"\"",
      "full_line": "        \"\"\"\n        关键字在名字上方超过 10 行时的边界情况\n\n        当前实现只向上搜索 10 行，超过这个范围会失败\n        \"\"\""
    }
  ],
  "backend/tests/test_unified_storage.py": [
    {
      "line": 20,
      "type": "single",
      "original": "# Mock 数据",
      "full_line": "# Mock 数据"
    },
    {
      "line": 92,
      "type": "single",
      "original": "# 预设一些 user 数据",
      "full_line": "    # 预设一些 user 数据"
    },
    {
      "line": 112,
      "type": "single",
      "original": "# 1. Node 操作测试",
      "full_line": "# 1. Node 操作测试"
    },
    {
      "line": 129,
      "type": "single",
      "original": "# 检查返回值",
      "full_line": "        # 检查返回值"
    },
    {
      "line": 135,
      "type": "single",
      "original": "# 检查 meta.json 文件",
      "full_line": "        # 检查 meta.json 文件"
    },
    {
      "line": 194,
      "type": "single",
      "original": "# 即使传入 name 和 kind，也不应该保存",
      "full_line": "        # 即使传入 name 和 kind，也不应该保存"
    },
    {
      "line": 197,
      "type": "single",
      "original": "# 不应保存",
      "full_line": "            name=\"hacked_name\",  # 不应保存"
    },
    {
      "line": 198,
      "type": "single",
      "original": "# 不应保存",
      "full_line": "            kind=\"hacked_kind\",  # 不应保存"
    },
    {
      "line": 199,
      "type": "single",
      "original": "# 不应保存",
      "full_line": "            file_path=\"hacked\",  # 不应保存"
    },
    {
      "line": 200,
      "type": "single",
      "original": "#ff0000\",     # 应该保存",
      "full_line": "            color=\"#ff0000\",     # 应该保存"
    },
    {
      "line": 234,
      "type": "single",
      "original": "# 确认存在",
      "full_line": "        # 确认存在"
    },
    {
      "line": 238,
      "type": "single",
      "original": "# 删除",
      "full_line": "        # 删除"
    },
    {
      "line": 242,
      "type": "single",
      "original": "# 确认删除",
      "full_line": "        # 确认删除"
    },
    {
      "line": 254,
      "type": "single",
      "original": "# 确认边存在",
      "full_line": "        # 确认边存在"
    },
    {
      "line": 258,
      "type": "single",
      "original": "# 删除节点 A",
      "full_line": "        # 删除节点 A"
    },
    {
      "line": 261,
      "type": "single",
      "original": "# 边应该也被删除",
      "full_line": "        # 边应该也被删除"
    },
    {
      "line": 269,
      "type": "single",
      "original": "# 先添加一些 meta",
      "full_line": "        # 先添加一些 meta"
    },
    {
      "line": 272,
      "type": "single",
      "original": "# 确认 meta 存在",
      "full_line": "        # 确认 meta 存在"
    },
    {
      "line": 276,
      "type": "single",
      "original": "# 删除",
      "full_line": "        # 删除"
    },
    {
      "line": 280,
      "type": "single",
      "original": "# meta 应该被清除",
      "full_line": "        # meta 应该被清除"
    },
    {
      "line": 285,
      "type": "single",
      "original": "# 但通过 get_node 仍应返回 Lean 数据",
      "full_line": "        # 但通过 get_node 仍应返回 Lean 数据"
    },
    {
      "line": 309,
      "type": "single",
      "original": "# 2. Edge 操作测试",
      "full_line": "# 2. Edge 操作测试"
    },
    {
      "line": 353,
      "type": "single",
      "original": "# user-a 的 references 应该包含 user-b",
      "full_line": "        # user-a 的 references 应该包含 user-b"
    },
    {
      "line": 404,
      "type": "single",
      "original": "# 确认存在",
      "full_line": "        # 确认存在"
    },
    {
      "line": 408,
      "type": "single",
      "original": "# 删除",
      "full_line": "        # 删除"
    },
    {
      "line": 412,
      "type": "single",
      "original": "# 确认删除",
      "full_line": "        # 确认删除"
    },
    {
      "line": 422,
      "type": "single",
      "original": "# 确认 references 包含 user-b",
      "full_line": "        # 确认 references 包含 user-b"
    },
    {
      "line": 426,
      "type": "single",
      "original": "# 删除边",
      "full_line": "        # 删除边"
    },
    {
      "line": 429,
      "type": "single",
      "original": "# references 不应再包含 user-b",
      "full_line": "        # references 不应再包含 user-b"
    },
    {
      "line": 461,
      "type": "single",
      "original": "# 3. 级联操作测试",
      "full_line": "# 3. 级联操作测试"
    },
    {
      "line": 507,
      "type": "single",
      "original": "# B 和 C 都依赖 A",
      "full_line": "        # B 和 C 都依赖 A"
    },
    {
      "line": 511,
      "type": "single",
      "original": "# 确认 B 和 C 的 references 包含 user-a",
      "full_line": "        # 确认 B 和 C 的 references 包含 user-a"
    },
    {
      "line": 517,
      "type": "single",
      "original": "# 删除 A",
      "full_line": "        # 删除 A"
    },
    {
      "line": 520,
      "type": "single",
      "original": "# B 和 C 的 references 不应再包含 user-a",
      "full_line": "        # B 和 C 的 references 不应再包含 user-a"
    },
    {
      "line": 528,
      "type": "single",
      "original": "# 4. 数据合并测试",
      "full_line": "# 4. 数据合并测试"
    },
    {
      "line": 559,
      "type": "single",
      "original": "# 来自 Lean",
      "full_line": "        # 来自 Lean"
    },
    {
      "line": 564,
      "type": "single",
      "original": "# 来自 meta",
      "full_line": "        # 来自 meta"
    },
    {
      "line": 594,
      "type": "single",
      "original": "# 来自 Lean",
      "full_line": "        # 来自 Lean"
    },
    {
      "line": 598,
      "type": "single",
      "original": "# 来自 meta",
      "full_line": "        # 来自 meta"
    },
    {
      "line": 610,
      "type": "single",
      "original": "# 来自 Lean",
      "full_line": "        assert node[\"name\"] == \"div_add_div\"  # 来自 Lean"
    },
    {
      "line": 611,
      "type": "single",
      "original": "#ff0000\"     # 来自 meta",
      "full_line": "        assert node[\"color\"] == \"#ff0000\"     # 来自 meta"
    },
    {
      "line": 656,
      "type": "single",
      "original": "# 5. 辅助方法测试",
      "full_line": "# 5. 辅助方法测试"
    },
    {
      "line": 690,
      "type": "single",
      "original": "# 6. 数据结构验证测试",
      "full_line": "# 6. 数据结构验证测试"
    },
    {
      "line": 755,
      "type": "single",
      "original": "# Lean 边默认 type 是 reference",
      "full_line": "        # Lean 边默认 type 是 reference"
    },
    {
      "line": 760,
      "type": "single",
      "original": "# 7. 混合场景测试",
      "full_line": "# 7. 混合场景测试"
    },
    {
      "line": 799,
      "type": "single",
      "original": "# 删除 User 节点",
      "full_line": "        # 删除 User 节点"
    },
    {
      "line": 802,
      "type": "single",
      "original": "# 节点和边都应被删除",
      "full_line": "        # 节点和边都应被删除"
    },
    {
      "line": 806,
      "type": "single",
      "original": "# Lean 节点不受影响",
      "full_line": "        # Lean 节点不受影响"
    },
    {
      "line": 811,
      "type": "single",
      "original": "# 初始状态：2 个 Lean 节点，1 条 Lean 边",
      "full_line": "        # 初始状态：2 个 Lean 节点，1 条 Lean 边"
    },
    {
      "line": 815,
      "type": "single",
      "original": "# 添加 User 数据",
      "full_line": "        # 添加 User 数据"
    },
    {
      "line": 820,
      "type": "single",
      "original": "# 现在：4 个节点，2 条边",
      "full_line": "        # 现在：4 个节点，2 条边"
    },
    {
      "line": 824,
      "type": "single",
      "original": "# 只有 User 节点/边",
      "full_line": "        # 只有 User 节点/边"
    },
    {
      "line": 830,
      "type": "single",
      "original": "# 8. Macros 操作测试",
      "full_line": "# 8. Macros 操作测试"
    },
    {
      "line": 848,
      "type": "single",
      "original": "# 验证持久化",
      "full_line": "        # 验证持久化"
    },
    {
      "line": 894,
      "type": "single",
      "original": "# 原数据不受影响",
      "full_line": "        # 原数据不受影响"
    },
    {
      "line": 899,
      "type": "single",
      "original": "# 9. Clear 操作测试",
      "full_line": "# 9. Clear 操作测试"
    },
    {
      "line": 907,
      "type": "single",
      "original": "# 添加各种数据",
      "full_line": "        # 添加各种数据"
    },
    {
      "line": 913,
      "type": "single",
      "original": "# 清空",
      "full_line": "        # 清空"
    },
    {
      "line": 916,
      "type": "single",
      "original": "# 验证",
      "full_line": "        # 验证"
    },
    {
      "line": 928,
      "type": "single",
      "original": "# Lean 节点仍然存在",
      "full_line": "        # Lean 节点仍然存在"
    },
    {
      "line": 930,
      "type": "single",
      "original": "# 2 个 Lean 节点",
      "full_line": "        assert len(nodes) == 2  # 2 个 Lean 节点"
    },
    {
      "line": 932,
      "type": "single",
      "original": "# Lean 边仍然存在",
      "full_line": "        # Lean 边仍然存在"
    },
    {
      "line": 934,
      "type": "single",
      "original": "# 1 条 Lean 边",
      "full_line": "        assert len(edges) == 1  # 1 条 Lean 边"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\nUnified Storage Tests\n\n测试统一的 Node/Edge 存储系统：\n- graph.json: 只读，Lean 解析生成\n- meta.json: 可读写，用户数据\n- UnifiedStorage 合并两者提供统一视图\n\"\"\"",
      "full_line": "\"\"\"\nUnified Storage Tests\n\n测试统一的 Node/Edge 存储系统：\n- graph.json: 只读，Lean 解析生成\n- meta.json: 可读写，用户数据\n- UnifiedStorage 合并两者提供统一视图\n\"\"\""
    },
    {
      "line": 69,
      "type": "docstring",
      "original": "\"\"\"创建临时目录\"\"\"",
      "full_line": "    \"\"\"创建临时目录\"\"\""
    },
    {
      "line": 79,
      "type": "docstring",
      "original": "\"\"\"返回 meta.json 路径\"\"\"",
      "full_line": "    \"\"\"返回 meta.json 路径\"\"\""
    },
    {
      "line": 85,
      "type": "docstring",
      "original": "\"\"\"创建带有 mock graph 数据的 UnifiedStorage\"\"\"",
      "full_line": "    \"\"\"创建带有 mock graph 数据的 UnifiedStorage\"\"\""
    },
    {
      "line": 91,
      "type": "docstring",
      "original": "\"\"\"创建带有 mock graph 数据和预设 user 数据的 UnifiedStorage\"\"\"",
      "full_line": "    \"\"\"创建带有 mock graph 数据和预设 user 数据的 UnifiedStorage\"\"\""
    },
    {
      "line": 116,
      "type": "docstring",
      "original": "\"\"\"Node 操作测试\"\"\"",
      "full_line": "    \"\"\"Node 操作测试\"\"\""
    },
    {
      "line": 119,
      "type": "docstring",
      "original": "\"\"\"添加 User 节点，检查 meta.json 中有这个节点\"\"\"",
      "full_line": "        \"\"\"添加 User 节点，检查 meta.json 中有这个节点\"\"\""
    },
    {
      "line": 145,
      "type": "docstring",
      "original": "\"\"\"添加 User 节点必须有 name 和 kind\"\"\"",
      "full_line": "        \"\"\"添加 User 节点必须有 name 和 kind\"\"\""
    },
    {
      "line": 153,
      "type": "docstring",
      "original": "\"\"\"添加 User 节点可以带 references\"\"\"",
      "full_line": "        \"\"\"添加 User 节点可以带 references\"\"\""
    },
    {
      "line": 170,
      "type": "docstring",
      "original": "\"\"\"更新 Lean 节点的 meta，只存覆盖属性\"\"\"",
      "full_line": "        \"\"\"更新 Lean 节点的 meta，只存覆盖属性\"\"\""
    },
    {
      "line": 191,
      "type": "docstring",
      "original": "\"\"\"更新 Lean 节点的 meta，不存 name, kind, file_path 等\"\"\"",
      "full_line": "        \"\"\"更新 Lean 节点的 meta，不存 name, kind, file_path 等\"\"\""
    },
    {
      "line": 212,
      "type": "docstring",
      "original": "\"\"\"更新 User 节点的 meta（包括 name）\"\"\"",
      "full_line": "        \"\"\"更新 User 节点的 meta（包括 name）\"\"\""
    },
    {
      "line": 230,
      "type": "docstring",
      "original": "\"\"\"删除 User 节点\"\"\"",
      "full_line": "        \"\"\"删除 User 节点\"\"\""
    },
    {
      "line": 247,
      "type": "docstring",
      "original": "\"\"\"删除 User 节点时，相关的边也被删除\"\"\"",
      "full_line": "        \"\"\"删除 User 节点时，相关的边也被删除\"\"\""
    },
    {
      "line": 266,
      "type": "docstring",
      "original": "\"\"\"删除 Lean 节点只清除 meta，不真删除\"\"\"",
      "full_line": "        \"\"\"删除 Lean 节点只清除 meta，不真删除\"\"\""
    },
    {
      "line": 291,
      "type": "docstring",
      "original": "\"\"\"获取不存在节点的 meta 返回 None\"\"\"",
      "full_line": "        \"\"\"获取不存在节点的 meta 返回 None\"\"\""
    },
    {
      "line": 296,
      "type": "docstring",
      "original": "\"\"\"获取所有 User 节点（user- 开头）\"\"\"",
      "full_line": "        \"\"\"获取所有 User 节点（user- 开头）\"\"\""
    },
    {
      "line": 313,
      "type": "docstring",
      "original": "\"\"\"Edge 操作测试\"\"\"",
      "full_line": "    \"\"\"Edge 操作测试\"\"\""
    },
    {
      "line": 316,
      "type": "docstring",
      "original": "\"\"\"添加 User 边，检查 meta.json\"\"\"",
      "full_line": "        \"\"\"添加 User 边，检查 meta.json\"\"\""
    },
    {
      "line": 332,
      "type": "docstring",
      "original": "\"\"\"添加 User 边时 type 应该是 custom\"\"\"",
      "full_line": "        \"\"\"添加 User 边时 type 应该是 custom\"\"\""
    },
    {
      "line": 344,
      "type": "docstring",
      "original": "\"\"\"添加 User 边时，更新 source 节点的 references\"\"\"",
      "full_line": "        \"\"\"添加 User 边时，更新 source 节点的 references\"\"\""
    },
    {
      "line": 357,
      "type": "docstring",
      "original": "\"\"\"更新 Lean 边的 meta\"\"\"",
      "full_line": "        \"\"\"更新 Lean 边的 meta\"\"\""
    },
    {
      "line": 376,
      "type": "docstring",
      "original": "\"\"\"更新 User 边的 meta\"\"\"",
      "full_line": "        \"\"\"更新 User 边的 meta\"\"\""
    },
    {
      "line": 397,
      "type": "docstring",
      "original": "\"\"\"删除 User 边\"\"\"",
      "full_line": "        \"\"\"删除 User 边\"\"\""
    },
    {
      "line": 417,
      "type": "docstring",
      "original": "\"\"\"删除 User 边时，更新 source 节点的 references\"\"\"",
      "full_line": "        \"\"\"删除 User 边时，更新 source 节点的 references\"\"\""
    },
    {
      "line": 434,
      "type": "docstring",
      "original": "\"\"\"删除 Lean 边应该抛出错误\"\"\"",
      "full_line": "        \"\"\"删除 Lean 边应该抛出错误\"\"\""
    },
    {
      "line": 441,
      "type": "docstring",
      "original": "\"\"\"获取不存在边的 meta 返回 None\"\"\"",
      "full_line": "        \"\"\"获取不存在边的 meta 返回 None\"\"\""
    },
    {
      "line": 446,
      "type": "docstring",
      "original": "\"\"\"获取所有 User 边（type=custom）\"\"\"",
      "full_line": "        \"\"\"获取所有 User 边（type=custom）\"\"\""
    },
    {
      "line": 465,
      "type": "docstring",
      "original": "\"\"\"级联操作测试\"\"\"",
      "full_line": "    \"\"\"级联操作测试\"\"\""
    },
    {
      "line": 468,
      "type": "docstring",
      "original": "\"\"\"删除节点时，以该节点为 source 的边都删除\"\"\"",
      "full_line": "        \"\"\"删除节点时，以该节点为 source 的边都删除\"\"\""
    },
    {
      "line": 485,
      "type": "docstring",
      "original": "\"\"\"删除节点时，以该节点为 target 的边都删除\"\"\"",
      "full_line": "        \"\"\"删除节点时，以该节点为 target 的边都删除\"\"\""
    },
    {
      "line": 502,
      "type": "docstring",
      "original": "\"\"\"删除节点时，其他节点的 references 中的引用也要移除\"\"\"",
      "full_line": "        \"\"\"删除节点时，其他节点的 references 中的引用也要移除\"\"\""
    },
    {
      "line": 532,
      "type": "docstring",
      "original": "\"\"\"测试 graph.json 和 meta.json 的合并\"\"\"",
      "full_line": "    \"\"\"测试 graph.json 和 meta.json 的合并\"\"\""
    },
    {
      "line": 535,
      "type": "docstring",
      "original": "\"\"\"get_all_nodes 包含 Lean 节点\"\"\"",
      "full_line": "        \"\"\"get_all_nodes 包含 Lean 节点\"\"\""
    },
    {
      "line": 543,
      "type": "docstring",
      "original": "\"\"\"get_all_nodes 包含 User 节点\"\"\"",
      "full_line": "        \"\"\"get_all_nodes 包含 User 节点\"\"\""
    },
    {
      "line": 552,
      "type": "docstring",
      "original": "\"\"\"get_all_nodes 合并 Lean 数据和 meta\"\"\"",
      "full_line": "        \"\"\"get_all_nodes 合并 Lean 数据和 meta\"\"\""
    },
    {
      "line": 569,
      "type": "docstring",
      "original": "\"\"\"get_all_edges 包含 Lean 边\"\"\"",
      "full_line": "        \"\"\"get_all_edges 包含 Lean 边\"\"\""
    },
    {
      "line": 576,
      "type": "docstring",
      "original": "\"\"\"get_all_edges 包含 User 边\"\"\"",
      "full_line": "        \"\"\"get_all_edges 包含 User 边\"\"\""
    },
    {
      "line": 587,
      "type": "docstring",
      "original": "\"\"\"get_all_edges 合并 Lean 数据和 meta\"\"\"",
      "full_line": "        \"\"\"get_all_edges 合并 Lean 数据和 meta\"\"\""
    },
    {
      "line": 603,
      "type": "docstring",
      "original": "\"\"\"get_node 返回合并的 Lean 节点\"\"\"",
      "full_line": "        \"\"\"get_node 返回合并的 Lean 节点\"\"\""
    },
    {
      "line": 614,
      "type": "docstring",
      "original": "\"\"\"get_node 返回 User 节点\"\"\"",
      "full_line": "        \"\"\"get_node 返回 User 节点\"\"\""
    },
    {
      "line": 625,
      "type": "docstring",
      "original": "\"\"\"get_node 对不存在的节点返回 None\"\"\"",
      "full_line": "        \"\"\"get_node 对不存在的节点返回 None\"\"\""
    },
    {
      "line": 630,
      "type": "docstring",
      "original": "\"\"\"get_edge 返回合并的 Lean 边\"\"\"",
      "full_line": "        \"\"\"get_edge 返回合并的 Lean 边\"\"\""
    },
    {
      "line": 641,
      "type": "docstring",
      "original": "\"\"\"get_edge 返回 User 边\"\"\"",
      "full_line": "        \"\"\"get_edge 返回 User 边\"\"\""
    },
    {
      "line": 660,
      "type": "docstring",
      "original": "\"\"\"辅助方法测试\"\"\"",
      "full_line": "    \"\"\"辅助方法测试\"\"\""
    },
    {
      "line": 663,
      "type": "docstring",
      "original": "\"\"\"user- 开头的是 User 节点\"\"\"",
      "full_line": "        \"\"\"user- 开头的是 User 节点\"\"\""
    },
    {
      "line": 668,
      "type": "docstring",
      "original": "\"\"\"Lean 节点不是 User 节点\"\"\"",
      "full_line": "        \"\"\"Lean 节点不是 User 节点\"\"\""
    },
    {
      "line": 672,
      "type": "docstring",
      "original": "\"\"\"模块名格式的是 Lean 节点\"\"\"",
      "full_line": "        \"\"\"模块名格式的是 Lean 节点\"\"\""
    },
    {
      "line": 676,
      "type": "docstring",
      "original": "\"\"\"type=custom 的是 User 边\"\"\"",
      "full_line": "        \"\"\"type=custom 的是 User 边\"\"\""
    },
    {
      "line": 684,
      "type": "docstring",
      "original": "\"\"\"Lean 边是 reference 类型\"\"\"",
      "full_line": "        \"\"\"Lean 边是 reference 类型\"\"\""
    },
    {
      "line": 694,
      "type": "docstring",
      "original": "\"\"\"数据结构验证测试\"\"\"",
      "full_line": "    \"\"\"数据结构验证测试\"\"\""
    },
    {
      "line": 697,
      "type": "docstring",
      "original": "\"\"\"User 节点必须有 name, kind, references\"\"\"",
      "full_line": "        \"\"\"User 节点必须有 name, kind, references\"\"\""
    },
    {
      "line": 714,
      "type": "docstring",
      "original": "\"\"\"Lean 节点 meta 不存 name, kind, file_path 等身份字段\"\"\"",
      "full_line": "        \"\"\"Lean 节点 meta 不存 name, kind, file_path 等身份字段\"\"\""
    },
    {
      "line": 730,
      "type": "docstring",
      "original": "\"\"\"边 ID 格式是 source->target\"\"\"",
      "full_line": "        \"\"\"边 ID 格式是 source->target\"\"\""
    },
    {
      "line": 740,
      "type": "docstring",
      "original": "\"\"\"User 边的 type 是 custom\"\"\"",
      "full_line": "        \"\"\"User 边的 type 是 custom\"\"\""
    },
    {
      "line": 751,
      "type": "docstring",
      "original": "\"\"\"Lean 边的 type 是 reference（从 graph.json）\"\"\"",
      "full_line": "        \"\"\"Lean 边的 type 是 reference（从 graph.json）\"\"\""
    },
    {
      "line": 764,
      "type": "docstring",
      "original": "\"\"\"User 节点和 Lean 节点混合使用\"\"\"",
      "full_line": "    \"\"\"User 节点和 Lean 节点混合使用\"\"\""
    },
    {
      "line": 767,
      "type": "docstring",
      "original": "\"\"\"User 边可以连接到 Lean 节点\"\"\"",
      "full_line": "        \"\"\"User 边可以连接到 Lean 节点\"\"\""
    },
    {
      "line": 778,
      "type": "docstring",
      "original": "\"\"\"User 节点的 references 可以包含 Lean 节点\"\"\"",
      "full_line": "        \"\"\"User 节点的 references 可以包含 Lean 节点\"\"\""
    },
    {
      "line": 792,
      "type": "docstring",
      "original": "\"\"\"删除有边连接到 Lean 节点的 User 节点\"\"\"",
      "full_line": "        \"\"\"删除有边连接到 Lean 节点的 User 节点\"\"\""
    },
    {
      "line": 810,
      "type": "docstring",
      "original": "\"\"\"统计节点和边的数量\"\"\"",
      "full_line": "        \"\"\"统计节点和边的数量\"\"\""
    },
    {
      "line": 834,
      "type": "docstring",
      "original": "\"\"\"Macros 操作测试\"\"\"",
      "full_line": "    \"\"\"Macros 操作测试\"\"\""
    },
    {
      "line": 837,
      "type": "docstring",
      "original": "\"\"\"初始 macros 为空\"\"\"",
      "full_line": "        \"\"\"初始 macros 为空\"\"\""
    },
    {
      "line": 842,
      "type": "docstring",
      "original": "\"\"\"设置 macros（完全替换）\"\"\"",
      "full_line": "        \"\"\"设置 macros（完全替换）\"\"\""
    },
    {
      "line": 854,
      "type": "docstring",
      "original": "\"\"\"set_macros 替换而非合并\"\"\"",
      "full_line": "        \"\"\"set_macros 替换而非合并\"\"\""
    },
    {
      "line": 863,
      "type": "docstring",
      "original": "\"\"\"增量添加 macros\"\"\"",
      "full_line": "        \"\"\"增量添加 macros\"\"\""
    },
    {
      "line": 871,
      "type": "docstring",
      "original": "\"\"\"增量修改 macros\"\"\"",
      "full_line": "        \"\"\"增量修改 macros\"\"\""
    },
    {
      "line": 879,
      "type": "docstring",
      "original": "\"\"\"使用 None 删除 macros\"\"\"",
      "full_line": "        \"\"\"使用 None 删除 macros\"\"\""
    },
    {
      "line": 888,
      "type": "docstring",
      "original": "\"\"\"get_macros 返回副本，修改不影响原数据\"\"\"",
      "full_line": "        \"\"\"get_macros 返回副本，修改不影响原数据\"\"\""
    },
    {
      "line": 903,
      "type": "docstring",
      "original": "\"\"\"Clear 操作测试\"\"\"",
      "full_line": "    \"\"\"Clear 操作测试\"\"\""
    },
    {
      "line": 906,
      "type": "docstring",
      "original": "\"\"\"clear 清空所有 meta 数据\"\"\"",
      "full_line": "        \"\"\"clear 清空所有 meta 数据\"\"\""
    },
    {
      "line": 925,
      "type": "docstring",
      "original": "\"\"\"clear 不影响 Lean 数据（graph_data）\"\"\"",
      "full_line": "        \"\"\"clear 不影响 Lean 数据（graph_data）\"\"\""
    }
  ],
  "backend/tests/test_canvas.py": [
    {
      "line": 25,
      "type": "single",
      "original": "# 添加第一个节点",
      "full_line": "        # 添加第一个节点"
    },
    {
      "line": 30,
      "type": "single",
      "original": "# 验证持久化",
      "full_line": "        # 验证持久化"
    },
    {
      "line": 40,
      "type": "single",
      "original": "# 重复添加",
      "full_line": "        store.add_node(\"node_1\")  # 重复添加"
    },
    {
      "line": 41,
      "type": "single",
      "original": "# 再次重复",
      "full_line": "        store.add_node(\"node_1\")  # 再次重复"
    },
    {
      "line": 44,
      "type": "single",
      "original": "# 只应该有一个",
      "full_line": "        assert canvas.visible_nodes.count(\"node_1\") == 1  # 只应该有一个"
    },
    {
      "line": 66,
      "type": "single",
      "original": "# 先添加",
      "full_line": "        # 先添加"
    },
    {
      "line": 70,
      "type": "single",
      "original": "# 移除",
      "full_line": "        # 移除"
    },
    {
      "line": 75,
      "type": "single",
      "original": "# 验证持久化",
      "full_line": "        # 验证持久化"
    },
    {
      "line": 87,
      "type": "single",
      "original": "# 移除不存在的节点",
      "full_line": "        # 移除不存在的节点"
    },
    {
      "line": 90,
      "type": "single",
      "original": "# 原有节点不受影响",
      "full_line": "        # 原有节点不受影响"
    },
    {
      "line": 101,
      "type": "single",
      "original": "# 验证位置存在",
      "full_line": "        # 验证位置存在"
    },
    {
      "line": 105,
      "type": "single",
      "original": "# 移除节点",
      "full_line": "        # 移除节点"
    },
    {
      "line": 108,
      "type": "single",
      "original": "# 位置也应该被移除",
      "full_line": "        # 位置也应该被移除"
    },
    {
      "line": 115,
      "type": "single",
      "original": "# 初始状态：不可见",
      "full_line": "        # 初始状态：不可见"
    },
    {
      "line": 119,
      "type": "single",
      "original": "# 添加（变为可见）",
      "full_line": "        # 添加（变为可见）"
    },
    {
      "line": 123,
      "type": "single",
      "original": "# 移除（变为不可见）",
      "full_line": "        # 移除（变为不可见）"
    },
    {
      "line": 127,
      "type": "single",
      "original": "# 再次添加（变为可见）",
      "full_line": "        # 再次添加（变为可见）"
    },
    {
      "line": 135,
      "type": "single",
      "original": "# 快速切换 10 次",
      "full_line": "        # 快速切换 10 次"
    },
    {
      "line": 142,
      "type": "single",
      "original": "# 最终状态应该是不可见（偶数次添加，奇数次移除）",
      "full_line": "        # 最终状态应该是不可见（偶数次添加，奇数次移除）"
    },
    {
      "line": 151,
      "type": "single",
      "original": "# 模拟并发：多次添加同一节点",
      "full_line": "        # 模拟并发：多次添加同一节点"
    },
    {
      "line": 156,
      "type": "single",
      "original": "# 节点只应该出现一次",
      "full_line": "        # 节点只应该出现一次"
    },
    {
      "line": 164,
      "type": "single",
      "original": "# 添加一些节点和位置",
      "full_line": "        # 添加一些节点和位置"
    },
    {
      "line": 169,
      "type": "single",
      "original": "# 清空",
      "full_line": "        # 清空"
    },
    {
      "line": 184,
      "type": "single",
      "original": "# 直接读取文件验证格式",
      "full_line": "        # 直接读取文件验证格式"
    },
    {
      "line": 245,
      "type": "single",
      "original": "# 模拟 API 调用",
      "full_line": "        # 模拟 API 调用"
    },
    {
      "line": 248,
      "type": "single",
      "original": "# API 应该返回完整的数据",
      "full_line": "        # API 应该返回完整的数据"
    },
    {
      "line": 252,
      "type": "single",
      "original": "# 关键：positions 也应该返回",
      "full_line": "            \"positions\": canvas.positions,  # 关键：positions 也应该返回"
    },
    {
      "line": 266,
      "type": "single",
      "original": "# 模拟 API 调用",
      "full_line": "        # 模拟 API 调用"
    },
    {
      "line": 283,
      "type": "single",
      "original": "# 1. 初始加载 - 空画布",
      "full_line": "        # 1. 初始加载 - 空画布"
    },
    {
      "line": 287,
      "type": "single",
      "original": "# 2. 搜索后添加节点",
      "full_line": "        # 2. 搜索后添加节点"
    },
    {
      "line": 291,
      "type": "single",
      "original": "# 3. 在 3D 图中拖拽后更新位置",
      "full_line": "        # 3. 在 3D 图中拖拽后更新位置"
    },
    {
      "line": 295,
      "type": "single",
      "original": "# 4. 添加更多节点",
      "full_line": "        # 4. 添加更多节点"
    },
    {
      "line": 299,
      "type": "single",
      "original": "# 5. 通过 toggle 移除一个节点",
      "full_line": "        # 5. 通过 toggle 移除一个节点"
    },
    {
      "line": 304,
      "type": "single",
      "original": "# 6. 重新打开应用后加载",
      "full_line": "        # 6. 重新打开应用后加载"
    },
    {
      "line": 321,
      "type": "single",
      "original": "# 空字符串 ID",
      "full_line": "        # 空字符串 ID"
    },
    {
      "line": 323,
      "type": "single",
      "original": "# 技术上允许，但可能需要在 API 层验证",
      "full_line": "        assert \"\" in canvas.visible_nodes  # 技术上允许，但可能需要在 API 层验证"
    },
    {
      "line": 340,
      "type": "single",
      "original": "# 移除",
      "full_line": "            # 移除"
    },
    {
      "line": 353,
      "type": "single",
      "original": "# 验证持久化",
      "full_line": "        # 验证持久化"
    },
    {
      "line": 366,
      "type": "single",
      "original": "# 验证持久化",
      "full_line": "        # 验证持久化"
    },
    {
      "line": 374,
      "type": "single",
      "original": "# 创建损坏的文件",
      "full_line": "        # 创建损坏的文件"
    },
    {
      "line": 380,
      "type": "single",
      "original": "# 应该返回空画布而不是报错",
      "full_line": "        # 应该返回空画布而不是报错"
    },
    {
      "line": 384,
      "type": "single",
      "original": "# 应该能正常添加节点（覆盖损坏的文件）",
      "full_line": "        # 应该能正常添加节点（覆盖损坏的文件）"
    },
    {
      "line": 406,
      "type": "single",
      "original": "# 模拟 API 响应",
      "full_line": "        # 模拟 API 响应"
    },
    {
      "line": 413,
      "type": "single",
      "original": "# 关键断言：positions 必须存在且是 dict",
      "full_line": "        # 关键断言：positions 必须存在且是 dict"
    },
    {
      "line": 441,
      "type": "single",
      "original": "# 添加多个节点并设置位置",
      "full_line": "        # 添加多个节点并设置位置"
    },
    {
      "line": 447,
      "type": "single",
      "original": "# 移除 node_1",
      "full_line": "        # 移除 node_1"
    },
    {
      "line": 450,
      "type": "single",
      "original": "# node_2 的位置应该保持不变",
      "full_line": "        # node_2 的位置应该保持不变"
    },
    {
      "line": 452,
      "type": "single",
      "original": "# node_1 的位置应该被移除",
      "full_line": "        # node_1 的位置应该被移除"
    },
    {
      "line": 455,
      "type": "single",
      "original": "# 重新添加 node_1",
      "full_line": "        # 重新添加 node_1"
    },
    {
      "line": 458,
      "type": "single",
      "original": "# node_2 的位置仍然不变",
      "full_line": "        # node_2 的位置仍然不变"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\n测试 Canvas API 和 CanvasStore\n\n确保可见性切换功能正常工作：\n- 添加节点到画布\n- 从画布移除节点\n- 状态一致性\n\"\"\"",
      "full_line": "\"\"\"\n测试 Canvas API 和 CanvasStore\n\n确保可见性切换功能正常工作：\n- 添加节点到画布\n- 从画布移除节点\n- 状态一致性\n\"\"\""
    },
    {
      "line": 18,
      "type": "docstring",
      "original": "\"\"\"测试 CanvasStore 核心逻辑\"\"\"",
      "full_line": "    \"\"\"测试 CanvasStore 核心逻辑\"\"\""
    },
    {
      "line": 21,
      "type": "docstring",
      "original": "\"\"\"基本添加节点功能\"\"\"",
      "full_line": "        \"\"\"基本添加节点功能\"\"\""
    },
    {
      "line": 35,
      "type": "docstring",
      "original": "\"\"\"添加相同节点应该是幂等的\"\"\"",
      "full_line": "        \"\"\"添加相同节点应该是幂等的\"\"\""
    },
    {
      "line": 47,
      "type": "docstring",
      "original": "\"\"\"添加多个节点\"\"\"",
      "full_line": "        \"\"\"添加多个节点\"\"\""
    },
    {
      "line": 62,
      "type": "docstring",
      "original": "\"\"\"基本移除节点功能\"\"\"",
      "full_line": "        \"\"\"基本移除节点功能\"\"\""
    },
    {
      "line": 81,
      "type": "docstring",
      "original": "\"\"\"移除不存在的节点不应该报错\"\"\"",
      "full_line": "        \"\"\"移除不存在的节点不应该报错\"\"\""
    },
    {
      "line": 94,
      "type": "docstring",
      "original": "\"\"\"移除节点时也应该移除对应的位置\"\"\"",
      "full_line": "        \"\"\"移除节点时也应该移除对应的位置\"\"\""
    },
    {
      "line": 112,
      "type": "docstring",
      "original": "\"\"\"测试可见性切换循环：添加 -> 移除 -> 添加\"\"\"",
      "full_line": "        \"\"\"测试可见性切换循环：添加 -> 移除 -> 添加\"\"\""
    },
    {
      "line": 132,
      "type": "docstring",
      "original": "\"\"\"快速切换测试（模拟用户快速点击）\"\"\"",
      "full_line": "        \"\"\"快速切换测试（模拟用户快速点击）\"\"\""
    },
    {
      "line": 147,
      "type": "docstring",
      "original": "\"\"\"并发添加同一节点的处理\"\"\"",
      "full_line": "        \"\"\"并发添加同一节点的处理\"\"\""
    },
    {
      "line": 160,
      "type": "docstring",
      "original": "\"\"\"清空画布\"\"\"",
      "full_line": "        \"\"\"清空画布\"\"\""
    },
    {
      "line": 177,
      "type": "docstring",
      "original": "\"\"\"验证 canvas.json 文件格式\"\"\"",
      "full_line": "        \"\"\"验证 canvas.json 文件格式\"\"\""
    },
    {
      "line": 200,
      "type": "docstring",
      "original": "\"\"\"测试 CanvasData 数据类\"\"\"",
      "full_line": "    \"\"\"测试 CanvasData 数据类\"\"\""
    },
    {
      "line": 203,
      "type": "docstring",
      "original": "\"\"\"测试序列化 - 3D 位置格式\"\"\"",
      "full_line": "        \"\"\"测试序列化 - 3D 位置格式\"\"\""
    },
    {
      "line": 217,
      "type": "docstring",
      "original": "\"\"\"测试反序列化 - 3D 位置格式\"\"\"",
      "full_line": "        \"\"\"测试反序列化 - 3D 位置格式\"\"\""
    },
    {
      "line": 231,
      "type": "docstring",
      "original": "\"\"\"测试空数据反序列化\"\"\"",
      "full_line": "        \"\"\"测试空数据反序列化\"\"\""
    },
    {
      "line": 239,
      "type": "docstring",
      "original": "\"\"\"集成测试：模拟 API 调用流程\"\"\"",
      "full_line": "    \"\"\"集成测试：模拟 API 调用流程\"\"\""
    },
    {
      "line": 242,
      "type": "docstring",
      "original": "\"\"\"API 添加节点应返回正确的数据结构\"\"\"",
      "full_line": "        \"\"\"API 添加节点应返回正确的数据结构\"\"\""
    },
    {
      "line": 259,
      "type": "docstring",
      "original": "\"\"\"API 移除节点应返回正确的数据结构\"\"\"",
      "full_line": "        \"\"\"API 移除节点应返回正确的数据结构\"\"\""
    },
    {
      "line": 279,
      "type": "docstring",
      "original": "\"\"\"完整工作流程测试\"\"\"",
      "full_line": "        \"\"\"完整工作流程测试\"\"\""
    },
    {
      "line": 315,
      "type": "docstring",
      "original": "\"\"\"边界情况测试\"\"\"",
      "full_line": "    \"\"\"边界情况测试\"\"\""
    },
    {
      "line": 318,
      "type": "docstring",
      "original": "\"\"\"空节点 ID\"\"\"",
      "full_line": "        \"\"\"空节点 ID\"\"\""
    },
    {
      "line": 326,
      "type": "docstring",
      "original": "\"\"\"节点 ID 包含特殊字符\"\"\"",
      "full_line": "        \"\"\"节点 ID 包含特殊字符\"\"\""
    },
    {
      "line": 345,
      "type": "docstring",
      "original": "\"\"\"非常长的节点 ID\"\"\"",
      "full_line": "        \"\"\"非常长的节点 ID\"\"\""
    },
    {
      "line": 358,
      "type": "docstring",
      "original": "\"\"\"Unicode 节点 ID\"\"\"",
      "full_line": "        \"\"\"Unicode 节点 ID\"\"\""
    },
    {
      "line": 371,
      "type": "docstring",
      "original": "\"\"\"canvas.json 损坏的情况\"\"\"",
      "full_line": "        \"\"\"canvas.json 损坏的情况\"\"\""
    },
    {
      "line": 390,
      "type": "docstring",
      "original": "\"\"\"测试 API 响应格式 - 确保前端期望的字段都存在\"\"\"",
      "full_line": "    \"\"\"测试 API 响应格式 - 确保前端期望的字段都存在\"\"\""
    },
    {
      "line": 393,
      "type": "docstring",
      "original": "        \"\"\"\n        BUG FIX: /api/canvas/add 必须返回 positions 字段\n\n        前端 canvasStore.addNode 期望响应包含：\n        - visible_nodes: string[]\n        - positions: Record<string, {x, y}>\n\n        如果缺少 positions，前端会设置 positions 为 undefined，\n        导致节点添加后可能无法正确显示。\n        \"\"\"",
      "full_line": "        \"\"\"\n        BUG FIX: /api/canvas/add 必须返回 positions 字段\n\n        前端 canvasStore.addNode 期望响应包含：\n        - visible_nodes: string[]\n        - positions: Record<string, {x, y}>\n\n        如果缺少 positions，前端会设置 positions 为 undefined，\n        导致节点添加后可能无法正确显示。\n        \"\"\""
    },
    {
      "line": 418,
      "type": "docstring",
      "original": "        \"\"\"\n        BUG FIX: /api/canvas/remove 必须返回 positions 字段\n        \"\"\"",
      "full_line": "        \"\"\"\n        BUG FIX: /api/canvas/remove 必须返回 positions 字段\n        \"\"\""
    },
    {
      "line": 435,
      "type": "docstring",
      "original": "        \"\"\"\n        确保切换一个节点的可见性不会影响其他节点的位置\n        \"\"\"",
      "full_line": "        \"\"\"\n        确保切换一个节点的可见性不会影响其他节点的位置\n        \"\"\""
    }
  ],
  "backend/tests/test_canvas_api.py": [
    {
      "line": 25,
      "type": "single",
      "original": "# 创建 .astrolabe 目录",
      "full_line": "    # 创建 .astrolabe 目录"
    },
    {
      "line": 29,
      "type": "single",
      "original": "# 初始化 canvas 并添加一些节点",
      "full_line": "    # 初始化 canvas 并添加一些节点"
    },
    {
      "line": 69,
      "type": "single",
      "original": "# 验证保存的位置包含 z 坐标",
      "full_line": "        # 验证保存的位置包含 z 坐标"
    },
    {
      "line": 78,
      "type": "single",
      "original": "# 先保存 node_1 的位置",
      "full_line": "        # 先保存 node_1 的位置"
    },
    {
      "line": 87,
      "type": "single",
      "original": "# 再保存 node_2 的位置",
      "full_line": "        # 再保存 node_2 的位置"
    },
    {
      "line": 98,
      "type": "single",
      "original": "# 响应应包含所有已保存的位置",
      "full_line": "        # 响应应包含所有已保存的位置"
    },
    {
      "line": 108,
      "type": "single",
      "original": "# 先保存所有节点位置",
      "full_line": "        # 先保存所有节点位置"
    },
    {
      "line": 120,
      "type": "single",
      "original": "# 只更新 node_1",
      "full_line": "        # 只更新 node_1"
    },
    {
      "line": 131,
      "type": "single",
      "original": "# node_1 应该更新",
      "full_line": "        # node_1 应该更新"
    },
    {
      "line": 133,
      "type": "single",
      "original": "# node_2 应该保持不变",
      "full_line": "        # node_2 应该保持不变"
    },
    {
      "line": 179,
      "type": "single",
      "original": "# 先保存一些 3D 位置",
      "full_line": "        # 先保存一些 3D 位置"
    },
    {
      "line": 184,
      "type": "single",
      "original": "# 加载 canvas",
      "full_line": "        # 加载 canvas"
    },
    {
      "line": 192,
      "type": "single",
      "original": "# 验证位置是 3D 格式",
      "full_line": "        # 验证位置是 3D 格式"
    },
    {
      "line": 201,
      "type": "single",
      "original": "# 创建空的 .astrolabe 目录",
      "full_line": "        # 创建空的 .astrolabe 目录"
    },
    {
      "line": 224,
      "type": "single",
      "original": "# 必要字段",
      "full_line": "        # 必要字段"
    },
    {
      "line": 238,
      "type": "single",
      "original": "# 先设置一些位置",
      "full_line": "        # 先设置一些位置"
    },
    {
      "line": 242,
      "type": "single",
      "original": "# 添加新节点",
      "full_line": "        # 添加新节点"
    },
    {
      "line": 254,
      "type": "single",
      "original": "# 响应应包含 positions",
      "full_line": "        # 响应应包含 positions"
    },
    {
      "line": 256,
      "type": "single",
      "original": "# 现有位置应保持",
      "full_line": "        # 现有位置应保持"
    },
    {
      "line": 267,
      "type": "single",
      "original": "# 先设置位置",
      "full_line": "        # 先设置位置"
    },
    {
      "line": 272,
      "type": "single",
      "original": "# 移除 node_1",
      "full_line": "        # 移除 node_1"
    },
    {
      "line": 283,
      "type": "single",
      "original": "# node_1 的位置应该被移除",
      "full_line": "        # node_1 的位置应该被移除"
    },
    {
      "line": 285,
      "type": "single",
      "original": "# node_2 的位置应该保持",
      "full_line": "        # node_2 的位置应该保持"
    },
    {
      "line": 313,
      "type": "single",
      "original": "# 先保存",
      "full_line": "        # 先保存"
    },
    {
      "line": 322,
      "type": "single",
      "original": "# 再加载",
      "full_line": "        # 再加载"
    },
    {
      "line": 335,
      "type": "single",
      "original": "# 先保存一个值",
      "full_line": "        # 先保存一个值"
    },
    {
      "line": 344,
      "type": "single",
      "original": "# 设为空字符串清除",
      "full_line": "        # 设为空字符串清除"
    },
    {
      "line": 355,
      "type": "single",
      "original": "# selected_edge_id 应该不存在（空字符串不输出）",
      "full_line": "        # selected_edge_id 应该不存在（空字符串不输出）"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\n测试 Canvas API 端点的 3D 位置功能\n\n确保：\n- POST /api/canvas/positions 接收和保存 3D 坐标 {x, y, z}\n- GET /api/canvas 返回 3D 位置\n- 位置更新不影响其他节点\n\"\"\"",
      "full_line": "\"\"\"\n测试 Canvas API 端点的 3D 位置功能\n\n确保：\n- POST /api/canvas/positions 接收和保存 3D 坐标 {x, y, z}\n- GET /api/canvas 返回 3D 位置\n- 位置更新不影响其他节点\n\"\"\""
    },
    {
      "line": 18,
      "type": "docstring",
      "original": "\"\"\"创建测试客户端\"\"\"",
      "full_line": "    \"\"\"创建测试客户端\"\"\""
    },
    {
      "line": 24,
      "type": "docstring",
      "original": "\"\"\"创建一个有 canvas 数据的测试项目\"\"\"",
      "full_line": "    \"\"\"创建一个有 canvas 数据的测试项目\"\"\""
    },
    {
      "line": 39,
      "type": "docstring",
      "original": "\"\"\"测试 POST /api/canvas/positions 端点\"\"\"",
      "full_line": "    \"\"\"测试 POST /api/canvas/positions 端点\"\"\""
    },
    {
      "line": 42,
      "type": "docstring",
      "original": "        \"\"\"\n        POST /api/canvas/positions 应该接收并保存 3D 坐标\n\n        请求格式：\n        {\n            \"path\": \"/project/path\",\n            \"positions\": {\n                \"node_1\": {\"x\": 10.0, \"y\": 20.0, \"z\": 30.0}\n            }\n        }\n        \"\"\"",
      "full_line": "        \"\"\"\n        POST /api/canvas/positions 应该接收并保存 3D 坐标\n\n        请求格式：\n        {\n            \"path\": \"/project/path\",\n            \"positions\": {\n                \"node_1\": {\"x\": 10.0, \"y\": 20.0, \"z\": 30.0}\n            }\n        }\n        \"\"\""
    },
    {
      "line": 75,
      "type": "docstring",
      "original": "        \"\"\"\n        保存部分节点位置后，响应应返回所有节点的位置\n        \"\"\"",
      "full_line": "        \"\"\"\n        保存部分节点位置后，响应应返回所有节点的位置\n        \"\"\""
    },
    {
      "line": 105,
      "type": "docstring",
      "original": "        \"\"\"\n        更新部分节点位置不应影响其他节点的位置\n        \"\"\"",
      "full_line": "        \"\"\"\n        更新部分节点位置不应影响其他节点的位置\n        \"\"\""
    },
    {
      "line": 137,
      "type": "docstring",
      "original": "        \"\"\"\n        应该正确处理负坐标值\n        \"\"\"",
      "full_line": "        \"\"\"\n        应该正确处理负坐标值\n        \"\"\""
    },
    {
      "line": 154,
      "type": "docstring",
      "original": "        \"\"\"\n        z=0 的情况应该正确保存（不应被忽略）\n        \"\"\"",
      "full_line": "        \"\"\"\n        z=0 的情况应该正确保存（不应被忽略）\n        \"\"\""
    },
    {
      "line": 173,
      "type": "docstring",
      "original": "\"\"\"测试 GET /api/canvas 返回 3D 位置\"\"\"",
      "full_line": "    \"\"\"测试 GET /api/canvas 返回 3D 位置\"\"\""
    },
    {
      "line": 176,
      "type": "docstring",
      "original": "        \"\"\"\n        GET /api/canvas 应该返回 3D 位置格式 {x, y, z}\n        \"\"\"",
      "full_line": "        \"\"\"\n        GET /api/canvas 应该返回 3D 位置格式 {x, y, z}\n        \"\"\""
    },
    {
      "line": 198,
      "type": "docstring",
      "original": "        \"\"\"\n        空画布应该返回空的 positions 对象\n        \"\"\"",
      "full_line": "        \"\"\"\n        空画布应该返回空的 positions 对象\n        \"\"\""
    },
    {
      "line": 215,
      "type": "docstring",
      "original": "        \"\"\"\n        GET /api/canvas 响应应包含所有必要字段\n        \"\"\"",
      "full_line": "        \"\"\"\n        GET /api/canvas 响应应包含所有必要字段\n        \"\"\""
    },
    {
      "line": 232,
      "type": "docstring",
      "original": "\"\"\"测试 POST /api/canvas/add 返回的位置格式\"\"\"",
      "full_line": "    \"\"\"测试 POST /api/canvas/add 返回的位置格式\"\"\""
    },
    {
      "line": 235,
      "type": "docstring",
      "original": "        \"\"\"\n        添加节点后响应应包含 positions 字段\n        \"\"\"",
      "full_line": "        \"\"\"\n        添加节点后响应应包含 positions 字段\n        \"\"\""
    },
    {
      "line": 261,
      "type": "docstring",
      "original": "\"\"\"测试 POST /api/canvas/remove 的位置清理\"\"\"",
      "full_line": "    \"\"\"测试 POST /api/canvas/remove 的位置清理\"\"\""
    },
    {
      "line": 264,
      "type": "docstring",
      "original": "        \"\"\"\n        移除节点时应同时移除其位置\n        \"\"\"",
      "full_line": "        \"\"\"\n        移除节点时应同时移除其位置\n        \"\"\""
    },
    {
      "line": 290,
      "type": "docstring",
      "original": "\"\"\"测试 viewport 的 selected_edge_id 持久化\"\"\"",
      "full_line": "    \"\"\"测试 viewport 的 selected_edge_id 持久化\"\"\""
    },
    {
      "line": 293,
      "type": "docstring",
      "original": "        \"\"\"\n        PATCH /api/canvas/viewport 应该能保存 selected_edge_id\n        \"\"\"",
      "full_line": "        \"\"\"\n        PATCH /api/canvas/viewport 应该能保存 selected_edge_id\n        \"\"\""
    },
    {
      "line": 310,
      "type": "docstring",
      "original": "        \"\"\"\n        GET /api/canvas/viewport 应该返回已保存的 selected_edge_id\n        \"\"\"",
      "full_line": "        \"\"\"\n        GET /api/canvas/viewport 应该返回已保存的 selected_edge_id\n        \"\"\""
    },
    {
      "line": 332,
      "type": "docstring",
      "original": "        \"\"\"\n        selected_edge_id 设为空字符串时应该清除\n        \"\"\"",
      "full_line": "        \"\"\"\n        selected_edge_id 设为空字符串时应该清除\n        \"\"\""
    },
    {
      "line": 359,
      "type": "docstring",
      "original": "        \"\"\"\n        应该能同时保存 selected_node_id 和 selected_edge_id\n        \"\"\"",
      "full_line": "        \"\"\"\n        应该能同时保存 selected_node_id 和 selected_edge_id\n        \"\"\""
    }
  ],
  "backend/tests/test_lsp_diagnostics_display.py": [
    {
      "line": 19,
      "type": "single",
      "original": "# Test 1: LeanLSPClient 支持 on_raw_diagnostics 回调",
      "full_line": "# Test 1: LeanLSPClient 支持 on_raw_diagnostics 回调"
    },
    {
      "line": 30,
      "type": "single",
      "original": "# 应该有 on_raw_diagnostics 属性",
      "full_line": "        # 应该有 on_raw_diagnostics 属性"
    },
    {
      "line": 40,
      "type": "single",
      "original": "# 应该能设置回调",
      "full_line": "        # 应该能设置回调"
    },
    {
      "line": 43,
      "type": "single",
      "original": "# 应该能读取回调",
      "full_line": "        # 应该能读取回调"
    },
    {
      "line": 48,
      "type": "single",
      "original": "# Test 2: _handle_diagnostics 调用 on_raw_diagnostics",
      "full_line": "# Test 2: _handle_diagnostics 调用 on_raw_diagnostics"
    },
    {
      "line": 63,
      "type": "single",
      "original": "# 设置回调",
      "full_line": "        # 设置回调"
    },
    {
      "line": 67,
      "type": "single",
      "original": "# 模拟收到诊断",
      "full_line": "        # 模拟收到诊断"
    },
    {
      "line": 85,
      "type": "single",
      "original": "# on_raw_diagnostics 应该被调用",
      "full_line": "        # on_raw_diagnostics 应该被调用"
    },
    {
      "line": 88,
      "type": "single",
      "original": "# 检查调用参数",
      "full_line": "        # 检查调用参数"
    },
    {
      "line": 107,
      "type": "single",
      "original": "# 设置回调",
      "full_line": "        # 设置回调"
    },
    {
      "line": 111,
      "type": "single",
      "original": "# 模拟收到空诊断（表示没有错误）",
      "full_line": "        # 模拟收到空诊断（表示没有错误）"
    },
    {
      "line": 119,
      "type": "single",
      "original": "# on_raw_diagnostics 应该被调用（即使是空列表）",
      "full_line": "        # on_raw_diagnostics 应该被调用（即使是空列表）"
    },
    {
      "line": 122,
      "type": "single",
      "original": "# 检查调用参数",
      "full_line": "        # 检查调用参数"
    },
    {
      "line": 131,
      "type": "single",
      "original": "# Test 3: 诊断信息格式正确",
      "full_line": "# Test 3: 诊断信息格式正确"
    },
    {
      "line": 168,
      "type": "single",
      "original": "# 检查位置信息 (0-indexed from LSP)",
      "full_line": "        # 检查位置信息 (0-indexed from LSP)"
    },
    {
      "line": 217,
      "type": "single",
      "original": "# Test 4: RawDiagnosticsCallback 类型定义",
      "full_line": "# Test 4: RawDiagnosticsCallback 类型定义"
    },
    {
      "line": 226,
      "type": "single",
      "original": "# 类型应该存在",
      "full_line": "        # 类型应该存在"
    },
    {
      "line": 234,
      "type": "single",
      "original": "# 创建符合签名的函数",
      "full_line": "        # 创建符合签名的函数"
    },
    {
      "line": 240,
      "type": "single",
      "original": "# 应该能设置这个回调",
      "full_line": "        # 应该能设置这个回调"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\nLSP Diagnostics Display Tests\n\nTDD: 测试 LSP 诊断信息推送到前端的功能\n\n测试目标:\n1. LeanLSPClient 应该支持 on_raw_diagnostics 回调\n2. _handle_diagnostics 应该调用 on_raw_diagnostics\n3. 回调应该收到完整的诊断列表 (file_path, diagnostics[])\n4. WebSocket 应该推送 diagnostics_update 消息\n\"\"\"",
      "full_line": "\"\"\"\nLSP Diagnostics Display Tests\n\nTDD: 测试 LSP 诊断信息推送到前端的功能\n\n测试目标:\n1. LeanLSPClient 应该支持 on_raw_diagnostics 回调\n2. _handle_diagnostics 应该调用 on_raw_diagnostics\n3. 回调应该收到完整的诊断列表 (file_path, diagnostics[])\n4. WebSocket 应该推送 diagnostics_update 消息\n\"\"\""
    },
    {
      "line": 22,
      "type": "docstring",
      "original": "\"\"\"原始诊断回调测试\"\"\"",
      "full_line": "    \"\"\"原始诊断回调测试\"\"\""
    },
    {
      "line": 25,
      "type": "docstring",
      "original": "\"\"\"LeanLSPClient 应该有 on_raw_diagnostics 属性\"\"\"",
      "full_line": "        \"\"\"LeanLSPClient 应该有 on_raw_diagnostics 属性\"\"\""
    },
    {
      "line": 34,
      "type": "docstring",
      "original": "\"\"\"应该能设置 on_raw_diagnostics 回调\"\"\"",
      "full_line": "        \"\"\"应该能设置 on_raw_diagnostics 回调\"\"\""
    },
    {
      "line": 51,
      "type": "docstring",
      "original": "\"\"\"_handle_diagnostics 应该调用 on_raw_diagnostics\"\"\"",
      "full_line": "    \"\"\"_handle_diagnostics 应该调用 on_raw_diagnostics\"\"\""
    },
    {
      "line": 55,
      "type": "docstring",
      "original": "\"\"\"收到诊断时应该调用 on_raw_diagnostics\"\"\"",
      "full_line": "        \"\"\"收到诊断时应该调用 on_raw_diagnostics\"\"\""
    },
    {
      "line": 99,
      "type": "docstring",
      "original": "\"\"\"诊断列表为空时也应该调用 on_raw_diagnostics\"\"\"",
      "full_line": "        \"\"\"诊断列表为空时也应该调用 on_raw_diagnostics\"\"\""
    },
    {
      "line": 134,
      "type": "docstring",
      "original": "\"\"\"诊断信息格式测试\"\"\"",
      "full_line": "    \"\"\"诊断信息格式测试\"\"\""
    },
    {
      "line": 138,
      "type": "docstring",
      "original": "\"\"\"诊断应该包含位置信息\"\"\"",
      "full_line": "        \"\"\"诊断应该包含位置信息\"\"\""
    },
    {
      "line": 176,
      "type": "docstring",
      "original": "\"\"\"诊断应该包含严重程度\"\"\"",
      "full_line": "        \"\"\"诊断应该包含严重程度\"\"\""
    },
    {
      "line": 220,
      "type": "docstring",
      "original": "\"\"\"RawDiagnosticsCallback 类型测试\"\"\"",
      "full_line": "    \"\"\"RawDiagnosticsCallback 类型测试\"\"\""
    },
    {
      "line": 223,
      "type": "docstring",
      "original": "\"\"\"RawDiagnosticsCallback 类型应该存在\"\"\"",
      "full_line": "        \"\"\"RawDiagnosticsCallback 类型应该存在\"\"\""
    },
    {
      "line": 230,
      "type": "docstring",
      "original": "\"\"\"回调签名应该是 (file_path: str, diagnostics: list[Diagnostic]) -> None\"\"\"",
      "full_line": "        \"\"\"回调签名应该是 (file_path: str, diagnostics: list[Diagnostic]) -> None\"\"\""
    }
  ],
  "backend/tests/test_models.py": [
    {
      "line": 47,
      "type": "single",
      "original": "# 旧字段，应被忽略",
      "full_line": "            \"texStatement\": \"If $x = 1$...\",  # 旧字段，应被忽略"
    },
    {
      "line": 48,
      "type": "single",
      "original": "# 旧字段，应被忽略",
      "full_line": "            \"texProof\": \"Proof...\",  # 旧字段，应被忽略"
    },
    {
      "line": 52,
      "type": "single",
      "original": "# 确认没有 tex 相关属性",
      "full_line": "        # 确认没有 tex 相关属性"
    },
    {
      "line": 25,
      "type": "docstring",
      "original": "\"\"\"测试 pinned 属性（位置数据已移至 canvas.json）\"\"\"",
      "full_line": "        \"\"\"测试 pinned 属性（位置数据已移至 canvas.json）\"\"\""
    },
    {
      "line": 44,
      "type": "docstring",
      "original": "\"\"\"from_dict 应该忽略旧的 tex 字段（向后兼容）\"\"\"",
      "full_line": "        \"\"\"from_dict 应该忽略旧的 tex 字段（向后兼容）\"\"\""
    },
    {
      "line": 57,
      "type": "docstring",
      "original": "\"\"\"NodeMeta 只包含 notes 字段，不包含 tex 字段\"\"\"",
      "full_line": "        \"\"\"NodeMeta 只包含 notes 字段，不包含 tex 字段\"\"\""
    }
  ],
  "backend/tests/test_edit_realtime_diagnostics.py": [
    {
      "line": 39,
      "type": "single",
      "original": "# 创建模拟项目",
      "full_line": "        # 创建模拟项目"
    },
    {
      "line": 46,
      "type": "single",
      "original": "# Mock LSP 客户端",
      "full_line": "            # Mock LSP 客户端"
    },
    {
      "line": 57,
      "type": "single",
      "original": "# 启动 LSP",
      "full_line": "            # 启动 LSP"
    },
    {
      "line": 61,
      "type": "single",
      "original": "# 存储客户端引用",
      "full_line": "            # 存储客户端引用"
    },
    {
      "line": 64,
      "type": "single",
      "original": "# 模拟文件编辑",
      "full_line": "            # 模拟文件编辑"
    },
    {
      "line": 72,
      "type": "single",
      "original": "# 调用文件变更通知",
      "full_line": "            # 调用文件变更通知"
    },
    {
      "line": 80,
      "type": "single",
      "original": "# 验证 send_did_change 被调用",
      "full_line": "            # 验证 send_did_change 被调用"
    },
    {
      "line": 123,
      "type": "single",
      "original": "# 模拟 LSP 返回诊断（通过回调）",
      "full_line": "            # 模拟 LSP 返回诊断（通过回调）"
    },
    {
      "line": 125,
      "type": "single",
      "original": "# 模拟错误诊断（使用正确的对象格式）",
      "full_line": "                # 模拟错误诊断（使用正确的对象格式）"
    },
    {
      "line": 130,
      "type": "single",
      "original": "# 检查是否收到 diagnostics_update",
      "full_line": "            # 检查是否收到 diagnostics_update"
    },
    {
      "line": 139,
      "type": "single",
      "original": "# 验证诊断内容",
      "full_line": "            # 验证诊断内容"
    },
    {
      "line": 169,
      "type": "single",
      "original": "# 模拟诊断数据",
      "full_line": "        # 模拟诊断数据"
    },
    {
      "line": 181,
      "type": "single",
      "original": "# 格式化为 Monaco 格式",
      "full_line": "        # 格式化为 Monaco 格式"
    },
    {
      "line": 184,
      "type": "single",
      "original": "# 验证 Monaco 格式",
      "full_line": "        # 验证 Monaco 格式"
    },
    {
      "line": 193,
      "type": "single",
      "original": "# 派生 Node 状态",
      "full_line": "        # 派生 Node 状态"
    },
    {
      "line": 214,
      "type": "single",
      "original": "# 这个测试验证配置或常量",
      "full_line": "        # 这个测试验证配置或常量"
    },
    {
      "line": 218,
      "type": "single",
      "original": "# 如果没有这个常量，可能是内联的，跳过",
      "full_line": "            # 如果没有这个常量，可能是内联的，跳过"
    },
    {
      "line": 221,
      "type": "single",
      "original": "# 新架构应该没有延迟或很短的延迟（< 50ms）",
      "full_line": "        # 新架构应该没有延迟或很短的延迟（< 50ms）"
    },
    {
      "line": 267,
      "type": "single",
      "original": "# 模拟 LSP 返回诊断",
      "full_line": "            # 模拟 LSP 返回诊断"
    },
    {
      "line": 271,
      "type": "single",
      "original": "# 分析消息类型",
      "full_line": "            # 分析消息类型"
    },
    {
      "line": 275,
      "type": "single",
      "original": "# 关键断言：如果有 status_update，必须是从 diagnostics 派生的",
      "full_line": "            # 关键断言：如果有 status_update，必须是从 diagnostics 派生的"
    },
    {
      "line": 276,
      "type": "single",
      "original": "# 而不是独立的路径",
      "full_line": "            # 而不是独立的路径"
    },
    {
      "line": 278,
      "type": "single",
      "original": "# 检查是否有对应的 diagnostics_update",
      "full_line": "                # 检查是否有对应的 diagnostics_update"
    },
    {
      "line": 279,
      "type": "single",
      "original": "# 或者 status_update 中包含 \"derived_from_diagnostics\" 标记",
      "full_line": "                # 或者 status_update 中包含 \"derived_from_diagnostics\" 标记"
    },
    {
      "line": 322,
      "type": "single",
      "original": "# 模拟 LSP 返回 sorry 诊断（使用正确的对象格式）",
      "full_line": "            # 模拟 LSP 返回 sorry 诊断（使用正确的对象格式）"
    },
    {
      "line": 328,
      "type": "single",
      "original": "# 检查 diagnostics_update 格式",
      "full_line": "            # 检查 diagnostics_update 格式"
    },
    {
      "line": 337,
      "type": "single",
      "original": "# 必须包含文件路径",
      "full_line": "                # 必须包含文件路径"
    },
    {
      "line": 341,
      "type": "single",
      "original": "# 必须包含诊断列表",
      "full_line": "                # 必须包含诊断列表"
    },
    {
      "line": 345,
      "type": "single",
      "original": "# 每个诊断必须包含位置和消息",
      "full_line": "                # 每个诊断必须包含位置和消息"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\nEdit Realtime Diagnostics Tests\n测试编辑后诊断实时更新\n\nTDD 第一阶段：编写失败测试\n\"\"\"",
      "full_line": "\"\"\"\nEdit Realtime Diagnostics Tests\n测试编辑后诊断实时更新\n\nTDD 第一阶段：编写失败测试\n\"\"\""
    },
    {
      "line": 16,
      "type": "docstring",
      "original": "\"\"\"创建诊断对象（模拟 LeanLSPClient 返回的格式）\"\"\"",
      "full_line": "    \"\"\"创建诊断对象（模拟 LeanLSPClient 返回的格式）\"\"\""
    },
    {
      "line": 28,
      "type": "docstring",
      "original": "\"\"\"测试编辑后诊断实时更新\"\"\"",
      "full_line": "    \"\"\"测试编辑后诊断实时更新\"\"\""
    },
    {
      "line": 32,
      "type": "docstring",
      "original": "        \"\"\"\n        Monaco 编辑后应触发 send_did_change\n\n        Given: LSP 已启动，文件已打开\n        When: 用户在 Monaco 中编辑文件\n        Then: 应该调用 send_did_change 通知 LSP\n        \"\"\"",
      "full_line": "        \"\"\"\n        Monaco 编辑后应触发 send_did_change\n\n        Given: LSP 已启动，文件已打开\n        When: 用户在 Monaco 中编辑文件\n        Then: 应该调用 send_did_change 通知 LSP\n        \"\"\""
    },
    {
      "line": 88,
      "type": "docstring",
      "original": "        \"\"\"\n        send_did_change 后应收到新的 diagnostics_update\n\n        Given: LSP 已启动\n        When: 调用 send_did_change\n        Then: 应该通过 WebSocket 发送 diagnostics_update\n        \"\"\"",
      "full_line": "        \"\"\"\n        send_did_change 后应收到新的 diagnostics_update\n\n        Given: LSP 已启动\n        When: 调用 send_did_change\n        Then: 应该通过 WebSocket 发送 diagnostics_update\n        \"\"\""
    },
    {
      "line": 148,
      "type": "docstring",
      "original": "        \"\"\"\n        diagnostics_update 应同时更新 Monaco 波浪线和 Node 光环\n\n        这个测试验证：\n        1. diagnostics_update 包含足够的信息让前端更新 Monaco\n        2. diagnostics_update 包含足够的信息让前端派生 Node 状态\n\n        Given: 收到 diagnostics_update\n        Then: 消息格式应支持同时更新 Monaco 和 Node 状态\n        \"\"\"",
      "full_line": "        \"\"\"\n        diagnostics_update 应同时更新 Monaco 波浪线和 Node 光环\n\n        这个测试验证：\n        1. diagnostics_update 包含足够的信息让前端更新 Monaco\n        2. diagnostics_update 包含足够的信息让前端派生 Node 状态\n\n        Given: 收到 diagnostics_update\n        Then: 消息格式应支持同时更新 Monaco 和 Node 状态\n        \"\"\""
    },
    {
      "line": 206,
      "type": "docstring",
      "original": "\"\"\"测试移除诊断更新的防抖延迟\"\"\"",
      "full_line": "    \"\"\"测试移除诊断更新的防抖延迟\"\"\""
    },
    {
      "line": 209,
      "type": "docstring",
      "original": "        \"\"\"\n        新架构下，diagnostics_update 不应有额外延迟\n\n        当前实现有 150ms 防抖，新架构应该立即派发或使用更短的延迟\n        \"\"\"",
      "full_line": "        \"\"\"\n        新架构下，diagnostics_update 不应有额外延迟\n\n        当前实现有 150ms 防抖，新架构应该立即派发或使用更短的延迟\n        \"\"\""
    },
    {
      "line": 228,
      "type": "docstring",
      "original": "\"\"\"测试单一数据源架构\"\"\"",
      "full_line": "    \"\"\"测试单一数据源架构\"\"\""
    },
    {
      "line": 232,
      "type": "docstring",
      "original": "        \"\"\"\n        status_update 和 diagnostics_update 不应该是独立路径\n\n        新架构下：\n        - diagnostics_update 是唯一的数据源\n        - Node 状态从 diagnostics 派生\n        - 不应该有独立的 status_update 消息\n        \"\"\"",
      "full_line": "        \"\"\"\n        status_update 和 diagnostics_update 不应该是独立路径\n\n        新架构下：\n        - diagnostics_update 是唯一的数据源\n        - Node 状态从 diagnostics 派生\n        - 不应该有独立的 status_update 消息\n        \"\"\""
    },
    {
      "line": 287,
      "type": "docstring",
      "original": "        \"\"\"\n        diagnostics_update 应包含足够信息让前端派生状态\n\n        包括：\n        - 文件路径\n        - 诊断列表（行号、消息、严重性）\n        - 可选：受影响的节点 ID 列表\n        \"\"\"",
      "full_line": "        \"\"\"\n        diagnostics_update 应包含足够信息让前端派生状态\n\n        包括：\n        - 文件路径\n        - 诊断列表（行号、消息、严重性）\n        - 可选：受影响的节点 ID 列表\n        \"\"\""
    }
  ],
  "backend/tests/test_lsp_integration.py": [
    {
      "line": 11,
      "type": "single",
      "original": "# 测试 1：LSP 客户端基础功能",
      "full_line": "# 测试 1：LSP 客户端基础功能"
    },
    {
      "line": 27,
      "type": "single",
      "original": "# 不实际启动，只测试接口存在",
      "full_line": "        # 不实际启动，只测试接口存在"
    },
    {
      "line": 46,
      "type": "single",
      "original": "# 测试 2：诊断解析",
      "full_line": "# 测试 2：诊断解析"
    },
    {
      "line": 94,
      "type": "single",
      "original": "# 测试 3：完整流程",
      "full_line": "# 测试 3：完整流程"
    },
    {
      "line": 103,
      "type": "single",
      "original": "# 这个测试需要真实的 Lean 项目",
      "full_line": "        # 这个测试需要真实的 Lean 项目"
    },
    {
      "line": 104,
      "type": "single",
      "original": "# 先跳过，手动验证",
      "full_line": "        # 先跳过，手动验证"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\nLSP Integration Tests\n测试 LSP 客户端和实时状态更新功能\n\"\"\"",
      "full_line": "\"\"\"\nLSP Integration Tests\n测试 LSP 客户端和实时状态更新功能\n\"\"\""
    },
    {
      "line": 15,
      "type": "docstring",
      "original": "\"\"\"LSP 客户端测试\"\"\"",
      "full_line": "    \"\"\"LSP 客户端测试\"\"\""
    },
    {
      "line": 18,
      "type": "docstring",
      "original": "\"\"\"应该有 LeanLSPClient 类\"\"\"",
      "full_line": "        \"\"\"应该有 LeanLSPClient 类\"\"\""
    },
    {
      "line": 24,
      "type": "docstring",
      "original": "\"\"\"LSP 客户端应该能启动 lake serve\"\"\"",
      "full_line": "        \"\"\"LSP 客户端应该能启动 lake serve\"\"\""
    },
    {
      "line": 33,
      "type": "docstring",
      "original": "\"\"\"应该能发送 didOpen 通知\"\"\"",
      "full_line": "        \"\"\"应该能发送 didOpen 通知\"\"\""
    },
    {
      "line": 39,
      "type": "docstring",
      "original": "\"\"\"应该能发送 didChange 通知\"\"\"",
      "full_line": "        \"\"\"应该能发送 didChange 通知\"\"\""
    },
    {
      "line": 50,
      "type": "docstring",
      "original": "\"\"\"诊断解析测试\"\"\"",
      "full_line": "    \"\"\"诊断解析测试\"\"\""
    },
    {
      "line": 53,
      "type": "docstring",
      "original": "\"\"\"从诊断行号向上找到定理名\"\"\"",
      "full_line": "        \"\"\"从诊断行号向上找到定理名\"\"\""
    },
    {
      "line": 71,
      "type": "docstring",
      "original": "\"\"\"多行签名的定理\"\"\"",
      "full_line": "        \"\"\"多行签名的定理\"\"\""
    },
    {
      "line": 85,
      "type": "docstring",
      "original": "\"\"\"解析诊断消息，提取状态\"\"\"",
      "full_line": "        \"\"\"解析诊断消息，提取状态\"\"\""
    },
    {
      "line": 98,
      "type": "docstring",
      "original": "\"\"\"完整流程测试\"\"\"",
      "full_line": "    \"\"\"完整流程测试\"\"\""
    },
    {
      "line": 102,
      "type": "docstring",
      "original": "\"\"\"文件变化 → LSP 诊断 → 状态更新\"\"\"",
      "full_line": "        \"\"\"文件变化 → LSP 诊断 → 状态更新\"\"\""
    }
  ],
  "backend/tests/test_default_styles.py": [
    {
      "line": 10,
      "type": "single",
      "original": "# 导入需要测试的模块",
      "full_line": "# 导入需要测试的模块"
    },
    {
      "line": 46,
      "type": "single",
      "original": "# 默认值（未设置时）",
      "full_line": "        # 默认值（未设置时）"
    },
    {
      "line": 146,
      "type": "single",
      "original": "# 所有可用形状（与 assets/nodes/index.json 一致）",
      "full_line": "        # 所有可用形状（与 assets/nodes/index.json 一致）"
    },
    {
      "line": 200,
      "type": "single",
      "original": "# 创建节点",
      "full_line": "        # 创建节点"
    },
    {
      "line": 209,
      "type": "single",
      "original": "# 手动调用设置默认样式的逻辑",
      "full_line": "        # 手动调用设置默认样式的逻辑"
    },
    {
      "line": 215,
      "type": "single",
      "original": "# 验证样式与主题配置一致",
      "full_line": "        # 验证样式与主题配置一致"
    },
    {
      "line": 223,
      "type": "single",
      "original": "# 读取 theme 文件",
      "full_line": "        # 读取 theme 文件"
    },
    {
      "line": 228,
      "type": "single",
      "original": "# 验证每个 kind 的样式匹配",
      "full_line": "        # 验证每个 kind 的样式匹配"
    },
    {
      "line": 254,
      "type": "single",
      "original": "# 验证使用 camelCase",
      "full_line": "        # 验证使用 camelCase"
    },
    {
      "line": 259,
      "type": "single",
      "original": "# 验证值正确",
      "full_line": "        # 验证值正确"
    },
    {
      "line": 265,
      "type": "single",
      "original": "# 运行测试",
      "full_line": "# 运行测试"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\n测试 graph.json 默认样式功能\n\"\"\"",
      "full_line": "\"\"\"\n测试 graph.json 默认样式功能\n\"\"\""
    },
    {
      "line": 22,
      "type": "docstring",
      "original": "\"\"\"测试 Node 默认样式\"\"\"",
      "full_line": "    \"\"\"测试 Node 默认样式\"\"\""
    },
    {
      "line": 25,
      "type": "docstring",
      "original": "\"\"\"Node 类应该有默认样式字段\"\"\"",
      "full_line": "        \"\"\"Node 类应该有默认样式字段\"\"\""
    },
    {
      "line": 38,
      "type": "docstring",
      "original": "\"\"\"Node 默认样式应该有默认值\"\"\"",
      "full_line": "        \"\"\"Node 默认样式应该有默认值\"\"\""
    },
    {
      "line": 52,
      "type": "docstring",
      "original": "\"\"\"Node.to_dict() 应该包含默认样式字段\"\"\"",
      "full_line": "        \"\"\"Node.to_dict() 应该包含默认样式字段\"\"\""
    },
    {
      "line": 70,
      "type": "docstring",
      "original": "\"\"\"测试 Edge 默认样式\"\"\"",
      "full_line": "    \"\"\"测试 Edge 默认样式\"\"\""
    },
    {
      "line": 73,
      "type": "docstring",
      "original": "\"\"\"Edge 类应该有默认样式字段\"\"\"",
      "full_line": "        \"\"\"Edge 类应该有默认样式字段\"\"\""
    },
    {
      "line": 84,
      "type": "docstring",
      "original": "\"\"\"Edge 默认样式应该有默认值\"\"\"",
      "full_line": "        \"\"\"Edge 默认样式应该有默认值\"\"\""
    },
    {
      "line": 95,
      "type": "docstring",
      "original": "\"\"\"Edge.to_dict() 应该包含默认样式字段\"\"\"",
      "full_line": "        \"\"\"Edge.to_dict() 应该包含默认样式字段\"\"\""
    },
    {
      "line": 111,
      "type": "docstring",
      "original": "\"\"\"测试默认样式映射\"\"\"",
      "full_line": "    \"\"\"测试默认样式映射\"\"\""
    },
    {
      "line": 114,
      "type": "docstring",
      "original": "\"\"\"NODE_STYLE_DEFAULTS 应该定义所有 kind\"\"\"",
      "full_line": "        \"\"\"NODE_STYLE_DEFAULTS 应该定义所有 kind\"\"\""
    },
    {
      "line": 124,
      "type": "docstring",
      "original": "\"\"\"每个 kind 的默认样式应该有 color, size, shape\"\"\"",
      "full_line": "        \"\"\"每个 kind 的默认样式应该有 color, size, shape\"\"\""
    },
    {
      "line": 131,
      "type": "docstring",
      "original": "\"\"\"颜色应该是有效的 hex 格式\"\"\"",
      "full_line": "        \"\"\"颜色应该是有效的 hex 格式\"\"\""
    },
    {
      "line": 138,
      "type": "docstring",
      "original": "\"\"\"大小应该是正数\"\"\"",
      "full_line": "        \"\"\"大小应该是正数\"\"\""
    },
    {
      "line": 145,
      "type": "docstring",
      "original": "\"\"\"形状应该是有效值\"\"\"",
      "full_line": "        \"\"\"形状应该是有效值\"\"\""
    },
    {
      "line": 156,
      "type": "docstring",
      "original": "\"\"\"EDGE_STYLE_DEFAULTS 应该有 True 和 False\"\"\"",
      "full_line": "        \"\"\"EDGE_STYLE_DEFAULTS 应该有 True 和 False\"\"\""
    },
    {
      "line": 161,
      "type": "docstring",
      "original": "\"\"\"边默认样式应该有 color, width, style\"\"\"",
      "full_line": "        \"\"\"边默认样式应该有 color, width, style\"\"\""
    },
    {
      "line": 168,
      "type": "docstring",
      "original": "\"\"\"边样式应该是有效值\"\"\"",
      "full_line": "        \"\"\"边样式应该是有效值\"\"\""
    },
    {
      "line": 176,
      "type": "docstring",
      "original": "\"\"\"测试默认兜底值\"\"\"",
      "full_line": "    \"\"\"测试默认兜底值\"\"\""
    },
    {
      "line": 179,
      "type": "docstring",
      "original": "\"\"\"DEFAULT_NODE_STYLE 应该存在\"\"\"",
      "full_line": "        \"\"\"DEFAULT_NODE_STYLE 应该存在\"\"\""
    },
    {
      "line": 186,
      "type": "docstring",
      "original": "\"\"\"DEFAULT_EDGE_STYLE 应该存在\"\"\"",
      "full_line": "        \"\"\"DEFAULT_EDGE_STYLE 应该存在\"\"\""
    },
    {
      "line": 194,
      "type": "docstring",
      "original": "\"\"\"测试 Project._set_default_styles() 正确应用主题样式\"\"\"",
      "full_line": "    \"\"\"测试 Project._set_default_styles() 正确应用主题样式\"\"\""
    },
    {
      "line": 197,
      "type": "docstring",
      "original": "\"\"\"Project._set_default_styles() 应该根据 kind 设置正确的样式\"\"\"",
      "full_line": "        \"\"\"Project._set_default_styles() 应该根据 kind 设置正确的样式\"\"\""
    },
    {
      "line": 222,
      "type": "docstring",
      "original": "\"\"\"NODE_STYLE_DEFAULTS 应该与 assets/themes/default.json 一致\"\"\"",
      "full_line": "        \"\"\"NODE_STYLE_DEFAULTS 应该与 assets/themes/default.json 一致\"\"\""
    },
    {
      "line": 238,
      "type": "docstring",
      "original": "\"\"\"测试 Node.to_dict() 返回正确的默认样式字段\"\"\"",
      "full_line": "    \"\"\"测试 Node.to_dict() 返回正确的默认样式字段\"\"\""
    },
    {
      "line": 241,
      "type": "docstring",
      "original": "\"\"\"to_dict() 应该使用 camelCase 字段名\"\"\"",
      "full_line": "        \"\"\"to_dict() 应该使用 camelCase 字段名\"\"\""
    }
  ],
  "backend/tests/test_diagnostic_unified_flow.py": [
    {
      "line": 22,
      "type": "single",
      "original": "# 创建 .astrolabe 目录",
      "full_line": "        # 创建 .astrolabe 目录"
    },
    {
      "line": 26,
      "type": "single",
      "original": "# 创建 .lean 文件",
      "full_line": "        # 创建 .lean 文件"
    },
    {
      "line": 37,
      "type": "single",
      "original": "# 创建 graph.json（包含节点信息）",
      "full_line": "        # 创建 graph.json（包含节点信息）"
    },
    {
      "line": 74,
      "type": "single",
      "original": "# 追踪 WebSocket 消息",
      "full_line": "        # 追踪 WebSocket 消息"
    },
    {
      "line": 87,
      "type": "single",
      "original": "# Mock LSP 客户端",
      "full_line": "            # Mock LSP 客户端"
    },
    {
      "line": 97,
      "type": "single",
      "original": "# 启动 LSP",
      "full_line": "            # 启动 LSP"
    },
    {
      "line": 101,
      "type": "single",
      "original": "# 模拟 LSP 返回空诊断（无错误）",
      "full_line": "            # 模拟 LSP 返回空诊断（无错误）"
    },
    {
      "line": 105,
      "type": "single",
      "original": "# 检查：应该发送 diagnostics_update，节点状态应从此派生",
      "full_line": "            # 检查：应该发送 diagnostics_update，节点状态应从此派生"
    },
    {
      "line": 106,
      "type": "single",
      "original": "# 新架构下，不应该有独立的 status_update 消息",
      "full_line": "            # 新架构下，不应该有独立的 status_update 消息"
    },
    {
      "line": 110,
      "type": "single",
      "original": "# 关键断言：不应该有独立的 status_update",
      "full_line": "            # 关键断言：不应该有独立的 status_update"
    },
    {
      "line": 111,
      "type": "single",
      "original": "# 状态应该从 diagnostics_update 派生",
      "full_line": "            # 状态应该从 diagnostics_update 派生"
    },
    {
      "line": 116,
      "type": "single",
      "original": "# 应该有 diagnostics_update",
      "full_line": "            # 应该有 diagnostics_update"
    },
    {
      "line": 131,
      "type": "single",
      "original": "# 这个测试验证：前端从 diagnostics_update 派生 error 状态",
      "full_line": "        # 这个测试验证：前端从 diagnostics_update 派生 error 状态"
    },
    {
      "line": 132,
      "type": "single",
      "original": "# 需要一个函数来从诊断派生节点状态",
      "full_line": "        # 需要一个函数来从诊断派生节点状态"
    },
    {
      "line": 141,
      "type": "single",
      "original": "# 模拟诊断数据（包含 error）",
      "full_line": "        # 模拟诊断数据（包含 error）"
    },
    {
      "line": 153,
      "type": "single",
      "original": "# 节点信息",
      "full_line": "        # 节点信息"
    },
    {
      "line": 160,
      "type": "single",
      "original": "# 派生状态",
      "full_line": "        # 派生状态"
    },
    {
      "line": 184,
      "type": "single",
      "original": "# 模拟诊断数据（包含 sorry）",
      "full_line": "        # 模拟诊断数据（包含 sorry）"
    },
    {
      "line": 196,
      "type": "single",
      "original": "# 节点信息",
      "full_line": "        # 节点信息"
    },
    {
      "line": 203,
      "type": "single",
      "original": "# 派生状态",
      "full_line": "        # 派生状态"
    },
    {
      "line": 227,
      "type": "single",
      "original": "# 空诊断",
      "full_line": "        # 空诊断"
    },
    {
      "line": 230,
      "type": "single",
      "original": "# 节点信息",
      "full_line": "        # 节点信息"
    },
    {
      "line": 237,
      "type": "single",
      "original": "# 派生状态",
      "full_line": "        # 派生状态"
    },
    {
      "line": 277,
      "type": "single",
      "original": "# 关键断言：不应发送 cached_status_batch",
      "full_line": "            # 关键断言：不应发送 cached_status_batch"
    },
    {
      "line": 278,
      "type": "single",
      "original": "# 新架构下，节点状态完全从实时 diagnostics_update 派生",
      "full_line": "            # 新架构下，节点状态完全从实时 diagnostics_update 派生"
    },
    {
      "line": 287,
      "type": "single",
      "original": "# 也不应发送独立的 status_update",
      "full_line": "            # 也不应发送独立的 status_update"
    },
    {
      "line": 327,
      "type": "single",
      "original": "# warning 但不是 sorry，应该还是显示某种状态",
      "full_line": "        # warning 但不是 sorry，应该还是显示某种状态"
    },
    {
      "line": 329,
      "type": "single",
      "original": "# 根据实际需求，可能是 error 或保持当前状态",
      "full_line": "        # 根据实际需求，可能是 error 或保持当前状态"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\nUnified Diagnostic Flow Tests\n测试 Node 光环从 Monaco 诊断派生，而非独立路径\n\nTDD 第一阶段：编写失败测试\n\"\"\"",
      "full_line": "\"\"\"\nUnified Diagnostic Flow Tests\n测试 Node 光环从 Monaco 诊断派生，而非独立路径\n\nTDD 第一阶段：编写失败测试\n\"\"\""
    },
    {
      "line": 17,
      "type": "docstring",
      "original": "\"\"\"测试 Node 光环从 Monaco 诊断派生，而非独立路径\"\"\"",
      "full_line": "    \"\"\"测试 Node 光环从 Monaco 诊断派生，而非独立路径\"\"\""
    },
    {
      "line": 21,
      "type": "docstring",
      "original": "\"\"\"创建带有 theorem 节点的模拟项目\"\"\"",
      "full_line": "        \"\"\"创建带有 theorem 节点的模拟项目\"\"\""
    },
    {
      "line": 65,
      "type": "docstring",
      "original": "        \"\"\"\n        Node 状态必须从 diagnostics_update 派生，不能从 status_update 直接设置\n\n        Given: 一个 theorem 节点\n        When: 收到该节点对应文件的 diagnostics_update（无错误）\n        Then: 节点状态变为 proven\n        \"\"\"",
      "full_line": "        \"\"\"\n        Node 状态必须从 diagnostics_update 派生，不能从 status_update 直接设置\n\n        Given: 一个 theorem 节点\n        When: 收到该节点对应文件的 diagnostics_update（无错误）\n        Then: 节点状态变为 proven\n        \"\"\""
    },
    {
      "line": 122,
      "type": "docstring",
      "original": "        \"\"\"\n        诊断包含 error 时，节点状态应为 error\n\n        Given: 一个 theorem 节点\n        When: 收到 diagnostics_update，包含该节点位置的 error\n        Then: 节点状态变为 error（通过派生逻辑）\n        \"\"\"",
      "full_line": "        \"\"\"\n        诊断包含 error 时，节点状态应为 error\n\n        Given: 一个 theorem 节点\n        When: 收到 diagnostics_update，包含该节点位置的 error\n        Then: 节点状态变为 error（通过派生逻辑）\n        \"\"\""
    },
    {
      "line": 168,
      "type": "docstring",
      "original": "        \"\"\"\n        诊断包含 sorry 时，节点状态应为 sorry\n\n        Given: 一个 theorem 节点\n        When: 收到 diagnostics_update，包含 \"sorry\" 消息\n        Then: 节点状态变为 sorry（通过派生逻辑）\n        \"\"\"",
      "full_line": "        \"\"\"\n        诊断包含 sorry 时，节点状态应为 sorry\n\n        Given: 一个 theorem 节点\n        When: 收到 diagnostics_update，包含 \"sorry\" 消息\n        Then: 节点状态变为 sorry（通过派生逻辑）\n        \"\"\""
    },
    {
      "line": 211,
      "type": "docstring",
      "original": "        \"\"\"\n        无诊断时，节点状态应为 proven\n\n        Given: 一个 theorem 节点\n        When: 收到空的 diagnostics_update（无错误、无警告）\n        Then: 节点状态变为 proven\n        \"\"\"",
      "full_line": "        \"\"\"\n        无诊断时，节点状态应为 proven\n\n        Given: 一个 theorem 节点\n        When: 收到空的 diagnostics_update（无错误、无警告）\n        Then: 节点状态变为 proven\n        \"\"\""
    },
    {
      "line": 245,
      "type": "docstring",
      "original": "        \"\"\"\n        新架构下，LSP 启动时不发送 cached_status_batch\n\n        Given: LSP 启动\n        Then: 不发送 cached_status_batch，节点状态完全从实时 diagnostics_update 派生\n        \"\"\"",
      "full_line": "        \"\"\"\n        新架构下，LSP 启动时不发送 cached_status_batch\n\n        Given: LSP 启动\n        Then: 不发送 cached_status_batch，节点状态完全从实时 diagnostics_update 派生\n        \"\"\""
    },
    {
      "line": 298,
      "type": "docstring",
      "original": "\"\"\"测试诊断消息到节点状态的映射逻辑\"\"\"",
      "full_line": "    \"\"\"测试诊断消息到节点状态的映射逻辑\"\"\""
    },
    {
      "line": 301,
      "type": "docstring",
      "original": "\"\"\"severity=1 (error) 应映射到 error 状态\"\"\"",
      "full_line": "        \"\"\"severity=1 (error) 应映射到 error 状态\"\"\""
    },
    {
      "line": 311,
      "type": "docstring",
      "original": "\"\"\"包含 'sorry' 的消息应映射到 sorry 状态\"\"\"",
      "full_line": "        \"\"\"包含 'sorry' 的消息应映射到 sorry 状态\"\"\""
    },
    {
      "line": 321,
      "type": "docstring",
      "original": "\"\"\"非 sorry 的 warning 应映射到什么状态？\"\"\"",
      "full_line": "        \"\"\"非 sorry 的 warning 应映射到什么状态？\"\"\""
    }
  ],
  "backend/tests/test_status_ring_filtering.py": [
    {
      "line": 26,
      "type": "single",
      "original": "# 验证包含必要的类型",
      "full_line": "        # 验证包含必要的类型"
    },
    {
      "line": 32,
      "type": "single",
      "original": "# 验证不包含不需要的类型",
      "full_line": "        # 验证不包含不需要的类型"
    },
    {
      "line": 199,
      "type": "single",
      "original": "# 模拟不同类型的节点",
      "full_line": "        # 模拟不同类型的节点"
    },
    {
      "line": 207,
      "type": "single",
      "original": "# 空诊断（全部通过）",
      "full_line": "        # 空诊断（全部通过）"
    },
    {
      "line": 210,
      "type": "single",
      "original": "# 派生状态",
      "full_line": "        # 派生状态"
    },
    {
      "line": 217,
      "type": "single",
      "original": "# 不需要光环的节点，不应该派生状态",
      "full_line": "                # 不需要光环的节点，不应该派生状态"
    },
    {
      "line": 218,
      "type": "single",
      "original": "# 或者返回 None/unknown",
      "full_line": "                # 或者返回 None/unknown"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\nStatus Ring Filtering Tests\n测试只有 theorem/lemma 等类型才显示光环\n\nTDD 第一阶段：编写失败测试\n\"\"\"",
      "full_line": "\"\"\"\nStatus Ring Filtering Tests\n测试只有 theorem/lemma 等类型才显示光环\n\nTDD 第一阶段：编写失败测试\n\"\"\""
    },
    {
      "line": 12,
      "type": "docstring",
      "original": "\"\"\"测试只有 theorem/lemma 等类型才显示光环\"\"\"",
      "full_line": "    \"\"\"测试只有 theorem/lemma 等类型才显示光环\"\"\""
    },
    {
      "line": 15,
      "type": "docstring",
      "original": "        \"\"\"\n        应该有一个常量定义哪些节点类型需要显示光环\n        \"\"\"",
      "full_line": "        \"\"\"\n        应该有一个常量定义哪些节点类型需要显示光环\n        \"\"\""
    },
    {
      "line": 41,
      "type": "docstring",
      "original": "\"\"\"theorem 类型节点应显示光环\"\"\"",
      "full_line": "        \"\"\"theorem 类型节点应显示光环\"\"\""
    },
    {
      "line": 51,
      "type": "docstring",
      "original": "\"\"\"lemma 类型节点应显示光环\"\"\"",
      "full_line": "        \"\"\"lemma 类型节点应显示光环\"\"\""
    },
    {
      "line": 61,
      "type": "docstring",
      "original": "\"\"\"proposition 类型节点应显示光环\"\"\"",
      "full_line": "        \"\"\"proposition 类型节点应显示光环\"\"\""
    },
    {
      "line": 71,
      "type": "docstring",
      "original": "\"\"\"corollary 类型节点应显示光环\"\"\"",
      "full_line": "        \"\"\"corollary 类型节点应显示光环\"\"\""
    },
    {
      "line": 81,
      "type": "docstring",
      "original": "\"\"\"definition 类型节点不应显示光环\"\"\"",
      "full_line": "        \"\"\"definition 类型节点不应显示光环\"\"\""
    },
    {
      "line": 91,
      "type": "docstring",
      "original": "\"\"\"axiom 类型节点不应显示光环\"\"\"",
      "full_line": "        \"\"\"axiom 类型节点不应显示光环\"\"\""
    },
    {
      "line": 101,
      "type": "docstring",
      "original": "\"\"\"structure 类型节点不应显示光环\"\"\"",
      "full_line": "        \"\"\"structure 类型节点不应显示光环\"\"\""
    },
    {
      "line": 111,
      "type": "docstring",
      "original": "\"\"\"class 类型节点不应显示光环\"\"\"",
      "full_line": "        \"\"\"class 类型节点不应显示光环\"\"\""
    },
    {
      "line": 121,
      "type": "docstring",
      "original": "\"\"\"instance 类型节点不应显示光环\"\"\"",
      "full_line": "        \"\"\"instance 类型节点不应显示光环\"\"\""
    },
    {
      "line": 131,
      "type": "docstring",
      "original": "\"\"\"inductive 类型节点不应显示光环\"\"\"",
      "full_line": "        \"\"\"inductive 类型节点不应显示光环\"\"\""
    },
    {
      "line": 141,
      "type": "docstring",
      "original": "\"\"\"example 类型节点不应显示光环\"\"\"",
      "full_line": "        \"\"\"example 类型节点不应显示光环\"\"\""
    },
    {
      "line": 151,
      "type": "docstring",
      "original": "\"\"\"custom（用户自定义）类型节点不应显示光环\"\"\"",
      "full_line": "        \"\"\"custom（用户自定义）类型节点不应显示光环\"\"\""
    },
    {
      "line": 161,
      "type": "docstring",
      "original": "\"\"\"未知类型节点不应显示光环\"\"\"",
      "full_line": "        \"\"\"未知类型节点不应显示光环\"\"\""
    },
    {
      "line": 178,
      "type": "docstring",
      "original": "\"\"\"测试诊断处理器中的类型过滤\"\"\"",
      "full_line": "    \"\"\"测试诊断处理器中的类型过滤\"\"\""
    },
    {
      "line": 181,
      "type": "docstring",
      "original": "        \"\"\"\n        诊断处理器应该只为需要证明的节点类型派发状态\n\n        Given: 诊断结果包含多个节点\n        When: 处理诊断\n        Then: 只有 theorem/lemma 等类型收到状态更新\n        \"\"\"",
      "full_line": "        \"\"\"\n        诊断处理器应该只为需要证明的节点类型派发状态\n\n        Given: 诊断结果包含多个节点\n        When: 处理诊断\n        Then: 只有 theorem/lemma 等类型收到状态更新\n        \"\"\""
    }
  ],
  "backend/tests/test_canvas_3d.py": [
    {
      "line": 37,
      "type": "single",
      "original": "# 直接读取文件验证",
      "full_line": "        # 直接读取文件验证"
    },
    {
      "line": 73,
      "type": "single",
      "original": "# 新建 store 实例模拟重新加载",
      "full_line": "        # 新建 store 实例模拟重新加载"
    },
    {
      "line": 149,
      "type": "single",
      "original": "# 旧格式，无 z",
      "full_line": "            \"positions\": {\"node_1\": {\"x\": 1.0, \"y\": 2.0}},  # 旧格式，无 z"
    },
    {
      "line": 154,
      "type": "single",
      "original": "# z 应该默认为 0",
      "full_line": "        # z 应该默认为 0"
    },
    {
      "line": 167,
      "type": "single",
      "original": "# 1. 添加节点到画布",
      "full_line": "        # 1. 添加节点到画布"
    },
    {
      "line": 171,
      "type": "single",
      "original": "# 2. 设置 3D 位置（模拟用户拖拽）",
      "full_line": "        # 2. 设置 3D 位置（模拟用户拖拽）"
    },
    {
      "line": 175,
      "type": "single",
      "original": "# 3. 保存后重新加载",
      "full_line": "        # 3. 保存后重新加载"
    },
    {
      "line": 179,
      "type": "single",
      "original": "# 4. 验证位置被正确保存和加载",
      "full_line": "        # 4. 验证位置被正确保存和加载"
    },
    {
      "line": 192,
      "type": "single",
      "original": "# 节点在可见列表中，但没有位置",
      "full_line": "        # 节点在可见列表中，但没有位置"
    },
    {
      "line": 201,
      "type": "single",
      "original": "# 添加节点（无位置）",
      "full_line": "        # 添加节点（无位置）"
    },
    {
      "line": 204,
      "type": "single",
      "original": "# 后续设置位置（物理模拟稳定后）",
      "full_line": "        # 后续设置位置（物理模拟稳定后）"
    },
    {
      "line": 225,
      "type": "single",
      "original": "# 不存在 canvas.json",
      "full_line": "        # 不存在 canvas.json"
    },
    {
      "line": 229,
      "type": "single",
      "original": "# load 返回空画布",
      "full_line": "        # load 返回空画布"
    },
    {
      "line": 1,
      "type": "docstring",
      "original": "\"\"\"\n测试 Canvas 3D 位置存储\n\n设计原则：\n- canvas.json 保存 3D 位置 {x, y, z}\n- meta.json 不保存位置信息\n- 加载时直接从 canvas.json 读取 3D 位置渲染\n\"\"\"",
      "full_line": "\"\"\"\n测试 Canvas 3D 位置存储\n\n设计原则：\n- canvas.json 保存 3D 位置 {x, y, z}\n- meta.json 不保存位置信息\n- 加载时直接从 canvas.json 读取 3D 位置渲染\n\"\"\""
    },
    {
      "line": 17,
      "type": "docstring",
      "original": "\"\"\"测试 canvas.json 3D 位置存储\"\"\"",
      "full_line": "    \"\"\"测试 canvas.json 3D 位置存储\"\"\""
    },
    {
      "line": 20,
      "type": "docstring",
      "original": "\"\"\"位置应该是 3D 的 {x, y, z}\"\"\"",
      "full_line": "        \"\"\"位置应该是 3D 的 {x, y, z}\"\"\""
    },
    {
      "line": 30,
      "type": "docstring",
      "original": "\"\"\"3D 位置应该正确持久化到文件\"\"\"",
      "full_line": "        \"\"\"3D 位置应该正确持久化到文件\"\"\""
    },
    {
      "line": 45,
      "type": "docstring",
      "original": "\"\"\"批量更新 3D 位置\"\"\"",
      "full_line": "        \"\"\"批量更新 3D 位置\"\"\""
    },
    {
      "line": 66,
      "type": "docstring",
      "original": "\"\"\"加载时应该正确读取 3D 位置\"\"\"",
      "full_line": "        \"\"\"加载时应该正确读取 3D 位置\"\"\""
    },
    {
      "line": 80,
      "type": "docstring",
      "original": "\"\"\"验证位置必须包含 z 字段\"\"\"",
      "full_line": "        \"\"\"验证位置必须包含 z 字段\"\"\""
    },
    {
      "line": 93,
      "type": "docstring",
      "original": "\"\"\"移除节点时也应该移除对应的 3D 位置\"\"\"",
      "full_line": "        \"\"\"移除节点时也应该移除对应的 3D 位置\"\"\""
    },
    {
      "line": 105,
      "type": "docstring",
      "original": "\"\"\"清空画布应该移除所有 3D 位置\"\"\"",
      "full_line": "        \"\"\"清空画布应该移除所有 3D 位置\"\"\""
    },
    {
      "line": 121,
      "type": "docstring",
      "original": "\"\"\"测试 CanvasData 3D 位置序列化\"\"\"",
      "full_line": "    \"\"\"测试 CanvasData 3D 位置序列化\"\"\""
    },
    {
      "line": 124,
      "type": "docstring",
      "original": "\"\"\"序列化应该包含 3D 位置\"\"\"",
      "full_line": "        \"\"\"序列化应该包含 3D 位置\"\"\""
    },
    {
      "line": 135,
      "type": "docstring",
      "original": "\"\"\"反序列化应该正确读取 3D 位置\"\"\"",
      "full_line": "        \"\"\"反序列化应该正确读取 3D 位置\"\"\""
    },
    {
      "line": 146,
      "type": "docstring",
      "original": "\"\"\"向后兼容：读取旧的 2D 位置时 z 默认为 0\"\"\"",
      "full_line": "        \"\"\"向后兼容：读取旧的 2D 位置时 z 默认为 0\"\"\""
    },
    {
      "line": 160,
      "type": "docstring",
      "original": "\"\"\"完整 3D 工作流程测试\"\"\"",
      "full_line": "    \"\"\"完整 3D 工作流程测试\"\"\""
    },
    {
      "line": 163,
      "type": "docstring",
      "original": "\"\"\"完整的 3D 位置工作流程\"\"\"",
      "full_line": "        \"\"\"完整的 3D 位置工作流程\"\"\""
    },
    {
      "line": 186,
      "type": "docstring",
      "original": "\"\"\"添加节点时不需要立即设置位置\"\"\"",
      "full_line": "        \"\"\"添加节点时不需要立即设置位置\"\"\""
    },
    {
      "line": 197,
      "type": "docstring",
      "original": "\"\"\"先添加节点，后设置位置\"\"\"",
      "full_line": "        \"\"\"先添加节点，后设置位置\"\"\""
    },
    {
      "line": 211,
      "type": "docstring",
      "original": "\"\"\"空画布测试\"\"\"",
      "full_line": "    \"\"\"空画布测试\"\"\""
    },
    {
      "line": 214,
      "type": "docstring",
      "original": "\"\"\"空画布没有位置数据\"\"\"",
      "full_line": "        \"\"\"空画布没有位置数据\"\"\""
    },
    {
      "line": 222,
      "type": "docstring",
      "original": "\"\"\"新项目从空画布开始\"\"\"",
      "full_line": "        \"\"\"新项目从空画布开始\"\"\""
    }
  ],
  "backend/astrolabe/parsers/ilean_parser.py": [
    {
      "line": 470,
      "type": "single",
      "original": "# 获取项目名称",
      "full_line": "    # 获取项目名称"
    },
    {
      "line": 474,
      "type": "single",
      "original": "# 只扫描项目自己的 .ilean 文件",
      "full_line": "    # 只扫描项目自己的 .ilean 文件"
    },
    {
      "line": 478,
      "type": "single",
      "original": "# 如果没有找到项目目录，尝试直接在 lake_build 下查找与项目名匹配的 .ilean",
      "full_line": "        # 如果没有找到项目目录，尝试直接在 lake_build 下查找与项目名匹配的 .ilean"
    },
    {
      "line": 480,
      "type": "single",
      "original": "# 列出 lake_build 下的所有目录，排除已知的依赖库",
      "full_line": "        # 列出 lake_build 下的所有目录，排除已知的依赖库"
    },
    {
      "line": 496,
      "type": "single",
      "original": "# 只显示主要声明类型，排除辅助定义以提高性能",
      "full_line": "    # 只显示主要声明类型，排除辅助定义以提高性能"
    },
    {
      "line": 497,
      "type": "single",
      "original": "# 包含所有 Lean 4 主要声明类型",
      "full_line": "    # 包含所有 Lean 4 主要声明类型"
    },
    {
      "line": 504,
      "type": "single",
      "original": "# 合并所有文件的 usage_map",
      "full_line": "    all_usage_maps = {}  # 合并所有文件的 usage_map"
    },
    {
      "line": 506,
      "type": "single",
      "original": "# (module, line) -> node  用于从行号推断使用者",
      "full_line": "    node_by_line = {}  # (module, line) -> node  用于从行号推断使用者"
    },
    {
      "line": 511,
      "type": "single",
      "original": "# 获取模块名",
      "full_line": "        # 获取模块名"
    },
    {
      "line": 518,
      "type": "single",
      "original": "# 过滤：只保留 theorem 和 lemma",
      "full_line": "        # 过滤：只保留 theorem 和 lemma"
    },
    {
      "line": 524,
      "type": "single",
      "original": "# 记录行号到节点的映射",
      "full_line": "            # 记录行号到节点的映射"
    },
    {
      "line": 527,
      "type": "single",
      "original": "# 合并 usage_map",
      "full_line": "        # 合并 usage_map"
    },
    {
      "line": 535,
      "type": "single",
      "original": "# 构建边（从 usage_map）",
      "full_line": "    # 构建边（从 usage_map）"
    },
    {
      "line": 536,
      "type": "single",
      "original": "# usage_map 记录了每个声明被哪些位置使用",
      "full_line": "    # usage_map 记录了每个声明被哪些位置使用"
    },
    {
      "line": 537,
      "type": "single",
      "original": "# 我们需要找出使用位置属于哪个声明，从而构建 source -> target 的边",
      "full_line": "    # 我们需要找出使用位置属于哪个声明，从而构建 source -> target 的边"
    },
    {
      "line": 539,
      "type": "single",
      "original": "# 去重",
      "full_line": "    seen_edges = set()  # 去重"
    },
    {
      "line": 541,
      "type": "single",
      "original": "# 构建行号范围索引：每个节点覆盖从它的行到下一个节点的行",
      "full_line": "    # 构建行号范围索引：每个节点覆盖从它的行到下一个节点的行"
    },
    {
      "line": 542,
      "type": "single",
      "original": "# 用于从使用行号推断使用者",
      "full_line": "    # 用于从使用行号推断使用者"
    },
    {
      "line": 545,
      "type": "single",
      "original": "# 从 node.id 提取模块名",
      "full_line": "        # 从 node.id 提取模块名"
    },
    {
      "line": 556,
      "type": "single",
      "original": "# 按行号排序并计算范围",
      "full_line": "    # 按行号排序并计算范围"
    },
    {
      "line": 565,
      "type": "single",
      "original": "# 二分查找或线性查找",
      "full_line": "        # 二分查找或线性查找"
    },
    {
      "line": 567,
      "type": "single",
      "original": "# 如果在这个节点之后，下一个节点之前",
      "full_line": "            # 如果在这个节点之后，下一个节点之前"
    },
    {
      "line": 576,
      "type": "single",
      "original": "# 从 usage_map 构建边",
      "full_line": "    # 从 usage_map 构建边"
    },
    {
      "line": 578,
      "type": "single",
      "original": "# 只处理本项目的声明",
      "full_line": "        # 只处理本项目的声明"
    },
    {
      "line": 585,
      "type": "single",
      "original": "# 转为 1-indexed",
      "full_line": "            usage_line = usage.get(\"line\", 0) + 1  # 转为 1-indexed"
    },
    {
      "line": 588,
      "type": "single",
      "original": "# 有明确的使用者名称",
      "full_line": "                # 有明确的使用者名称"
    },
    {
      "line": 591,
      "type": "single",
      "original": "# 从行号推断使用者",
      "full_line": "                # 从行号推断使用者"
    },
    {
      "line": 595,
      "type": "single",
      "original": "# source 使用了 target，所以边是 source -> target",
      "full_line": "                # source 使用了 target，所以边是 source -> target"
    },
    {
      "line": 561,
      "type": "docstring",
      "original": "\"\"\"根据行号找到所属的节点\"\"\"",
      "full_line": "        \"\"\"根据行号找到所属的节点\"\"\""
    }
  ],
  "src/types/node.ts": [
    {
      "line": 11,
      "type": "single",
      "original": "// 基础枚举类型",
      "full_line": "// 基础枚举类型"
    },
    {
      "line": 118,
      "type": "single",
      "original": "// API 请求/响应类型",
      "full_line": "// API 请求/响应类型"
    }
  ],
  "src/types/graph.ts": [
    {
      "line": 9,
      "type": "single",
      "original": "// 基础枚举类型",
      "full_line": "// 基础枚举类型"
    }
  ],
  "src/app/page.tsx": [
    {
      "line": 170,
      "type": "block",
      "original": "      {/* 粒子背景 - 带连线效果 */}\n      {/* Particle background - with connection effect */}",
      "full_line": "      {/* 粒子背景 - 带连线效果 */}\n      {/* Particle background - with connection effect */}"
    }
  ],
  "src/components/MonacoLeanEditor.tsx": [
    {
      "line": 870,
      "type": "block",
      "original": "        /* LSP diagnostic error - red circle */\n        .diagnostic-glyph-error::before {\n          content: \"●\";\n          color: #e74c3c;\n        }\n        /* Node status: proven (三象 - 炼金符号) */",
      "full_line": "        /* LSP diagnostic error - red circle */\n        .diagnostic-glyph-error::before {\n          content: \"●\";\n          color: #e74c3c;\n        }\n        /* Node status: proven (三象 - 炼金符号) */"
    },
    {
      "line": 880,
      "type": "block",
      "original": "        /* Node status: sorry (五芒星) */\n        .diagnostic-glyph-sorry::before {\n          content: \"${PROOF_STATUS_CONFIG.sorry.symbol}\";\n          color: ${PROOF_STATUS_CONFIG.sorry.color};\n        }\n        /* Node status: error (月牙) */",
      "full_line": "        /* Node status: sorry (五芒星) */\n        .diagnostic-glyph-sorry::before {\n          content: \"${PROOF_STATUS_CONFIG.sorry.symbol}\";\n          color: ${PROOF_STATUS_CONFIG.sorry.color};\n        }\n        /* Node status: error (月牙) */"
    }
  ],
  "src/components/LeanCodeViewer.tsx": [
    {
      "line": 10,
      "type": "single",
      "original": "// 目标行号（1-indexed）",
      "full_line": "    lineNumber?: number       // 目标行号（1-indexed）"
    },
    {
      "line": 11,
      "type": "single",
      "original": "// 内容起始行号（1-indexed）",
      "full_line": "    startLine?: number        // 内容起始行号（1-indexed）"
    },
    {
      "line": 12,
      "type": "single",
      "original": "// 内容结束行号",
      "full_line": "    endLine?: number          // 内容结束行号"
    },
    {
      "line": 13,
      "type": "single",
      "original": "// 文件总行数",
      "full_line": "    totalLines?: number       // 文件总行数"
    },
    {
      "line": 17,
      "type": "single",
      "original": "// 隐藏顶部 header",
      "full_line": "    hideHeader?: boolean      // 隐藏顶部 header"
    },
    {
      "line": 20,
      "type": "single",
      "original": "// Lean 关键字分类",
      "full_line": "// Lean 关键字分类"
    },
    {
      "line": 31,
      "type": "single",
      "original": "// 检查是否是注释行",
      "full_line": "    // 检查是否是注释行"
    },
    {
      "line": 34,
      "type": "single",
      "original": "// 注释前的部分",
      "full_line": "        // 注释前的部分"
    },
    {
      "line": 38,
      "type": "single",
      "original": "// 注释部分",
      "full_line": "        // 注释部分"
    },
    {
      "line": 55,
      "type": "single",
      "original": "// 匹配：标识符、数字、字符串、操作符、空白等",
      "full_line": "    // 匹配：标识符、数字、字符串、操作符、空白等"
    },
    {
      "line": 64,
      "type": "single",
      "original": "// 标识符 - 检查是否是关键字",
      "full_line": "            // 标识符 - 检查是否是关键字"
    },
    {
      "line": 25,
      "type": "block",
      "original": "/**\n * 高亮单行代码，返回 React 节点数组\n */",
      "full_line": "/**\n * 高亮单行代码，返回 React 节点数组\n */"
    },
    {
      "line": 50,
      "type": "block",
      "original": "/**\n * 将代码行分词并高亮\n */",
      "full_line": "/**\n * 将代码行分词并高亮\n */"
    },
    {
      "line": 86,
      "type": "block",
      "original": "/**\n * 渲染代码行\n */",
      "full_line": "/**\n * 渲染代码行\n */"
    }
  ],
  "src/components/EdgeStylePanel.tsx": [
    {
      "line": 13,
      "type": "single",
      "original": "// 该边的默认样式（custom edge 为 'dashed'，普通边为 'solid'）",
      "full_line": "    defaultStyle?: string  // 该边的默认样式（custom edge 为 'dashed'，普通边为 'solid'）"
    }
  ],
  "src/app/test/page.tsx": [
    {
      "line": 58,
      "type": "block",
      "original": "      {/* 顶栏 */}\n      <div className=\"h-10 border-b border-white/10 flex items-center px-4\">\n        <span className=\"text-sm font-mono text-white/60\">\n          Test: {projectPath.split('/').pop()}\n        </span>\n        {loading && (\n          <span className=\"ml-4 text-xs text-blue-400\">Loading...</span>\n        )}\n        {error && (\n          <span className=\"ml-4 text-xs text-red-400\">{error}</span>\n        )}\n        {projectData && (\n          <span className=\"ml-4 text-xs text-green-400\">\n            {projectData.nodes.length} nodes, {projectData.edges.length} edges\n          </span>\n        )}\n      </div>\n\n      {/* 主内容 */}",
      "full_line": "      {/* 顶栏 */}\n      <div className=\"h-10 border-b border-white/10 flex items-center px-4\">\n        <span className=\"text-sm font-mono text-white/60\">\n          Test: {projectPath.split('/').pop()}\n        </span>\n        {loading && (\n          <span className=\"ml-4 text-xs text-blue-400\">Loading...</span>\n        )}\n        {error && (\n          <span className=\"ml-4 text-xs text-red-400\">{error}</span>\n        )}\n        {projectData && (\n          <span className=\"ml-4 text-xs text-green-400\">\n            {projectData.nodes.length} nodes, {projectData.edges.length} edges\n          </span>\n        )}\n      </div>\n\n      {/* 主内容 */}"
    },
    {
      "line": 78,
      "type": "block",
      "original": "        {/* 图 */}\n        <div className=\"flex-1\">\n          {projectData ? (\n            <SigmaGraph\n              nodes={projectData.nodes}\n              edges={projectData.edges}\n              selectedNodeId={selectedNodeId}\n              onNodeClick={handleNodeClick}\n            />\n          ) : (\n            <div className=\"w-full h-full flex items-center justify-center text-white/40\">\n              {loading ? 'Loading...' : 'No data'}\n            </div>\n          )}\n        </div>\n\n        {/* 信息面板 */}",
      "full_line": "        {/* 图 */}\n        <div className=\"flex-1\">\n          {projectData ? (\n            <SigmaGraph\n              nodes={projectData.nodes}\n              edges={projectData.edges}\n              selectedNodeId={selectedNodeId}\n              onNodeClick={handleNodeClick}\n            />\n          ) : (\n            <div className=\"w-full h-full flex items-center justify-center text-white/40\">\n              {loading ? 'Loading...' : 'No data'}\n            </div>\n          )}\n        </div>\n\n        {/* 信息面板 */}"
    }
  ],
  "src/app/local/edit/page.tsx": [
    {
      "line": 891,
      "type": "single",
      "original": "// 处理节点点击（适配 Node 类型）",
      "full_line": "    // 处理节点点击（适配 Node 类型）"
    },
    {
      "line": 893,
      "type": "single",
      "original": "// 点击节点时清除边选中状态",
      "full_line": "        // 点击节点时清除边选中状态"
    },
    {
      "line": 897,
      "type": "single",
      "original": "// 点击空白区域取消添加边模式或删除模式",
      "full_line": "            // 点击空白区域取消添加边模式或删除模式"
    },
    {
      "line": 905,
      "type": "single",
      "original": "// 取消选中时关闭 code viewer（回到初始状态）",
      "full_line": "            // 取消选中时关闭 code viewer（回到初始状态）"
    },
    {
      "line": 910,
      "type": "single",
      "original": "// 如果处于删除节点模式，直接删除节点",
      "full_line": "        // 如果处于删除节点模式，直接删除节点"
    },
    {
      "line": 913,
      "type": "single",
      "original": "// 如果删除的是当前选中的节点，清除选中状态",
      "full_line": "            // 如果删除的是当前选中的节点，清除选中状态"
    },
    {
      "line": 920,
      "type": "single",
      "original": "// 如果处于添加边模式，处理目标节点选择",
      "full_line": "        // 如果处于添加边模式，处理目标节点选择"
    },
    {
      "line": 926,
      "type": "single",
      "original": "// 首先检查是否是虚构节点",
      "full_line": "        // 首先检查是否是虚构节点"
    },
    {
      "line": 929,
      "type": "single",
      "original": "// 构造一个类似 GraphNode 的对象给右侧面板显示",
      "full_line": "            // 构造一个类似 GraphNode 的对象给右侧面板显示"
    },
    {
      "line": 943,
      "type": "single",
      "original": "// 找到对应的 GraphNode",
      "full_line": "        // 找到对应的 GraphNode"
    },
    {
      "line": 950,
      "type": "single",
      "original": "// 显示清除画布对话框",
      "full_line": "    // 显示清除画布对话框"
    },
    {
      "line": 956,
      "type": "single",
      "original": "// 切换选中要移除的节点",
      "full_line": "    // 切换选中要移除的节点"
    },
    {
      "line": 969,
      "type": "single",
      "original": "// 全选/取消全选",
      "full_line": "    // 全选/取消全选"
    },
    {
      "line": 979,
      "type": "single",
      "original": "// 移除选中的节点",
      "full_line": "    // 移除选中的节点"
    },
    {
      "line": 991,
      "type": "single",
      "original": "// 清除全部节点",
      "full_line": "    // 清除全部节点"
    },
    {
      "line": 998,
      "type": "single",
      "original": "// 显示重置确认对话框",
      "full_line": "    // 显示重置确认对话框"
    },
    {
      "line": 1003,
      "type": "single",
      "original": "// 确认重置所有数据",
      "full_line": "    // 确认重置所有数据"
    },
    {
      "line": 1012,
      "type": "single",
      "original": "// 处理创建虚构节点",
      "full_line": "    // 处理创建虚构节点"
    },
    {
      "line": 1017,
      "type": "single",
      "original": "// 生成 ID（使用时间戳确保唯一性）",
      "full_line": "        // 生成 ID（使用时间戳确保唯一性）"
    },
    {
      "line": 1030,
      "type": "single",
      "original": "// 首先检查是否是 custom node",
      "full_line": "        // 首先检查是否是 custom node"
    },
    {
      "line": 1034,
      "type": "single",
      "original": "// 构造一个类似 GraphNode 的对象",
      "full_line": "                // 构造一个类似 GraphNode 的对象"
    },
    {
      "line": 1046,
      "type": "single",
      "original": "// 聚焦到 custom node",
      "full_line": "                setFocusNodeId(customNode.id) // 聚焦到 custom node"
    },
    {
      "line": 1051,
      "type": "single",
      "original": "// 普通节点",
      "full_line": "        // 普通节点"
    },
    {
      "line": 1063,
      "type": "single",
      "original": "// 保存清除选中边到 viewport",
      "full_line": "            // 保存清除选中边到 viewport"
    },
    {
      "line": 1080,
      "type": "single",
      "original": "// 保存清除选中边到 viewport",
      "full_line": "            // 保存清除选中边到 viewport"
    },
    {
      "line": 1098,
      "type": "single",
      "original": "// 聚焦到边",
      "full_line": "            // 聚焦到边"
    },
    {
      "line": 1102,
      "type": "single",
      "original": "// 保存选中边到 viewport",
      "full_line": "            // 保存选中边到 viewport"
    },
    {
      "line": 1111,
      "type": "single",
      "original": "// 统一的节点导航函数 - 处理 GraphNode 和 CustomNode",
      "full_line": "    // 统一的节点导航函数 - 处理 GraphNode 和 CustomNode"
    },
    {
      "line": 1113,
      "type": "single",
      "original": "// 首先检查是否是 CustomNode",
      "full_line": "        // 首先检查是否是 CustomNode"
    },
    {
      "line": 1130,
      "type": "single",
      "original": "// 普通节点",
      "full_line": "        // 普通节点"
    },
    {
      "line": 1165,
      "type": "single",
      "original": "// 非 Lean 4 Lake 项目不支持",
      "full_line": "    // 非 Lean 4 Lake 项目不支持"
    },
    {
      "line": 1205,
      "type": "single",
      "original": "// 项目需要初始化",
      "full_line": "    // 项目需要初始化"
    },
    {
      "line": 1225,
      "type": "single",
      "original": "// 重新检查状态并加载",
      "full_line": "                        // 重新检查状态并加载"
    },
    {
      "line": 1452,
      "type": "single",
      "original": "// 进入删除模式时，取消添加边模式",
      "full_line": "                                            // 进入删除模式时，取消添加边模式"
    },
    {
      "line": 1749,
      "type": "single",
      "original": "// 虚构节点用灰色",
      "full_line": "                                                            ? '#666666'  // 虚构节点用灰色"
    },
    {
      "line": 2107,
      "type": "single",
      "original": "// closedNeighbors: 不在画布上的邻居节点（统一使用 visibleNodes 判断）",
      "full_line": "                                                            // closedNeighbors: 不在画布上的邻居节点（统一使用 visibleNodes 判断）"
    },
    {
      "line": 1236,
      "type": "block",
      "original": "            {/* Top Bar - minimal */}\n            <div className=\"h-10 border-b border-white/10 bg-black/90 flex items-center justify-between px-3\">\n                <div className=\"flex items-center gap-2\">\n                    <button\n                        onClick={() => router.push('/')}\n                        className=\"p-1.5 hover:bg-white/10 rounded transition-colors\"\n                        title=\"Home\"\n                    >\n                        <HomeIcon className=\"w-4 h-4 text-white/60 hover:text-white\" />\n                    </button>\n                    <span className=\"text-sm font-mono text-white/60 ml-2\">{projectName}</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    {/* 视图模式切换 - 暂时隐藏，2D 开发中 */}",
      "full_line": "            {/* Top Bar - minimal */}\n            <div className=\"h-10 border-b border-white/10 bg-black/90 flex items-center justify-between px-3\">\n                <div className=\"flex items-center gap-2\">\n                    <button\n                        onClick={() => router.push('/')}\n                        className=\"p-1.5 hover:bg-white/10 rounded transition-colors\"\n                        title=\"Home\"\n                    >\n                        <HomeIcon className=\"w-4 h-4 text-white/60 hover:text-white\" />\n                    </button>\n                    <span className=\"text-sm font-mono text-white/60 ml-2\">{projectName}</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    {/* 视图模式切换 - 暂时隐藏，2D 开发中 */}"
    },
    {
      "line": 1305,
      "type": "block",
      "original": "                    {/* 左侧：搜索面板 */}\n                    {searchPanelOpen && (\n                        <>\n                            <Panel defaultSize={15} minSize={10} maxSize={30}>\n                                <SearchPanel\n                                    className=\"h-full\"\n                                    selectedNodeId={selectedNode?.id}\n                                    onNodeSelect={handleSearchResultSelect}\n                                />\n                            </Panel>\n                            <PanelResizeHandle className=\"w-2 bg-white/10 hover:bg-blue-500/50 transition-colors cursor-col-resize flex items-center justify-center group\">\n                                <div className=\"h-12 w-1 bg-white/20 group-hover:bg-white/40 rounded-full\" />\n                            </PanelResizeHandle>\n                        </>\n                    )}\n\n                    {/* Center: Graph */}",
      "full_line": "                    {/* 左侧：搜索面板 */}\n                    {searchPanelOpen && (\n                        <>\n                            <Panel defaultSize={15} minSize={10} maxSize={30}>\n                                <SearchPanel\n                                    className=\"h-full\"\n                                    selectedNodeId={selectedNode?.id}\n                                    onNodeSelect={handleSearchResultSelect}\n                                />\n                            </Panel>\n                            <PanelResizeHandle className=\"w-2 bg-white/10 hover:bg-blue-500/50 transition-colors cursor-col-resize flex items-center justify-center group\">\n                                <div className=\"h-12 w-1 bg-white/20 group-hover:bg-white/40 rounded-full\" />\n                            </PanelResizeHandle>\n                        </>\n                    )}\n\n                    {/* Center: Graph */}"
    },
    {
      "line": 1323,
      "type": "block",
      "original": "                        {/* Graph - Main Area */}\n                        <div className=\"h-full w-full overflow-hidden relative bg-[#0a0a0f]\">\n                            {/* 根据视图模式渲染不同的图组件 */}",
      "full_line": "                        {/* Graph - Main Area */}\n                        <div className=\"h-full w-full overflow-hidden relative bg-[#0a0a0f]\">\n                            {/* 根据视图模式渲染不同的图组件 */}"
    },
    {
      "line": 1373,
      "type": "block",
      "original": "                            {/* Loading Overlay */}\n                            {graphLoading && (\n                                <div className=\"absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-20\">\n                                    <div className=\"w-8 h-8 border-2 border-white/20 border-t-blue-400 rounded-full animate-spin mb-4\" />\n                                    <div className=\"text-white/80 text-sm font-mono\">Loading project...</div>\n                                    <div className=\"text-white/40 text-xs mt-2\">Parsing Lean files</div>\n                                </div>\n                            )}\n\n                            {/* 画布工具栏 - 左上角 */}",
      "full_line": "                            {/* Loading Overlay */}\n                            {graphLoading && (\n                                <div className=\"absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-20\">\n                                    <div className=\"w-8 h-8 border-2 border-white/20 border-t-blue-400 rounded-full animate-spin mb-4\" />\n                                    <div className=\"text-white/80 text-sm font-mono\">Loading project...</div>\n                                    <div className=\"text-white/40 text-xs mt-2\">Parsing Lean files</div>\n                                </div>\n                            )}\n\n                            {/* 画布工具栏 - 左上角 */}"
    },
    {
      "line": 1388,
      "type": "block",
      "original": "                                {/* 刷新按钮 */}\n                                <button\n                                    onClick={() => {\n                                        console.log('[Canvas] Refresh clicked')\n                                        reloadGraph()\n                                    }}\n                                    disabled={graphLoading}\n                                    className=\"p-1.5 bg-black/60 hover:bg-white/20 rounded transition-colors disabled:opacity-50\"\n                                    title=\"Refresh\"\n                                >\n                                    <ArrowPathIcon className={`w-4 h-4 text-white/60 ${graphLoading ? 'animate-spin' : ''}`} />\n                                </button>\n\n                                {/* LSP 实时更新开关 - 通过 feature flag 控制 */}",
      "full_line": "                                {/* 刷新按钮 */}\n                                <button\n                                    onClick={() => {\n                                        console.log('[Canvas] Refresh clicked')\n                                        reloadGraph()\n                                    }}\n                                    disabled={graphLoading}\n                                    className=\"p-1.5 bg-black/60 hover:bg-white/20 rounded transition-colors disabled:opacity-50\"\n                                    title=\"Refresh\"\n                                >\n                                    <ArrowPathIcon className={`w-4 h-4 text-white/60 ${graphLoading ? 'animate-spin' : ''}`} />\n                                </button>\n\n                                {/* LSP 实时更新开关 - 通过 feature flag 控制 */}"
    },
    {
      "line": 1427,
      "type": "block",
      "original": "                                {/* 标签显示开关 */}\n                                <button\n                                    onClick={() => setShowLabels(!showLabels)}\n                                    className={`p-1.5 rounded transition-colors ${\n                                        showLabels ? 'bg-green-500/30 text-green-400' : 'bg-black/60 text-white/40 hover:text-white'\n                                    }`}\n                                    title={showLabels ? 'Hide Labels' : 'Show Labels'}\n                                >\n                                    <TagIcon className=\"w-4 h-4\" />\n                                </button>\n\n                                {/* 添加虚构节点按钮 */}",
      "full_line": "                                {/* 标签显示开关 */}\n                                <button\n                                    onClick={() => setShowLabels(!showLabels)}\n                                    className={`p-1.5 rounded transition-colors ${\n                                        showLabels ? 'bg-green-500/30 text-green-400' : 'bg-black/60 text-white/40 hover:text-white'\n                                    }`}\n                                    title={showLabels ? 'Hide Labels' : 'Show Labels'}\n                                >\n                                    <TagIcon className=\"w-4 h-4\" />\n                                </button>\n\n                                {/* 添加虚构节点按钮 */}"
    },
    {
      "line": 1447,
      "type": "block",
      "original": "                                {/* 删除节点模式按钮 */}\n                                <button\n                                    onClick={() => {\n                                        setIsRemovingNodes(!isRemovingNodes)\n                                        if (!isRemovingNodes) {\n                                            // 进入删除模式时，取消添加边模式\n                                            setIsAddingEdge(false)\n                                        }\n                                    }}\n                                    className={`p-1.5 rounded transition-colors ${\n                                        isRemovingNodes\n                                            ? 'bg-red-500/40 text-red-400 ring-1 ring-red-500/50'\n                                            : 'bg-black/60 text-white/60 hover:text-red-400 hover:bg-red-500/20'\n                                    }`}\n                                    title={isRemovingNodes ? 'Exit Remove Mode (click empty area)' : 'Remove Nodes Mode'}\n                                >\n                                    <TrashIcon className=\"w-4 h-4\" />\n                                </button>\n\n                                {/* 物理设置按钮 - 仅在 3D 模式显示 */}",
      "full_line": "                                {/* 删除节点模式按钮 */}\n                                <button\n                                    onClick={() => {\n                                        setIsRemovingNodes(!isRemovingNodes)\n                                        if (!isRemovingNodes) {\n                                            // 进入删除模式时，取消添加边模式\n                                            setIsAddingEdge(false)\n                                        }\n                                    }}\n                                    className={`p-1.5 rounded transition-colors ${\n                                        isRemovingNodes\n                                            ? 'bg-red-500/40 text-red-400 ring-1 ring-red-500/50'\n                                            : 'bg-black/60 text-white/60 hover:text-red-400 hover:bg-red-500/20'\n                                    }`}\n                                    title={isRemovingNodes ? 'Exit Remove Mode (click empty area)' : 'Remove Nodes Mode'}\n                                >\n                                    <TrashIcon className=\"w-4 h-4\" />\n                                </button>\n\n                                {/* 物理设置按钮 - 仅在 3D 模式显示 */}"
    },
    {
      "line": 1481,
      "type": "block",
      "original": "                                {/* 以下按钮暂时隐藏，随后开发 */}\n                                {/* 过滤按钮 - TODO: 后端待开发\n                                <button\n                                    onClick={() => {\n                                        console.log('[Canvas] Filter clicked - TODO: implement filter panel')\n                                    }}\n                                    className=\"p-1.5 bg-black/60 hover:bg-white/20 rounded transition-colors\"\n                                    title=\"Filter (TODO)\"\n                                >\n                                    <FunnelIcon className=\"w-4 h-4 text-white/60\" />\n                                </button>\n                                */}",
      "full_line": "                                {/* 以下按钮暂时隐藏，随后开发 */}\n                                {/* 过滤按钮 - TODO: 后端待开发\n                                <button\n                                    onClick={() => {\n                                        console.log('[Canvas] Filter clicked - TODO: implement filter panel')\n                                    }}\n                                    className=\"p-1.5 bg-black/60 hover:bg-white/20 rounded transition-colors\"\n                                    title=\"Filter (TODO)\"\n                                >\n                                    <FunnelIcon className=\"w-4 h-4 text-white/60\" />\n                                </button>\n                                */}"
    },
    {
      "line": 1494,
      "type": "block",
      "original": "                                {/* 画布内查找按钮 - TODO: 后端待开发\n                                <button\n                                    onClick={() => {\n                                        console.log('[Canvas] Find clicked - TODO: implement in-canvas search')\n                                    }}\n                                    className=\"p-1.5 bg-black/60 hover:bg-white/20 rounded transition-colors\"\n                                    title=\"Find in Canvas (TODO)\"\n                                >\n                                    <MagnifyingGlassIcon className=\"w-4 h-4 text-white/60\" />\n                                </button>\n                                */}",
      "full_line": "                                {/* 画布内查找按钮 - TODO: 后端待开发\n                                <button\n                                    onClick={() => {\n                                        console.log('[Canvas] Find clicked - TODO: implement in-canvas search')\n                                    }}\n                                    className=\"p-1.5 bg-black/60 hover:bg-white/20 rounded transition-colors\"\n                                    title=\"Find in Canvas (TODO)\"\n                                >\n                                    <MagnifyingGlassIcon className=\"w-4 h-4 text-white/60\" />\n                                </button>\n                                */}"
    },
    {
      "line": 1506,
      "type": "block",
      "original": "                                {/* 光带/流动动画按钮 - TODO: 后端待开发\n                                <button\n                                    onClick={() => {\n                                        console.log('[Canvas] Flow animation clicked - TODO: implement edge flow animation')\n                                    }}\n                                    className=\"p-1.5 bg-black/60 hover:bg-white/20 rounded transition-colors\"\n                                    title=\"Flow Animation (TODO)\"\n                                >\n                                    <svg className=\"w-4 h-4\" viewBox=\"0 0 20 20\" fill=\"none\">\n                                        <defs>\n                                            <linearGradient id=\"flowGrad\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n                                                <stop offset=\"0%\" stopColor=\"#666\" stopOpacity=\"0.3\" />\n                                                <stop offset=\"50%\" stopColor=\"#00d4ff\" stopOpacity=\"1\" />\n                                                <stop offset=\"100%\" stopColor=\"#666\" stopOpacity=\"0.3\" />\n                                            </linearGradient>\n                                        </defs>\n                                        <path d=\"M2 10 Q5 6, 10 10 T18 10\" stroke=\"url(#flowGrad)\" strokeWidth=\"2\" fill=\"none\" strokeLinecap=\"round\" />\n                                    </svg>\n                                </button>\n                                */}",
      "full_line": "                                {/* 光带/流动动画按钮 - TODO: 后端待开发\n                                <button\n                                    onClick={() => {\n                                        console.log('[Canvas] Flow animation clicked - TODO: implement edge flow animation')\n                                    }}\n                                    className=\"p-1.5 bg-black/60 hover:bg-white/20 rounded transition-colors\"\n                                    title=\"Flow Animation (TODO)\"\n                                >\n                                    <svg className=\"w-4 h-4\" viewBox=\"0 0 20 20\" fill=\"none\">\n                                        <defs>\n                                            <linearGradient id=\"flowGrad\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n                                                <stop offset=\"0%\" stopColor=\"#666\" stopOpacity=\"0.3\" />\n                                                <stop offset=\"50%\" stopColor=\"#00d4ff\" stopOpacity=\"1\" />\n                                                <stop offset=\"100%\" stopColor=\"#666\" stopOpacity=\"0.3\" />\n                                            </linearGradient>\n                                        </defs>\n                                        <path d=\"M2 10 Q5 6, 10 10 T18 10\" stroke=\"url(#flowGrad)\" strokeWidth=\"2\" fill=\"none\" strokeLinecap=\"round\" />\n                                    </svg>\n                                </button>\n                                */}"
    },
    {
      "line": 1527,
      "type": "block",
      "original": "                                {/* 添加自定义节点按钮 - TODO: 后端待开发\n                                <button\n                                    onClick={() => {\n                                        console.log('[Canvas] Add custom node clicked - TODO: implement custom node creation')\n                                    }}\n                                    className=\"p-1.5 bg-black/60 hover:bg-green-500/30 rounded transition-colors\"\n                                    title=\"Add Custom Node (TODO)\"\n                                >\n                                    <PlusIcon className=\"w-4 h-4 text-green-400\" />\n                                </button>\n                                */}",
      "full_line": "                                {/* 添加自定义节点按钮 - TODO: 后端待开发\n                                <button\n                                    onClick={() => {\n                                        console.log('[Canvas] Add custom node clicked - TODO: implement custom node creation')\n                                    }}\n                                    className=\"p-1.5 bg-black/60 hover:bg-green-500/30 rounded transition-colors\"\n                                    title=\"Add Custom Node (TODO)\"\n                                >\n                                    <PlusIcon className=\"w-4 h-4 text-green-400\" />\n                                </button>\n                                */}"
    },
    {
      "line": 1539,
      "type": "block",
      "original": "                                {/* 工具设置按钮 - TODO: 后端待开发\n                                <button\n                                    onClick={() => {\n                                        console.log('[Canvas] Tools clicked - TODO: implement tools panel')\n                                    }}\n                                    className=\"p-1.5 bg-black/60 hover:bg-white/20 rounded transition-colors\"\n                                    title=\"Tools & Settings (TODO)\"\n                                >\n                                    <Cog6ToothIcon className=\"w-4 h-4 text-white/60\" />\n                                </button>\n                                */}",
      "full_line": "                                {/* 工具设置按钮 - TODO: 后端待开发\n                                <button\n                                    onClick={() => {\n                                        console.log('[Canvas] Tools clicked - TODO: implement tools panel')\n                                    }}\n                                    className=\"p-1.5 bg-black/60 hover:bg-white/20 rounded transition-colors\"\n                                    title=\"Tools & Settings (TODO)\"\n                                >\n                                    <Cog6ToothIcon className=\"w-4 h-4 text-white/60\" />\n                                </button>\n                                */}"
    },
    {
      "line": 1552,
      "type": "block",
      "original": "                            {/* 物理设置面板 */}\n                            {showPhysicsPanel && viewMode === '3d' && (\n                                <div className=\"absolute top-14 left-3 z-10 bg-black/80 backdrop-blur-sm border border-white/20 rounded-lg p-4 w-64\">\n                                    <div className=\"flex items-center justify-between mb-4\">\n                                        <h3 className=\"text-sm font-medium text-white\">Physics Settings</h3>\n                                        <button\n                                            onClick={() => setShowPhysicsPanel(false)}\n                                            className=\"text-white/40 hover:text-white\"\n                                        >\n                                            <XMarkIcon className=\"w-4 h-4\" />\n                                        </button>\n                                    </div>\n\n                                    <div className=\"space-y-4\">\n                                        {/* Repulsion Strength */}",
      "full_line": "                            {/* 物理设置面板 */}\n                            {showPhysicsPanel && viewMode === '3d' && (\n                                <div className=\"absolute top-14 left-3 z-10 bg-black/80 backdrop-blur-sm border border-white/20 rounded-lg p-4 w-64\">\n                                    <div className=\"flex items-center justify-between mb-4\">\n                                        <h3 className=\"text-sm font-medium text-white\">Physics Settings</h3>\n                                        <button\n                                            onClick={() => setShowPhysicsPanel(false)}\n                                            className=\"text-white/40 hover:text-white\"\n                                        >\n                                            <XMarkIcon className=\"w-4 h-4\" />\n                                        </button>\n                                    </div>\n\n                                    <div className=\"space-y-4\">\n                                        {/* Repulsion Strength */}"
    },
    {
      "line": 1722,
      "type": "block",
      "original": "                                                    {/* 可见性按钮 - 所有节点统一使用 visibleNodes[] 控制 */}\n                                                    <button\n                                                        onClick={async () => {\n                                                            const isVisible = visibleNodes.includes(selectedNode.id)\n                                                            if (isVisible) {\n                                                                await removeCanvasNode(selectedNode.id)\n                                                            } else {\n                                                                await addCanvasNode(selectedNode.id)\n                                                            }\n                                                        }}\n                                                        className={`p-0.5 rounded transition-all flex-shrink-0 ${\n                                                            visibleNodes.includes(selectedNode.id)\n                                                                ? 'text-green-400 hover:text-green-300 drop-shadow-[0_0_6px_rgba(74,222,128,0.8)]'\n                                                                : 'text-gray-500 hover:text-gray-400 animate-pulse-glow'\n                                                        }`}\n                                                        title={visibleNodes.includes(selectedNode.id) ? 'Remove from canvas' : 'Add to canvas'}\n                                                    >\n                                                        {visibleNodes.includes(selectedNode.id) ? (\n                                                            <EyeIcon className=\"w-4 h-4\" />\n                                                        ) : (\n                                                            <EyeSlashIcon className=\"w-4 h-4\" />\n                                                        )}\n                                                    </button>\n                                                    {/* Node name with type color - dims when not on canvas */}",
      "full_line": "                                                    {/* 可见性按钮 - 所有节点统一使用 visibleNodes[] 控制 */}\n                                                    <button\n                                                        onClick={async () => {\n                                                            const isVisible = visibleNodes.includes(selectedNode.id)\n                                                            if (isVisible) {\n                                                                await removeCanvasNode(selectedNode.id)\n                                                            } else {\n                                                                await addCanvasNode(selectedNode.id)\n                                                            }\n                                                        }}\n                                                        className={`p-0.5 rounded transition-all flex-shrink-0 ${\n                                                            visibleNodes.includes(selectedNode.id)\n                                                                ? 'text-green-400 hover:text-green-300 drop-shadow-[0_0_6px_rgba(74,222,128,0.8)]'\n                                                                : 'text-gray-500 hover:text-gray-400 animate-pulse-glow'\n                                                        }`}\n                                                        title={visibleNodes.includes(selectedNode.id) ? 'Remove from canvas' : 'Add to canvas'}\n                                                    >\n                                                        {visibleNodes.includes(selectedNode.id) ? (\n                                                            <EyeIcon className=\"w-4 h-4\" />\n                                                        ) : (\n                                                            <EyeSlashIcon className=\"w-4 h-4\" />\n                                                        )}\n                                                    </button>\n                                                    {/* Node name with type color - dims when not on canvas */}"
    },
    {
      "line": 1762,
      "type": "block",
      "original": "                                                    {/* Tool buttons - small icons next to name */}\n                                                    <div className={`flex gap-0.5 flex-shrink-0 transition-opacity ${\n                                                        visibleNodes.includes(selectedNode.id) ? '' : 'opacity-40'\n                                                    }`}>\n                                                        <button\n                                                            onClick={() => handleToggleToolView('style')}\n                                                            className={`p-0.5 rounded transition-colors ${\n                                                                toolPanelView === 'style'\n                                                                    ? 'text-pink-300'\n                                                                    : 'text-white/30 hover:text-pink-400'\n                                                            }`}\n                                                            title=\"Style\"\n                                                        >\n                                                            <SwatchIcon className=\"w-3.5 h-3.5\" />\n                                                        </button>\n                                                        <button\n                                                            onClick={() => handleToggleToolView('edges')}\n                                                            className={`p-0.5 rounded transition-colors ${\n                                                                toolPanelView === 'edges'\n                                                                    ? 'text-blue-300'\n                                                                    : 'text-white/30 hover:text-blue-400'\n                                                            }`}\n                                                            title=\"Edges\"\n                                                        >\n                                                            <ArrowLongRightIcon className=\"w-3.5 h-3.5\" />\n                                                        </button>\n                                                        <button\n                                                            onClick={() => handleToggleToolView('neighbors')}\n                                                            className={`p-0.5 rounded transition-colors ${\n                                                                toolPanelView === 'neighbors'\n                                                                    ? 'text-purple-300'\n                                                                    : 'text-white/30 hover:text-purple-400'\n                                                            }`}\n                                                            title=\"Neighbors\"\n                                                        >\n                                                            <ArrowsPointingOutIcon className=\"w-3.5 h-3.5\" />\n                                                        </button>\n                                                    </div>\n                                                    {/* Delete button - 统一处理所有节点类型 */}",
      "full_line": "                                                    {/* Tool buttons - small icons next to name */}\n                                                    <div className={`flex gap-0.5 flex-shrink-0 transition-opacity ${\n                                                        visibleNodes.includes(selectedNode.id) ? '' : 'opacity-40'\n                                                    }`}>\n                                                        <button\n                                                            onClick={() => handleToggleToolView('style')}\n                                                            className={`p-0.5 rounded transition-colors ${\n                                                                toolPanelView === 'style'\n                                                                    ? 'text-pink-300'\n                                                                    : 'text-white/30 hover:text-pink-400'\n                                                            }`}\n                                                            title=\"Style\"\n                                                        >\n                                                            <SwatchIcon className=\"w-3.5 h-3.5\" />\n                                                        </button>\n                                                        <button\n                                                            onClick={() => handleToggleToolView('edges')}\n                                                            className={`p-0.5 rounded transition-colors ${\n                                                                toolPanelView === 'edges'\n                                                                    ? 'text-blue-300'\n                                                                    : 'text-white/30 hover:text-blue-400'\n                                                            }`}\n                                                            title=\"Edges\"\n                                                        >\n                                                            <ArrowLongRightIcon className=\"w-3.5 h-3.5\" />\n                                                        </button>\n                                                        <button\n                                                            onClick={() => handleToggleToolView('neighbors')}\n                                                            className={`p-0.5 rounded transition-colors ${\n                                                                toolPanelView === 'neighbors'\n                                                                    ? 'text-purple-300'\n                                                                    : 'text-white/30 hover:text-purple-400'\n                                                            }`}\n                                                            title=\"Neighbors\"\n                                                        >\n                                                            <ArrowsPointingOutIcon className=\"w-3.5 h-3.5\" />\n                                                        </button>\n                                                    </div>\n                                                    {/* Delete button - 统一处理所有节点类型 */}"
    },
    {
      "line": 2236,
      "type": "block",
      "original": "                                    {/* Code Viewer Panel - 由 Lean 按钮触发 */}\n                                    {codeViewerOpen && (\n                                        <Panel defaultSize={35} minSize={20}>\n                                            <div className=\"h-full flex flex-col bg-[#0d1117] border-l border-white/10\">\n                                                {/* Tab buttons */}",
      "full_line": "                                    {/* Code Viewer Panel - 由 Lean 按钮触发 */}\n                                    {codeViewerOpen && (\n                                        <Panel defaultSize={35} minSize={20}>\n                                            <div className=\"h-full flex flex-col bg-[#0d1117] border-l border-white/10\">\n                                                {/* Tab buttons */}"
    },
    {
      "line": 2335,
      "type": "block",
      "original": "                    {/* LSP Status - 通过 feature flag 控制 */}\n                    {FEATURES.LSP_ENABLED && (\n                        <>\n                            <button\n                                onClick={toggleLSP}\n                                className=\"flex items-center gap-1.5 hover:bg-white/20 px-1.5 py-0.5 rounded transition-colors\"\n                                title={`Lean LSP: ${lspState} - Click to ${lspRunning ? 'stop' : 'start'}`}\n                            >\n                                {lspState === 'running' ? (\n                                    <span className=\"w-2 h-2 rounded-full bg-green-400 animate-pulse\" />\n                                ) : lspState === 'starting' || lspState === 'stopping' ? (\n                                    <span className=\"w-2 h-2 rounded-full bg-yellow-400 animate-pulse\" />\n                                ) : lspState === 'error' ? (\n                                    <span className=\"w-2 h-2 rounded-full bg-red-400\" />\n                                ) : (\n                                    <span className=\"w-2 h-2 rounded-full bg-gray-400\" />\n                                )}\n                                <span>\n                                    Lean LSP: {lspState === 'running' ? 'Running' : lspState === 'starting' ? 'Starting...' : lspState === 'stopping' ? 'Stopping...' : lspState === 'error' ? 'Error' : 'Stopped'}\n                                </span>\n                            </button>\n\n                            {/* Diagnostics Info */}",
      "full_line": "                    {/* LSP Status - 通过 feature flag 控制 */}\n                    {FEATURES.LSP_ENABLED && (\n                        <>\n                            <button\n                                onClick={toggleLSP}\n                                className=\"flex items-center gap-1.5 hover:bg-white/20 px-1.5 py-0.5 rounded transition-colors\"\n                                title={`Lean LSP: ${lspState} - Click to ${lspRunning ? 'stop' : 'start'}`}\n                            >\n                                {lspState === 'running' ? (\n                                    <span className=\"w-2 h-2 rounded-full bg-green-400 animate-pulse\" />\n                                ) : lspState === 'starting' || lspState === 'stopping' ? (\n                                    <span className=\"w-2 h-2 rounded-full bg-yellow-400 animate-pulse\" />\n                                ) : lspState === 'error' ? (\n                                    <span className=\"w-2 h-2 rounded-full bg-red-400\" />\n                                ) : (\n                                    <span className=\"w-2 h-2 rounded-full bg-gray-400\" />\n                                )}\n                                <span>\n                                    Lean LSP: {lspState === 'running' ? 'Running' : lspState === 'starting' ? 'Starting...' : lspState === 'stopping' ? 'Stopping...' : lspState === 'error' ? 'Error' : 'Stopped'}\n                                </span>\n                            </button>\n\n                            {/* Diagnostics Info */}"
    },
    {
      "line": 2404,
      "type": "block",
      "original": "                    {/* Current File */}\n                    {selectedNode?.leanFilePath && (\n                        <span className=\"truncate max-w-[300px] flex items-center gap-1\" title={selectedNode.leanFilePath}>\n                            {selectedNode.leanFilePath.split('/').pop()}\n                            {codeDirty && <span className=\"text-white/80\" title=\"Unsaved changes (Ctrl+S to save)\">●</span>}\n                        </span>\n                    )}\n                </div>\n            </div>\n\n            {/* 创建虚构节点对话框 */}",
      "full_line": "                    {/* Current File */}\n                    {selectedNode?.leanFilePath && (\n                        <span className=\"truncate max-w-[300px] flex items-center gap-1\" title={selectedNode.leanFilePath}>\n                            {selectedNode.leanFilePath.split('/').pop()}\n                            {codeDirty && <span className=\"text-white/80\" title=\"Unsaved changes (Ctrl+S to save)\">●</span>}\n                        </span>\n                    )}\n                </div>\n            </div>\n\n            {/* 创建虚构节点对话框 */}"
    },
    {
      "line": 2417,
      "type": "block",
      "original": "                    {/* 背景遮罩 */}\n                    <div\n                        className=\"absolute inset-0 bg-black/70\"\n                        onClick={() => {\n                            setShowCustomNodeDialog(false)\n                            setCustomNodeName('')\n                        }}\n                    />\n                    {/* 对话框 */}",
      "full_line": "                    {/* 背景遮罩 */}\n                    <div\n                        className=\"absolute inset-0 bg-black/70\"\n                        onClick={() => {\n                            setShowCustomNodeDialog(false)\n                            setCustomNodeName('')\n                        }}\n                    />\n                    {/* 对话框 */}"
    },
    {
      "line": 2469,
      "type": "block",
      "original": "            {/* Reset All Data Confirmation Dialog */}\n            {showResetConfirm && (\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n                    {/* 背景遮罩 */}",
      "full_line": "            {/* Reset All Data Confirmation Dialog */}\n            {showResetConfirm && (\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n                    {/* 背景遮罩 */}"
    },
    {
      "line": 2477,
      "type": "block",
      "original": "                    {/* 对话框 */}\n                    <div className=\"relative bg-gray-900 rounded-lg p-6 w-96 border border-red-500/30 shadow-2xl\">\n                        <div className=\"flex items-center gap-3 mb-4\">\n                            <div className=\"w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center\">\n                                <svg className=\"w-5 h-5 text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n                                </svg>\n                            </div>\n                            <h3 className=\"text-lg font-semibold text-white\">Reset All Data</h3>\n                        </div>\n                        <p className=\"text-sm text-white/60 mb-2\">\n                            This will permanently delete:\n                        </p>\n                        <ul className=\"text-sm text-red-400 mb-4 list-disc list-inside space-y-1\">\n                            <li>All custom nodes</li>\n                            <li>All custom edges</li>\n                            <li>All node metadata (colors, labels, notes)</li>\n                        </ul>\n                        <p className=\"text-sm text-white/40 mb-4\">\n                            This action cannot be undone.\n                        </p>\n                        <div className=\"flex justify-end gap-2\">\n                            <button\n                                onClick={() => setShowResetConfirm(false)}\n                                className=\"px-4 py-2 text-sm text-white/60 hover:text-white transition-colors\"\n                            >\n                                Cancel\n                            </button>\n                            <button\n                                onClick={confirmResetAllData}\n                                className=\"px-4 py-2 text-sm bg-red-500 hover:bg-red-600 text-white rounded transition-colors\"\n                            >\n                                Reset All Data\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Reload Prompt after Reset */}",
      "full_line": "                    {/* 对话框 */}\n                    <div className=\"relative bg-gray-900 rounded-lg p-6 w-96 border border-red-500/30 shadow-2xl\">\n                        <div className=\"flex items-center gap-3 mb-4\">\n                            <div className=\"w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center\">\n                                <svg className=\"w-5 h-5 text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n                                </svg>\n                            </div>\n                            <h3 className=\"text-lg font-semibold text-white\">Reset All Data</h3>\n                        </div>\n                        <p className=\"text-sm text-white/60 mb-2\">\n                            This will permanently delete:\n                        </p>\n                        <ul className=\"text-sm text-red-400 mb-4 list-disc list-inside space-y-1\">\n                            <li>All custom nodes</li>\n                            <li>All custom edges</li>\n                            <li>All node metadata (colors, labels, notes)</li>\n                        </ul>\n                        <p className=\"text-sm text-white/40 mb-4\">\n                            This action cannot be undone.\n                        </p>\n                        <div className=\"flex justify-end gap-2\">\n                            <button\n                                onClick={() => setShowResetConfirm(false)}\n                                className=\"px-4 py-2 text-sm text-white/60 hover:text-white transition-colors\"\n                            >\n                                Cancel\n                            </button>\n                            <button\n                                onClick={confirmResetAllData}\n                                className=\"px-4 py-2 text-sm bg-red-500 hover:bg-red-600 text-white rounded transition-colors\"\n                            >\n                                Reset All Data\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Reload Prompt after Reset */}"
    },
    {
      "line": 2519,
      "type": "block",
      "original": "                    {/* 背景遮罩 */}\n                    <div className=\"absolute inset-0 bg-black/70\" />\n                    {/* 对话框 */}",
      "full_line": "                    {/* 背景遮罩 */}\n                    <div className=\"absolute inset-0 bg-black/70\" />\n                    {/* 对话框 */}"
    },
    {
      "line": 2552,
      "type": "block",
      "original": "            {/* Clear Canvas Dialog */}\n            {showClearCanvasDialog && (\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n                    {/* 背景遮罩 */}",
      "full_line": "            {/* Clear Canvas Dialog */}\n            {showClearCanvasDialog && (\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n                    {/* 背景遮罩 */}"
    },
    {
      "line": 2560,
      "type": "block",
      "original": "                    {/* 对话框 */}\n                    <div className=\"relative bg-gray-900 rounded-lg p-6 w-[480px] max-h-[80vh] border border-white/10 shadow-2xl flex flex-col\">\n                        <h3 className=\"text-lg font-semibold text-white mb-4\">Clear Canvas</h3>\n\n                        {canvasNodes.length === 0 ? (\n                            <p className=\"text-sm text-white/60 mb-4\">No nodes on canvas.</p>\n                        ) : (\n                            <>\n                                {/* 操作按钮 */}",
      "full_line": "                    {/* 对话框 */}\n                    <div className=\"relative bg-gray-900 rounded-lg p-6 w-[480px] max-h-[80vh] border border-white/10 shadow-2xl flex flex-col\">\n                        <h3 className=\"text-lg font-semibold text-white mb-4\">Clear Canvas</h3>\n\n                        {canvasNodes.length === 0 ? (\n                            <p className=\"text-sm text-white/60 mb-4\">No nodes on canvas.</p>\n                        ) : (\n                            <>\n                                {/* 操作按钮 */}"
    },
    {
      "line": 2587,
      "type": "block",
      "original": "                                {/* 节点列表 */}\n                                <div className=\"flex-1 overflow-y-auto max-h-[300px] border border-white/10 rounded mb-4\">\n                                    {canvasNodes.map(node => (\n                                        <div\n                                            key={node.id}\n                                            onClick={() => toggleNodeToRemove(node.id)}\n                                            className={`flex items-center gap-3 px-3 py-2 cursor-pointer transition-colors ${\n                                                selectedNodesToRemove.has(node.id)\n                                                    ? 'bg-blue-500/20'\n                                                    : 'hover:bg-white/5'\n                                            }`}\n                                        >\n                                            {/* Checkbox */}",
      "full_line": "                                {/* 节点列表 */}\n                                <div className=\"flex-1 overflow-y-auto max-h-[300px] border border-white/10 rounded mb-4\">\n                                    {canvasNodes.map(node => (\n                                        <div\n                                            key={node.id}\n                                            onClick={() => toggleNodeToRemove(node.id)}\n                                            className={`flex items-center gap-3 px-3 py-2 cursor-pointer transition-colors ${\n                                                selectedNodesToRemove.has(node.id)\n                                                    ? 'bg-blue-500/20'\n                                                    : 'hover:bg-white/5'\n                                            }`}\n                                        >\n                                            {/* Checkbox */}"
    },
    {
      "line": 2611,
      "type": "block",
      "original": "                                            {/* 节点信息 */}\n                                            <div className=\"flex-1 min-w-0\">\n                                                <div\n                                                    className=\"text-sm truncate\"\n                                                    style={{ color: node.defaultColor }}\n                                                >\n                                                    {node.name}\n                                                </div>\n                                                <div className=\"text-xs text-white/40\">{node.kind}</div>\n                                            </div>\n                                        </div>\n                                    ))}\n                                </div>\n                            </>\n                        )}\n\n                        {/* 底部按钮 */}",
      "full_line": "                                            {/* 节点信息 */}\n                                            <div className=\"flex-1 min-w-0\">\n                                                <div\n                                                    className=\"text-sm truncate\"\n                                                    style={{ color: node.defaultColor }}\n                                                >\n                                                    {node.name}\n                                                </div>\n                                                <div className=\"text-xs text-white/40\">{node.kind}</div>\n                                            </div>\n                                        </div>\n                                    ))}\n                                </div>\n                            </>\n                        )}\n\n                        {/* 底部按钮 */}"
    }
  ],
  "src/components/graph3d/Edge3D.tsx": [
    {
      "line": 107,
      "type": "single",
      "original": "// 用户自定义颜色优先",
      "full_line": "    // 用户自定义颜色优先"
    },
    {
      "line": 110,
      "type": "single",
      "original": "// 根据节点状态计算颜色（仅 fromLean 边）",
      "full_line": "    // 根据节点状态计算颜色（仅 fromLean 边）"
    },
    {
      "line": 121,
      "type": "single",
      "original": "// 宽度",
      "full_line": "  // 宽度"
    }
  ],
  "src/components/graph/SigmaGraph.tsx": [
    {
      "line": 160,
      "type": "single",
      "original": "// 画节点",
      "full_line": "    // 画节点"
    },
    {
      "line": 170,
      "type": "single",
      "original": "// 选中节点的光晕效果",
      "full_line": "      // 选中节点的光晕效果"
    },
    {
      "line": 178,
      "type": "single",
      "original": "// 节点圆",
      "full_line": "      // 节点圆"
    },
    {
      "line": 191,
      "type": "single",
      "original": "// 标签（需要开启 showLabels，且缩放足够大时显示，选中节点始终显示）",
      "full_line": "      // 标签（需要开启 showLabels，且缩放足够大时显示，选中节点始终显示）"
    }
  ],
  "src/components/__tests__/MonacoLeanEditor.test.tsx": [
    {
      "line": 59,
      "type": "single",
      "original": "// 离位朱",
      "full_line": "      expect(styleContent).toMatch(/#EF476F/i) // 离位朱"
    },
    {
      "line": 68,
      "type": "single",
      "original": "// 璇玑青",
      "full_line": "      expect(styleContent).toMatch(/#00F5D4/i) // 璇玑青"
    },
    {
      "line": 77,
      "type": "single",
      "original": "// 衡光金",
      "full_line": "      expect(styleContent).toMatch(/#F4D35E/i) // 衡光金"
    }
  ],
  "src/components/graph3d/__tests__/ForceLayout.test.tsx": [
    {
      "line": 31,
      "type": "single",
      "original": "// 模拟稳定检测逻辑",
      "full_line": "      // 模拟稳定检测逻辑"
    },
    {
      "line": 46,
      "type": "single",
      "original": "// 验证在低移动量时累加 stableFrames",
      "full_line": "      // 验证在低移动量时累加 stableFrames"
    },
    {
      "line": 47,
      "type": "single",
      "original": "// 最后 3 个值 < 0.01",
      "full_line": "      expect(stableFrames).toBe(3) // 最后 3 个值 < 0.01"
    },
    {
      "line": 56,
      "type": "single",
      "original": "// 这个测试验证 ForceLayout 组件接受 onStable prop",
      "full_line": "      // 这个测试验证 ForceLayout 组件接受 onStable prop"
    },
    {
      "line": 57,
      "type": "single",
      "original": "// 通过 TypeScript 类型检查确保",
      "full_line": "      // 通过 TypeScript 类型检查确保"
    },
    {
      "line": 68,
      "type": "single",
      "original": "// 期望的新 prop",
      "full_line": "        onStable?: () => void  // 期望的新 prop"
    },
    {
      "line": 71,
      "type": "single",
      "original": "// 类型定义存在即通过",
      "full_line": "      // 类型定义存在即通过"
    },
    {
      "line": 101,
      "type": "single",
      "original": "// 模拟 61 帧的稳定状态",
      "full_line": "      // 模拟 61 帧的稳定状态"
    },
    {
      "line": 103,
      "type": "single",
      "original": "// 稳定状态",
      "full_line": "        const totalMovement = 0.005 // 稳定状态"
    },
    {
      "line": 111,
      "type": "single",
      "original": "// 在首次达到稳定阈值时触发回调",
      "full_line": "          // 在首次达到稳定阈值时触发回调"
    },
    {
      "line": 119,
      "type": "single",
      "original": "// onStable 应该只被调用一次",
      "full_line": "      // onStable 应该只被调用一次"
    },
    {
      "line": 129,
      "type": "single",
      "original": "// 正在拖拽",
      "full_line": "      const draggingNodeId = 'node_1' // 正在拖拽"
    },
    {
      "line": 134,
      "type": "single",
      "original": "// 模拟稳定状态但正在拖拽",
      "full_line": "      // 模拟稳定状态但正在拖拽"
    },
    {
      "line": 139,
      "type": "single",
      "original": "// 拖拽时重置稳定计数",
      "full_line": "          // 拖拽时重置稳定计数"
    },
    {
      "line": 152,
      "type": "single",
      "original": "// 拖拽时不应触发 onStable",
      "full_line": "      // 拖拽时不应触发 onStable"
    },
    {
      "line": 165,
      "type": "single",
      "original": "// 第一次稳定",
      "full_line": "      // 第一次稳定"
    },
    {
      "line": 183,
      "type": "single",
      "original": "// 打断稳定（添加新节点导致移动）",
      "full_line": "      // 打断稳定（添加新节点导致移动）"
    },
    {
      "line": 187,
      "type": "single",
      "original": "// 第二次稳定",
      "full_line": "      // 第二次稳定"
    },
    {
      "line": 203,
      "type": "single",
      "original": "// 应该触发两次",
      "full_line": "      // 应该触发两次"
    },
    {
      "line": 226,
      "type": "single",
      "original": "// 模拟 onStable 回调",
      "full_line": "      // 模拟 onStable 回调"
    },
    {
      "line": 3,
      "type": "block",
      "original": "/**\n * ForceLayout 稳定检测和位置保存测试\n *\n * 测试场景：\n * 1. 物理模拟稳定检测\n * 2. 稳定后触发 onStable 回调\n * 3. 位置保存逻辑\n */",
      "full_line": "/**\n * ForceLayout 稳定检测和位置保存测试\n *\n * 测试场景：\n * 1. 物理模拟稳定检测\n * 2. 稳定后触发 onStable 回调\n * 3. 位置保存逻辑\n */"
    },
    {
      "line": 19,
      "type": "block",
      "original": "      /**\n       * 当 totalMovement < 0.01 连续超过 60 帧时，\n       * 认为模拟已稳定\n       *\n       * 当前实现 (ForceLayout.tsx:494-502):\n       * - 如果 totalMovement > 0.01，stableFrames = 0\n       * - 否则 stableFrames++\n       * - 当 stableFrames > 60 时跳过计算\n       *\n       * 需要添加：稳定时触发 onStable 回调\n       */",
      "full_line": "      /**\n       * 当 totalMovement < 0.01 连续超过 60 帧时，\n       * 认为模拟已稳定\n       *\n       * 当前实现 (ForceLayout.tsx:494-502):\n       * - 如果 totalMovement > 0.01，stableFrames = 0\n       * - 否则 stableFrames++\n       * - 当 stableFrames > 60 时跳过计算\n       *\n       * 需要添加：稳定时触发 onStable 回调\n       */"
    },
    {
      "line": 51,
      "type": "block",
      "original": "      /**\n       * ForceLayout 应该有 onStable 回调 prop\n       * 当模拟稳定时调用此回调\n       */",
      "full_line": "      /**\n       * ForceLayout 应该有 onStable 回调 prop\n       * 当模拟稳定时调用此回调\n       */"
    },
    {
      "line": 87,
      "type": "block",
      "original": "      /**\n       * 当物理模拟稳定后（stableFrames > 60），\n       * 应该触发 onStable 回调\n       *\n       * 实现逻辑：\n       * 1. 检测 stableFrames 从 60 变为 61\n       * 2. 触发 onStable 回调\n       * 3. 只触发一次（避免重复）\n       */",
      "full_line": "      /**\n       * 当物理模拟稳定后（stableFrames > 60），\n       * 应该触发 onStable 回调\n       *\n       * 实现逻辑：\n       * 1. 检测 stableFrames 从 60 变为 61\n       * 2. 触发 onStable 回调\n       * 3. 只触发一次（避免重复）\n       */"
    },
    {
      "line": 124,
      "type": "block",
      "original": "      /**\n       * 用户拖拽节点时不应触发 onStable\n       */",
      "full_line": "      /**\n       * 用户拖拽节点时不应触发 onStable\n       */"
    },
    {
      "line": 157,
      "type": "block",
      "original": "      /**\n       * 如果模拟被打断后重新稳定，应该再次触发 onStable\n       */",
      "full_line": "      /**\n       * 如果模拟被打断后重新稳定，应该再次触发 onStable\n       */"
    },
    {
      "line": 210,
      "type": "block",
      "original": "      /**\n       * 当 onStable 触发时，应该保存所有节点的 3D 位置\n       *\n       * 实现方式：\n       * ForceGraph3D 传入 onStable 回调，在回调中调用 canvasStore.updatePositions()\n       */",
      "full_line": "      /**\n       * 当 onStable 触发时，应该保存所有节点的 3D 位置\n       *\n       * 实现方式：\n       * ForceGraph3D 传入 onStable 回调，在回调中调用 canvasStore.updatePositions()\n       */"
    }
  ],
  "src/hooks/__tests__/useLSPMonacoSync.test.ts": [
    {
      "line": 1,
      "type": "block",
      "original": "/**\n * LSP-Monaco Synchronization Tests\n *\n * 严格测试 LSP 状态与 Monaco 诊断显示的同步：\n * 1. LSP 启动 → Monaco 必须显示诊断\n * 2. LSP 关闭 → Monaco 必须清空诊断\n * 3. 状态计算必须正确\n */",
      "full_line": "/**\n * LSP-Monaco Synchronization Tests\n *\n * 严格测试 LSP 状态与 Monaco 诊断显示的同步：\n * 1. LSP 启动 → Monaco 必须显示诊断\n * 2. LSP 关闭 → Monaco 必须清空诊断\n * 3. 状态计算必须正确\n */"
    }
  ],
  "src/lib/__tests__/canvasStore.test.ts": [
    {
      "line": 23,
      "type": "single",
      "original": "// 这个测试验证类型定义",
      "full_line": "      // 这个测试验证类型定义"
    },
    {
      "line": 24,
      "type": "single",
      "original": "// 实际的类型检查由 TypeScript 编译器完成",
      "full_line": "      // 实际的类型检查由 TypeScript 编译器完成"
    },
    {
      "line": 25,
      "type": "single",
      "original": "// 这里我们通过创建对象来验证结构",
      "full_line": "      // 这里我们通过创建对象来验证结构"
    },
    {
      "line": 37,
      "type": "single",
      "original": "// 导入 store 并验证 positions 结构",
      "full_line": "      // 导入 store 并验证 positions 结构"
    },
    {
      "line": 40,
      "type": "single",
      "original": "// 设置 mock API 响应",
      "full_line": "      // 设置 mock API 响应"
    },
    {
      "line": 67,
      "type": "single",
      "original": "// 位置应该包含 z 坐标",
      "full_line": "      // 位置应该包含 z 坐标"
    },
    {
      "line": 77,
      "type": "single",
      "original": "// Mock API 响应包含 3D 位置",
      "full_line": "      // Mock API 响应包含 3D 位置"
    },
    {
      "line": 112,
      "type": "single",
      "original": "// Mock API 响应",
      "full_line": "      // Mock API 响应"
    },
    {
      "line": 121,
      "type": "single",
      "original": "// 更新 3D 位置",
      "full_line": "      // 更新 3D 位置"
    },
    {
      "line": 126,
      "type": "single",
      "original": "// 验证 API 调用包含 z 坐标",
      "full_line": "      // 验证 API 调用包含 z 坐标"
    },
    {
      "line": 162,
      "type": "single",
      "original": "// updatePosition 应该接受 3 个坐标参数",
      "full_line": "      // updatePosition 应该接受 3 个坐标参数"
    },
    {
      "line": 163,
      "type": "single",
      "original": "// 当前签名: updatePosition(nodeId, x, y)",
      "full_line": "      // 当前签名: updatePosition(nodeId, x, y)"
    },
    {
      "line": 164,
      "type": "single",
      "original": "// 期望签名: updatePosition(nodeId, x, y, z)",
      "full_line": "      // 期望签名: updatePosition(nodeId, x, y, z)"
    },
    {
      "line": 3,
      "type": "block",
      "original": "/**\n * Canvas Store 3D 位置测试\n *\n * 测试场景：\n * 1. 位置类型应为 3D {x, y, z}\n * 2. 从 API 加载 3D 位置\n * 3. 保存 3D 位置到 API\n */",
      "full_line": "/**\n * Canvas Store 3D 位置测试\n *\n * 测试场景：\n * 1. 位置类型应为 3D {x, y, z}\n * 2. 从 API 加载 3D 位置\n * 3. 保存 3D 位置到 API\n */"
    }
  ],
  "src/lib/__tests__/nodeStatusDecorations.test.ts": [
    {
      "line": 1,
      "type": "block",
      "original": "/**\n * Tests for node status decorations in Monaco Editor\n *\n * 三象 (Three Celestial Signs):\n * - proven -> 🜲 璇玑 (Star, 璇玑青 #00F5D4) - 恒星永恒，证明完成\n * - sorry -> ⚝ 衡光 (Crescent Moon, 衡光金 #F4D35E) - 弦月待圆，尚需完善\n * - error -> ☾ 离位 (Circled X, 离位朱 #EF476F) - 星辰离位，存在错误\n * - unknown/stated -> no icon\n *\n * When error diagnostic exists on a line, no status icon should appear\n */",
      "full_line": "/**\n * Tests for node status decorations in Monaco Editor\n *\n * 三象 (Three Celestial Signs):\n * - proven -> 🜲 璇玑 (Star, 璇玑青 #00F5D4) - 恒星永恒，证明完成\n * - sorry -> ⚝ 衡光 (Crescent Moon, 衡光金 #F4D35E) - 弦月待圆，尚需完善\n * - error -> ☾ 离位 (Circled X, 离位朱 #EF476F) - 星辰离位，存在错误\n * - unknown/stated -> no icon\n *\n * When error diagnostic exists on a line, no status icon should appear\n */"
    }
  ]
}